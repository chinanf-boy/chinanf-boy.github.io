   
  

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta property="og:title" content="Bevy - ECS" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="http://llever.com/bevyengine-cn&#x2F;getting-started&#x2F;ecs&#x2F;" />
    <meta
      property="og:image"
      content="http://llever.com/bevyengine-cn/assets/bevy_logo_fill.png"
    />
    <meta
      property="og:description"
      content="Bevy is a refreshingly simple data-driven game engine built in Rust. It is free and open-source forever!"
    />
    <link
      rel="shortcut icon"
      type="image/png"
      href="&#x2F;bevyengine-cn/assets/favicon.png"
    />
    <link rel="stylesheet" href="&#x2F;bevyengine-cn/site.css" />
    <link
      href="&#x2F;bevyengine-cn/atom.xml"
      rel="alternate"
      type="application/atom+xml"
    />
    <title>Bevy - ECS</title>
    
<script src="&#x2F;bevyengine-cn/optional-helpers.js"></script>

  </head>

  <body>
    <div class="headerbar-container">
      <nav class="headerbar container">
        <a href="&#x2F;bevyengine-cn/" class="header-logo">
          <img
            src="&#x2F;bevyengine-cn/assets/bevy_logo_dark.svg"
            class="logo"
            alt="bevy logo"
          />
        </a>
        
        <a href="&#x2F;bevyengine-cn/" class="header-logo-mobile">
          <img
            src="&#x2F;bevyengine-cn/assets/bevy_icon_dark.svg"
            class="logo"
            alt="bevy icon"
          />
        </a>
        
        <div class="header-item header-message">
           Features 
        </div>
        <div class="header-item header-push"></div>
        



    


<a href="{{config.base_url}}&#x2f;" class="header-item" >
    Features
</a>

        



    


<a href="&#x2f;learn" class="header-item" >
    Learn
</a>

        



    


<a href="&#x2f;news" class="header-item" >
    News
</a>

        



    


<a href="&#x2f;community" class="header-item" >
    Community
</a>

        <a
          class="header-item header-button header-button-donate"
          href="https://github.com/sponsors/cart"
          >Donate
          <img
            src="&#x2F;bevyengine-cn/assets/heart.svg"
            class="header-button-donate-heart"
            alt="heart icon"
        /></a>
        <a
          class="header-item header-button"
          href="&#x2F;bevyengine-cn/learn/book_cn/getting-started/"
          >Get Started</a
        >
      </nav>
    </div>
    <section class="section">
      <div class="container">
<div class="book-page">
  <input type="checkbox" style="display: none" id="show-book-nav" />
  <nav class="book-nav" role="navigation">
     
    <ul class="book-nav-sections-container book-nav-sections">
       

<li class="book-nav-section">
    <a href="&#x2F;bevyengine-cn&#x2F;introduction&#x2F;" class="book-nav-section-title">
        <strong class="book-nav-section-number">1.</strong>
        简介
    </a>
    
</li>
  

<li class="book-nav-section">
    <a href="&#x2F;bevyengine-cn&#x2F;getting-started&#x2F;" class="book-nav-section-title">
        <strong class="book-nav-section-number">2.</strong>
        入门指南
    </a>
    
    <ul class="book-nav-sections book-nav-sections-indented">
        
        
        

<li class="book-nav-section">
    <a href="&#x2F;bevyengine-cn&#x2F;getting-started&#x2F;setup&#x2F;" class="book-nav-section-title">
        <strong class="book-nav-section-number">2.1.</strong>
        设置
    </a>
    
</li>

        
        
        

<li class="book-nav-section">
    <a href="&#x2F;bevyengine-cn&#x2F;getting-started&#x2F;apps&#x2F;" class="book-nav-section-title">
        <strong class="book-nav-section-number">2.2.</strong>
        apps
    </a>
    
</li>

        
        
        

<li class="book-nav-section">
    <a href="&#x2F;bevyengine-cn&#x2F;getting-started&#x2F;ecs&#x2F;" class="book-nav-section-title-active book-nav-section-title" >
        <strong class="book-nav-section-number">2.3.</strong>
        ecs
    </a>
    
</li>

        
        
        

<li class="book-nav-section">
    <a href="&#x2F;bevyengine-cn&#x2F;getting-started&#x2F;plugins&#x2F;" class="book-nav-section-title">
        <strong class="book-nav-section-number">2.4.</strong>
        插件
    </a>
    
</li>

        
        
        

<li class="book-nav-section">
    <a href="&#x2F;bevyengine-cn&#x2F;getting-started&#x2F;resources&#x2F;" class="book-nav-section-title">
        <strong class="book-nav-section-number">2.5.</strong>
        资源
    </a>
    
</li>

        
    </ul>
    
</li>
  

<li class="book-nav-section">
    <a href="&#x2F;bevyengine-cn&#x2F;next-steps&#x2F;" class="book-nav-section-title">
        <strong class="book-nav-section-number">3.</strong>
        下一步
    </a>
    
</li>
  

<li class="book-nav-section">
    <a href="&#x2F;bevyengine-cn&#x2F;contributing&#x2F;" class="book-nav-section-title">
        <strong class="book-nav-section-number">4.</strong>
        贡献
    </a>
    
    <ul class="book-nav-sections book-nav-sections-indented">
        
        
        

<li class="book-nav-section">
    <a href="&#x2F;bevyengine-cn&#x2F;contributing&#x2F;code&#x2F;" class="book-nav-section-title">
        <strong class="book-nav-section-number">4.1.</strong>
        code
    </a>
    
</li>

        
        
        

<li class="book-nav-section">
    <a href="&#x2F;bevyengine-cn&#x2F;contributing&#x2F;docs&#x2F;" class="book-nav-section-title">
        <strong class="book-nav-section-number">4.2.</strong>
        docs
    </a>
    
</li>

        
    </ul>
    
</li>
  

<li class="book-nav-section">
    <a href="&#x2F;bevyengine-cn&#x2F;troubleshooting&#x2F;" class="book-nav-section-title">
        <strong class="book-nav-section-number">5.</strong>
        troubleshooting
    </a>
    
</li>
  

<li class="book-nav-section">
    <a href="&#x2F;bevyengine-cn&#x2F;faq&#x2F;" class="book-nav-section-title">
        <strong class="book-nav-section-number">6.</strong>
        faq
    </a>
    
</li>
 
    </ul>
    
  </nav>
  <div class="book-content">
                                                                                      
    <a
      id="book-pager-bar-previous"
      href="&#x2F;bevyengine-cn&#x2F;getting-started&#x2F;apps&#x2F;"
      class="book-pager-bar book-pager-bar-previous"
    >
      <div class="book-pager-bar-icon book-pager-bar-icon-previous">
        <img
          src="&#x2F;bevyengine-cn/assets/pager_previous.svg"
          class="book-pager-image book-pager-image-left"
        />
      </div>
    </a>
         
    <a
      id="book-pager-bar-next"
      href="&#x2F;bevyengine-cn&#x2F;getting-started&#x2F;plugins&#x2F;"
      class="book-pager-bar book-pager-bar-next"
    >
      <div class="book-pager-bar-icon book-pager-bar-icon-next">
        <img
          src="&#x2F;bevyengine-cn/assets/pager_next.svg"
          class="book-pager-image book-pager-image-right"
        />
      </div>
    </a>
    

    <h1>
       ECS  
    </h1>
    <div class="media-content"><p>Bevy中的所有应用程序逻辑都使用实体(Entity)组件(Component)系统(System)范式, 通常简称为ECS.<br />
ECS是一种软件模式, 包括将程序分解为<strong>实体(Entity)</strong>, <strong>组件(Component)<strong>和</strong>系统(System)</strong>.<br />
<span class="warning"> <strong>实体(Entity)</strong> 是指向一群 <strong>组件(Component)</strong> 的唯一 <strong>事物(things)</strong>, 然后使用 <strong>系统(System)</strong> 处理其过程.</span></p>
<p>例如, 一个实体可能有<code>位置(Position)</code>和<code>速度(Velocity)</code>组件, 而另一个实体可能有<code>位置(Position)</code>和<code>UI</code>组件. 系统是在一组特定组件上运行的逻辑. 你可能有一个运行在所有带有<code>位置(Position)</code>和<code>速度(Velocity)</code>组件的实体上的<code>移动</code>系统.</p>
<p>ECS模式鼓励清晰, (解耦)分离的设计, 强制使你将数据和逻辑分解为核心组件. 通过优化内存访问模式并简化并行性, 有助于使你的代码更快.</p>
<h2 id="bevy-ecs">Bevy ECS</h2>
<p>Bevy ECS是Bevy对ECS模式的实现. 不像其他需要复杂的生存期, 特征, 构建器模式或者宏的Rust ECS的实现, Bevy ECS对所有这些概念使用常规的Rust数据类型:</p>
<ul>
<li><strong>组件(Components)</strong>: 普通的Rust结构体<pre style="background-color:#2b2c2f;">
<span style="color:#c594c5;">struct </span><span style="color:#cccece;">Position </span><span style="color:#5fb3b3;">{ </span><span style="color:#cccece;">x</span><span style="color:#5fb3b3;">: </span><span style="color:#c594c5;">f32</span><span style="color:#cccece;">, y</span><span style="color:#5fb3b3;">: </span><span style="color:#c594c5;">f32 </span><span style="color:#5fb3b3;">}
</span></pre></li>
<li><strong>系统(Systems)</strong>: 普通的Rust函数<pre style="background-color:#2b2c2f;">
<span style="color:#c594c5;">fn </span><span style="color:#6699cc;">print_position_system</span><span style="color:#5fb3b3;">(</span><span style="color:#f99157;">query</span><span style="color:#5fb3b3;">: </span><span style="color:#cccece;">Query</span><span style="color:#5fb3b3;">&lt;&amp;</span><span style="color:#cccece;">Transform</span><span style="color:#5fb3b3;">&gt;) {
</span><span style="color:#cccece;">    </span><span style="color:#c594c5;">for</span><span style="color:#cccece;"> transform </span><span style="color:#5fb3b3;">in</span><span style="color:#cccece;"> query</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">iter</span><span style="color:#5fb3b3;">() {
</span><span style="color:#cccece;">        </span><span style="color:#cccece;">println!</span><span style="color:#5fb3b3;">(&quot;</span><span style="color:#99c794;">position: {:?}</span><span style="color:#5fb3b3;">&quot;,</span><span style="color:#cccece;"> transform</span><span style="color:#5fb3b3;">.</span><span style="color:#cccece;">translation</span><span style="color:#5fb3b3;">);
</span><span style="color:#cccece;">    </span><span style="color:#5fb3b3;">}
</span><span style="color:#5fb3b3;">}
</span></pre></li>
<li><strong>实体(Entities)</strong>: 包含唯一整数的简单类型<pre style="background-color:#2b2c2f;">
<span style="color:#c594c5;">struct </span><span style="color:#cccece;">Entity</span><span style="color:#5fb3b3;">(</span><span style="color:#c594c5;">u64</span><span style="color:#5fb3b3;">);
</span></pre></li>
</ul>
<p>现在让我们在实践中看看它是如何工作的!</p>
<h2 id="ni-de-di-yi-ge-xi-tong-system">你的第一个系统(System)</h2>
<p>拷贝下面的函数到你的<code>main.rs</code>文件中:</p>
<pre style="background-color:#2b2c2f;">
<span style="color:#c594c5;">fn </span><span style="color:#6699cc;">hello_world</span><span style="color:#5fb3b3;">() {
</span><span style="color:#cccece;">    </span><span style="color:#cccece;">println!</span><span style="color:#5fb3b3;">(&quot;</span><span style="color:#99c794;">hello world!</span><span style="color:#5fb3b3;">&quot;);
</span><span style="color:#5fb3b3;">}
</span></pre>
<p>这将是我们第一个系统. 剩下的步骤就是把它加到我们的App中!</p>
<pre style="background-color:#2b2c2f;">
<span style="color:#c594c5;">fn </span><span style="color:#6699cc;">main</span><span style="color:#5fb3b3;">() {
</span><span style="color:#cccece;">    </span><span style="color:#cccece;">App</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">build</span><span style="color:#5fb3b3;">()
</span><span style="color:#cccece;">        </span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">add_system</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">hello_world</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">())
</span><span style="color:#cccece;">        </span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">run</span><span style="color:#5fb3b3;">();
</span><span style="color:#5fb3b3;">}
</span></pre>
<p><strong>注意</strong><code>hello_world.system()</code>函数的调用. 这是一种<code>特征扩展方法</code>, 可将<code>hello_world</code>函数转变成
<a href="https:&#x2F;&#x2F;docs.rs/bevy_ecs&#x2F;latest&#x2F;bevy_ecs/trait.System.html"><code>System</code>
</a>类型.</p>
<p>调用
<a href="https:&#x2F;&#x2F;docs.rs/bevy_ecs&#x2F;latest&#x2F;bevy_ecs/trait.IntoQuerySystem.html#method.add_system"><code>add_system()</code>
</a>方法把系统加到App的
<a href="https:&#x2F;&#x2F;docs.rs/bevy_ecs&#x2F;latest&#x2F;bevy_ecs/struct.Schedule.html"><code>Schedule</code>
</a>, 这个我们稍后再介绍.</p>
<p>现在我们再一次执行<code>cargo run</code>. 你将在命令行中看见<code>hello world!</code>的输出.</p>
<h2 id="ni-de-di-yi-ge-zu-jian-components">你的第一个组件(Components)</h2>
<p>能向整个世界打招呼当然很好, 但是如果我们只想问候特定的人呢? 在ESC中, 通常会将人建模成实体, 并使用一些组件来定义它们. 让我们从一个<code>Person</code>的组件开始.</p>
<p>将这个结构体添加到<code>main.rs</code>:</p>
<pre style="background-color:#2b2c2f;">
<span style="color:#c594c5;">struct </span><span style="color:#cccece;">Person</span><span style="color:#5fb3b3;">;
</span></pre>
<p>但是, 如果我们希望人有一个名字? 在传统的设计中, 我们可能只是添加一个<code>name: String</code>的字段到<code>Person</code>中. 但其他实体也会拥有名字! 举个例子, 狗可能也应该有一个名字. 将数据类型分解成小块, 以鼓励代码重用通常更有意义. 因此, 让<code>名字(Name)</code>成为独立的组件.</p>
<pre style="background-color:#2b2c2f;">
<span style="color:#c594c5;">struct </span><span style="color:#cccece;">Name</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">String</span><span style="color:#5fb3b3;">);
</span></pre>
<p>我们可以通过<code>startup system</code>将<code>People</code>加到我们的世界(
<a href="https:&#x2F;&#x2F;docs.rs/bevy_ecs&#x2F;latest&#x2F;bevy_ecs/struct.World.html"><code>World</code>
</a>).<br />
<code>startup system</code>就像普通的系统(System)一样, 但它们只运行一次, 而且是在其他系统之前被调用.<br />
当我们的应用启动时, 让我们通过
<a href="https:&#x2F;&#x2F;docs.rs/bevy_ecs&#x2F;latest&#x2F;bevy_ecs/struct.Commands.html"><code>Commands</code>
</a>生产大量的实体到我们的世界(
<a href="https:&#x2F;&#x2F;docs.rs/bevy_ecs&#x2F;latest&#x2F;bevy_ecs/struct.World.html"><code>World</code>
</a>)中.</p>
<pre style="background-color:#2b2c2f;">
<span style="color:#c594c5;">fn </span><span style="color:#6699cc;">add_people</span><span style="color:#5fb3b3;">(</span><span style="color:#f99157;">commands</span><span style="color:#5fb3b3;">: &amp;</span><span style="color:#c594c5;">mut</span><span style="color:#cccece;"> Commands</span><span style="color:#5fb3b3;">) {
</span><span style="color:#cccece;">    </span><span style="color:#cccece;">commands
</span><span style="color:#cccece;">        </span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">spawn</span><span style="color:#5fb3b3;">((</span><span style="color:#cccece;">Person</span><span style="color:#5fb3b3;">,</span><span style="color:#cccece;"> Name</span><span style="color:#5fb3b3;">(&quot;</span><span style="color:#99c794;">Elaina Proctor</span><span style="color:#5fb3b3;">&quot;.</span><span style="color:#6699cc;">to_string</span><span style="color:#5fb3b3;">())))
</span><span style="color:#cccece;">        </span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">spawn</span><span style="color:#5fb3b3;">((</span><span style="color:#cccece;">Person</span><span style="color:#5fb3b3;">,</span><span style="color:#cccece;"> Name</span><span style="color:#5fb3b3;">(&quot;</span><span style="color:#99c794;">Renzo Hume</span><span style="color:#5fb3b3;">&quot;.</span><span style="color:#6699cc;">to_string</span><span style="color:#5fb3b3;">())))
</span><span style="color:#cccece;">        </span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">spawn</span><span style="color:#5fb3b3;">((</span><span style="color:#cccece;">Person</span><span style="color:#5fb3b3;">,</span><span style="color:#cccece;"> Name</span><span style="color:#5fb3b3;">(&quot;</span><span style="color:#99c794;">Zayna Nieves</span><span style="color:#5fb3b3;">&quot;.</span><span style="color:#6699cc;">to_string</span><span style="color:#5fb3b3;">())));
</span><span style="color:#5fb3b3;">}
</span></pre>
<p>像这样注册启动系统(startup system):</p>
<pre style="background-color:#2b2c2f;">
<span style="color:#c594c5;">fn </span><span style="color:#6699cc;">main</span><span style="color:#5fb3b3;">() {
</span><span style="color:#cccece;">    </span><span style="color:#cccece;">App</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">build</span><span style="color:#5fb3b3;">()
</span><span style="color:#cccece;">        </span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">add_startup_system</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">add_people</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">())
</span><span style="color:#cccece;">        </span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">add_system</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">hello_world</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">())
</span><span style="color:#cccece;">        </span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">run</span><span style="color:#5fb3b3;">();
</span><span style="color:#5fb3b3;">}
</span></pre>
<p>我们现在可以运行这个应用, <code>add_people</code>系统将会最先执行, 然后是<code>hello_world</code>. 但是我们新的<code>people</code>仍然无事可做! 让我们创建一个系统, 让我们的新公民向我们的世界(
<a href="https:&#x2F;&#x2F;docs.rs/bevy_ecs&#x2F;latest&#x2F;bevy_ecs/struct.World.html"><code>World</code>
</a>)打招呼:</p>
<pre style="background-color:#2b2c2f;">
<span style="color:#c594c5;">fn </span><span style="color:#6699cc;">greet_people</span><span style="color:#5fb3b3;">(</span><span style="color:#f99157;">query</span><span style="color:#5fb3b3;">: </span><span style="color:#cccece;">Query</span><span style="color:#5fb3b3;">&lt;&amp;</span><span style="color:#cccece;">Name, With</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#cccece;">Person</span><span style="color:#5fb3b3;">&gt;&gt;) {
</span><span style="color:#cccece;">    </span><span style="color:#c594c5;">for</span><span style="color:#cccece;"> name </span><span style="color:#5fb3b3;">in</span><span style="color:#cccece;"> query</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">iter</span><span style="color:#5fb3b3;">() {
</span><span style="color:#cccece;">        </span><span style="color:#cccece;">println!</span><span style="color:#5fb3b3;">(&quot;</span><span style="color:#99c794;">hello {}!</span><span style="color:#5fb3b3;">&quot;,</span><span style="color:#cccece;"> name</span><span style="color:#5fb3b3;">.</span><span style="color:#f99157;">0</span><span style="color:#5fb3b3;">);
</span><span style="color:#cccece;">    </span><span style="color:#5fb3b3;">}
</span><span style="color:#5fb3b3;">}
</span></pre>
<p>我们传递给<code>system function</code>的参数定了系统运行的数据. 在本例中, <code>greet_people</code>将在所有带有<code>Person</code>和<code>Name</code>组件的实体上运行.</p>
<p>你可以将上面的查询解释为: &quot;遍历每一个拥有<code>Person</code>组件的<code>Name</code>组件&quot;</p>
<p>在我们的App中注册它:</p>
<pre style="background-color:#2b2c2f;">
<span style="color:#c594c5;">fn </span><span style="color:#6699cc;">main</span><span style="color:#5fb3b3;">() {
</span><span style="color:#cccece;">    </span><span style="color:#cccece;">App</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">build</span><span style="color:#5fb3b3;">()
</span><span style="color:#cccece;">        </span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">add_startup_system</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">add_people</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">())
</span><span style="color:#cccece;">        </span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">add_system</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">hello_world</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">())
</span><span style="color:#cccece;">        </span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">add_system</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">greet_people</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">())
</span><span style="color:#cccece;">        </span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">run</span><span style="color:#5fb3b3;">();
</span><span style="color:#5fb3b3;">}
</span></pre>
<p>现在我们运行我们的App, 将会得到以下结果:</p>
<pre style="background-color:#2b2c2f;">
<span style="color:#cccece;">hello world!
</span><span style="color:#cccece;">hello Elaina Proctor!
</span><span style="color:#cccece;">hello Renzo Hume!
</span><span style="color:#cccece;">hello Zayna Nieves!
</span></pre>
<p>棒棒哒!</p>
<p>备注: <code>hello world!</code>可能出现的顺序和上面显示的不同. 这是因为系统在没有共享依赖关系的情况下, 默认是并行的.</p>
</div>
    <div class="book-pagers" />
  </div>
</div>

</div>
    </section>
  </body>
</html>
