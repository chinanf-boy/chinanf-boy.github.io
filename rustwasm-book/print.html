<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Rust and WebAssembly</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <base href="">

        <link rel="stylesheet" href="book.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="_FontAwesome/css/font-awesome.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        

    </head>
    <body class="light">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = 'light'; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li><a href="introduction.zh.html"><strong aria-hidden="true">1.</strong> ä»‹ç»</a></li><li><a href="background-and-concepts.zh.html"><strong aria-hidden="true">2.</strong> èƒŒæ™¯å’Œæ¦‚å¿µ</a></li><li><a href="game-of-life/introduction.zh.html"><strong aria-hidden="true">3.</strong> æ•™ç¨‹:åº·å¨çš„ç”Ÿå‘½æ¸¸æˆ</a></li><li><ol class="section"><li><a href="game-of-life/setup.zh.html"><strong aria-hidden="true">3.1.</strong> å®‰è£…</a></li><li><a href="game-of-life/hello-world.zh.html"><strong aria-hidden="true">3.2.</strong> Hello, World!</a></li><li><a href="game-of-life/rules.zh.html"><strong aria-hidden="true">3.3.</strong> è§„åˆ™</a></li><li><a href="game-of-life/implementing.zh.html"><strong aria-hidden="true">3.4.</strong> å®ç° ç”Ÿå‘½</a></li><li><a href="game-of-life/debugging.zh.html"><strong aria-hidden="true">3.5.</strong> è°ƒè¯•</a></li><li><a href="game-of-life/interactivity.zh.html"><strong aria-hidden="true">3.6.</strong> å¢åŠ äº¤äº’æ€§</a></li><li><a href="game-of-life/time-profiling.zh.html"><strong aria-hidden="true">3.7.</strong> æ—¶é—´åˆ†æ</a></li><li><a href="game-of-life/code-size.zh.html"><strong aria-hidden="true">3.8.</strong> æ”¶ç¼© .wasm å°ºå¯¸</a></li><li><a href="game-of-life/production.zh.html"><strong aria-hidden="true">3.9.</strong> ç”Ÿäº§ ä¸ å‘å¸ƒ</a></li><li class="spacer"></li></ol></li><li><a href="crates.zh.html"><strong aria-hidden="true">5.</strong> ä½ åº”è¯¥çŸ¥é“çš„Cratesç®±å­</a></li><li><a href="tools.zh.html"><strong aria-hidden="true">6.</strong> ä½ åº”è¯¥çŸ¥é“çš„å·¥å…·</a></li><li><a href="js-ffi.zh.html"><strong aria-hidden="true">7.</strong> JavaScript äº’æ“ä½œ</a></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light <span class="default">(default)</span></button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Rust and WebAssembly</h1> 

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <p>è¿™æœ¬å°ä¹¦æè¿°äº†å¦‚ä½•è®© <a href="https://www.rust-lang.org">rust</a> å’Œ <a href="https://webassembly.org/">WebAssembly</a> ä¸€èµ·.</p>
<p><a href="https://github.com/rustwasm/book">è¿™æœ¬ä¹¦æ˜¯å¼€æºçš„!æ‰¾ä¸ªæ‹¼å†™é”™è¯¯?æˆ‘ä»¬å¿½ç•¥äº†ä»€ä¹ˆå—?å‘æˆ‘ä»¬å‘é€æ‹‰åŠ¨è¯·æ±‚!</a></p>
<a class="header" href="print.html#aèƒŒæ™¯å’Œæ¦‚å¿µ" id="aèƒŒæ™¯å’Œæ¦‚å¿µ"><h1>èƒŒæ™¯å’Œæ¦‚å¿µ</h1></a>
<a class="header" href="print.html#webassembly" id="webassembly"><h2>WebAssembly</h2></a>
<p><code>WebAssembly</code> æ˜¯ä¸€ä¸ªç®€å•çš„æœºå™¨æ¨¡å‹å’Œå¯æ‰§è¡Œæ ¼å¼<a href="https://%60WebAssembly%60.github.io/spec/">extensive
specification</a>å¹¿æ³›çš„å®šä¹‰.</p>
<p>è™½ç„¶å®ƒç›®å‰åœ¨ JavaScriptå’ŒWebç¤¾åŒº ä¸­å—åˆ°å…³æ³¨, ä½†å¹¶æ²¡æœ‰é™åˆ¶å®ƒçš„è¿è¡Œç¯å¢ƒ. å› æ­¤,è®¤ä¸ºåœ¨ä¸ä¹…çš„å°†æ¥, <em>wasm</em>å°†æˆä¸ºåœ¨å„ç§ç¯å¢ƒä¸­, ä½¿ç”¨çš„é‡è¦&quot;ä¾¿æºå¼å¯æ‰§è¡Œ&quot;æ ¼å¼æ˜¯æœ‰å¯èƒ½çš„ (æˆ‘ä»¬å°†èŠ±ä¸€äº›æ—¶é—´ä»”ç»†ç ”ç©¶ä¸€ä¸‹<em>wasm</em>ä¾¿æºæ€§åŠŸèƒ½,å¾…æœ¬ä¹¦è¿›ä¸€æ­¥è¯´æ˜).</p>
<p>æ¥åˆ°<em>ä»Šå¤©</em>,æ€»å¾—æ¥è¯´,<em>wasm</em>ä¸»è¦ä¸JavaScriptæœ‰å…³,å®ƒæœ‰å¾ˆå¤šç§ç±» (åŒ…æ‹¬æµè§ˆå™¨å’Œ <code>Node.js</code>) . ç”±äºJSå¹¿æ³›ä¸”æ˜“äºè®¿é—®, æˆ‘ä»¬å°†ä¸»è¦å…³æ³¨ä½¿ç”¨è¿™äº›å¹³å°æ¥è¿è¡Œ Rustç”Ÿæˆçš„<em>wasm</em>,ä½† å…¶ä»–è¯­è¨€çš„ç¼–è¯‘ å¯èƒ½ä¼šåœ¨ä¸ä¹…çš„å°†æ¥å‘å¸ƒ.</p>
<p>ä½œä¸ºä¸€ç§ç¼–ç¨‹è¯­è¨€,<code>WebAssembly</code>ç”±ä¸¤ç§æ ¼å¼ç»„æˆ: äºŒè¿›åˆ¶æ ¼å¼å’Œæ–‡æœ¬æ ¼å¼. ä¸¤è€…éƒ½ä»£è¡¨äº†ä¸€ç§å…±åŒçš„ç»“æ„, å°½ç®¡æ–¹å¼ä¸åŒ. æ–‡æœ¬æ ¼å¼ (é€šå¸¸ç§°ä¸º<code>wat</code>) ä½¿ç”¨<a href="https://en.wikipedia.org/wiki/S-expression">Sè¡¨è¾¾å¼-</a>,ä¸ Clojureæˆ–Racket ç­‰è¯­è¨€æœ‰ä¸€äº›ç›¸ä¼¼ä¹‹å¤„. äºŒè¿›åˆ¶æ ¼å¼<code>wasm</code>æ˜¯ä¸€ç§è¾ƒä½çº§åˆ«çš„æ ¼å¼,å®ƒæœ¬èº«å°±æ˜¯ç”± è§£é‡Šå™¨è¿ è¡Œçš„æ±‡ç¼–ä»£ç .</p>
<p>ä½œä¸ºå‚è€ƒ,è¿™é‡Œæ˜¯ä¸€ä¸ª<code>wat</code>æ ¼å¼çš„é˜¶ä¹˜å‡½æ•°:</p>
<pre><code>(module
  (func $fac (param f64) (result f64)
    get_local 0
    f64.const 1
    f64.lt
    if (result f64)
      f64.const 1
    else
      get_local 0
      get_local 0
      f64.const 1
      f64.sub
      call $fac
      f64.mul
    end)
  (export &quot;fac&quot; (func $fac)))
</code></pre>
<p>å¦‚æœä½ å¯¹<code>wasm</code>æ–‡ä»¶å¥½å¥‡,ä½ å¯ä»¥ä½¿ç”¨<a href="https://cdn.rawgit.com/%60WebAssembly%60/wabt/aae5a4b7/demo/wat2wasm/">wat2wasm demo</a>çœ‹ä¸Šé¢çš„ä»£ç .</p>
<p><code>WebAssembly</code>æœ‰ä¸€ä¸ªéå¸¸ç®€å•çš„<a href="https://%60WebAssembly%60.github.io/spec/core/syntax/modules.html#syntax-mem">å†…å­˜æ¨¡å‹</a>. ç›®å‰,ä¸€ä¸ª<code>wasm</code>æ¨¡å—å¯ä»¥è®¿é—®å•ä¸ª&quot;çº¿æ€§å†…å­˜&quot;,å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå›ºå®šæ•°å­—ç±»å‹çš„å¹³é¢æ•°ç»„. è¿™ä¸ª<a href="https://%60WebAssembly%60.github.io/spec/core/syntax/instructions.html#syntax-instr-memory">å†…å­˜æˆé•¿</a>æ˜¯é¡µé¢å¤§å° (64K) çš„å€æ•°,å¹¶ä¸”ä¸èƒ½ç¼©å°.</p>
<a class="header" href="print.html#aæ•™ç¨‹-åº·å¨çš„ç”Ÿå‘½æ¸¸æˆ" id="aæ•™ç¨‹-åº·å¨çš„ç”Ÿå‘½æ¸¸æˆ"><h1>æ•™ç¨‹: åº·å¨çš„ç”Ÿå‘½æ¸¸æˆ</h1></a>
<p>è¿™æ˜¯ä¸€ä¸ªç”¨Rustå’ŒWebAssemblyå®ç°çš„æ•™ç¨‹<a href="https://zh.wikipedia.org/wiki/%E5%BA%B7%E5%A8%81%E7%94%9F%E5%91%BD%E6%B8%B8%E6%88%8F">åº·å¨çš„ç”Ÿå‘½æ¸¸æˆ</a>.</p>
<blockquote>
<p>è°æ˜¯ åº·å¨-ConWay æˆ‘æ€ä¹ˆçŸ¥é“ â“</p>
</blockquote>
<a class="header" href="print.html#aæœ¬æ•™ç¨‹é€‚åˆè°" id="aæœ¬æ•™ç¨‹é€‚åˆè°"><h2>æœ¬æ•™ç¨‹é€‚åˆè°?</h2></a>
<p>æœ¬æ•™ç¨‹é€‚ç”¨äº å·²ç»å…·æœ‰åŸºæœ¬ Rustå’ŒJavaScriptç»éªŒ çš„ä»»ä½•äºº,å¹¶å¸Œæœ›å­¦ä¹ å¦‚ä½•ä¸€èµ·ä½¿ç”¨ Rust,WebAssemblyå’ŒJavaScript.</p>
<p>é˜…è¯»å’Œç¼–å†™åŸºæœ¬çš„ Rust,JavaScriptå’ŒHTML åº”è¯¥ä¼šå¾ˆèˆ’æœ. ä½ ç»å¯¹ä¸éœ€è¦æˆä¸ºä¸“å®¶æ‰èƒ½æ‡‚.</p>
<a class="header" href="print.html#aæˆ‘ä¼šå­¦åˆ°ä»€ä¹ˆ" id="aæˆ‘ä¼šå­¦åˆ°ä»€ä¹ˆ"><h2>æˆ‘ä¼šå­¦åˆ°ä»€ä¹ˆ?</h2></a>
<ul>
<li>
<p>æ€æ ·è®¾ç½®Rustå·¥å…·é“¾, ä¸”å°†å…¶ç¼–è¯‘ä¸º WebAssembly</p>
</li>
<li>
<p>ç”¨äºç”±Rust, WebAssembly,
JavaScript, HTML, å’Œ CSSå¼€å‘çš„å¤šè¯­è¨€ç¨‹åºå·¥ä½œæµç¨‹</p>
</li>
<li>
<p>æ€æ ·è®¾è®¡ è®© Rust å’Œ WebAssembly æœ€ä¼˜åŒ–çš„API, å½“ç„¶è¿˜æœ‰JavaScript</p>
</li>
<li>
<p>æ€æ ·è°ƒè¯•ä»Rustç¼–è¯‘è€Œæ¥çš„WebAssemblyæ¨¡å—</p>
</li>
<li>
<p>æ€æ ·å¯¹Rustå’ŒWebAssemblyçš„ç¨‹åºè¿›è¡Œæ—¶é—´åˆ†æ, è®©å®ƒå˜å¾—æ›´å¿«</p>
</li>
<li>
<p>æ€æ ·å¯¹Rustå’ŒWebAssemblyçš„ç¨‹åºè¿›è¡Œå¤§å°åˆ†æ, è®©å®ƒå˜å°å’Œç½‘ç»œä¸‹è½½é€Ÿåº¦æ›´å¿«</p>
</li>
</ul>
<a class="header" href="print.html#aå®‰è£…" id="aå®‰è£…"><h1>å®‰è£…</h1></a>
<p>è¿™ä¸ªç« èŠ‚è®²è¿°çš„æ˜¯: æ€æ ·è®¾ç½®å°†Rustç¼–è¯‘æˆWebAssemblyå’Œç³…åˆåˆ°JavaScriptçš„å·¥å…·é“¾</p>
<a class="header" href="print.html#rustå·¥å…·é“¾" id="rustå·¥å…·é“¾"><h3>Rustå·¥å…·é“¾</h3></a>
<p>æ‚¨å°†éœ€è¦æ ‡å‡†çš„ Rustå·¥å…·é“¾,åŒ…æ‹¬<code>rustup</code>,<code>rustc</code>,å’Œ<code>cargo</code></p>
<p><a href="https://www.rust-lang.org/en-US/install.html">æŒ‰ç…§ä»¥ä¸‹è¯´æ˜å®‰è£…Rustå·¥å…·é“¾. </a></p>
<a class="header" href="print.html#wasm32-unknown-unknownç›®æ ‡" id="wasm32-unknown-unknownç›®æ ‡"><h2><code>wasm32-unknown-unknown</code>ç›®æ ‡</h2></a>
<p>ä¸€æ—¦å®‰è£…äº† Rustå·¥å…·é“¾ ,æ‚¨å°±å¯ä»¥å°† Rustç¨‹åº ç¼–è¯‘ä¸º WebAssembly,è€Œä¸æ˜¯æœºå™¨çš„æœ¬æœºä»£ç . æ‚¨å¯ä»¥é€šè¿‡æ·»åŠ <code>wasm32-unknown-unknown</code>æ¥å¯ç”¨æ­¤åŠŸèƒ½,ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œç›®æ ‡:</p>
<pre><code>rustup update
rustup install nightly
rustup target add wasm32-unknown-unknown --toolchain nightly
</code></pre>
<a class="header" href="print.html#npm" id="npm"><h2><code>npm</code></h2></a>
<p><code>npm</code>æ˜¯ JavaScriptçš„åŒ…ç®¡ç†å™¨. æˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥å®‰è£…å’Œè¿è¡Œ JavaScriptæ†ç»‘å™¨ å’Œ å¼€å‘æœåŠ¡å™¨. åœ¨æœ¬æ•™ç¨‹ç»“æŸæ—¶,æˆ‘ä»¬å°†å‘å¸ƒæˆ‘ä»¬ç¼–è¯‘çš„<code>.wasm</code>åˆ°äº†<code>npm</code>æ³¨å†Œè¡¨ä¸­.</p>
<p><a href="https://www.npmjs.com/get-npm">è¯·æŒ‰ç…§ä»¥ä¸‹è¯´æ˜è¿›è¡Œå®‰è£…<code>npm</code>. </a></p>
<a class="header" href="print.html#wasm-bindgen" id="wasm-bindgen"><h2><code>wasm-bindgen</code></h2></a>
<p><a href="https://github.com/rustwasm/wasm-bindgen"><code>wasm-bindgen</code></a>ä¸º Rustå’ŒWebAssembly ç”Ÿæˆä¸ JavaScript çš„åŒå‘ç»‘å®š.</p>
<p>å®‰è£…<code>wasm-bindgen</code>ä½¿ç”¨æ­¤å‘½ä»¤:</p>
<pre><code>cargo +nightly install wasm-bindgen-cli
</code></pre>
<a class="header" href="print.html#aä½ å¥½-ä¸–ç•Œ" id="aä½ å¥½-ä¸–ç•Œ"><h2>ä½ å¥½, ä¸–ç•Œ!</h2></a>
<p>è¿™ä¸ªç« èŠ‚è®²è¿°çš„æ˜¯å¦‚ä½•æ„å»ºä¸è¿è¡Œä½ çš„ç¬¬ä¸€ä¸ª Rust å’Œ WebAssembly ç¨‹åº: å¯è¿è¡Œ <code>alert('Hello, World!')</code> å‡½æ•°çš„ç½‘é¡µ</p>
<a class="header" href="print.html#aå…‹éš†é¡¹ç›®æ¨¡æ¿" id="aå…‹éš†é¡¹ç›®æ¨¡æ¿"><h2>å…‹éš†é¡¹ç›®æ¨¡æ¿</h2></a>
<p>é¡¹ç›®æ¨¡æ¿åŒ…å«ä¸€ä¸ª&quot;hello world&quot;ç¨‹åº. å®ƒé¢„å…ˆé…ç½®äº†é»˜è®¤çš„é»˜è®¤è®¾ç½®,å› æ­¤æ‚¨å¯ä»¥å¿«é€Ÿæ„å»º,é›†æˆå’Œæ‰“åŒ…Webä»£ç .</p>
<p>å…‹éš†æ­¤æ•™ç¨‹ä»£ç å­˜å‚¨åº“,è¾“å…¥å…¶ç›®å½•,ç„¶å checkout <code>chapter-zero</code> branch:</p>
<pre><code class="language-text">git clone https://github.com/rustwasm/wasm_game_of_life.git
cd ./wasm_game_of_life
git checkout -b chapter-zero origin/chapter-zero
</code></pre>
<a class="header" href="print.html#aé‡Œé¢æœ‰ä»€ä¹ˆ" id="aé‡Œé¢æœ‰ä»€ä¹ˆ"><h2>é‡Œé¢æœ‰ä»€ä¹ˆ</h2></a>
<p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹æˆ‘ä»¬é¡¹ç›®çš„å†…å®¹:</p>
<pre><code class="language-text">.
â”œâ”€â”€ bootstrap.js
â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ index.html
â”œâ”€â”€ index.js
â”œâ”€â”€ package.json
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ src
â”‚Â Â  â””â”€â”€ lib.rs
â””â”€â”€ webpack.config.js
</code></pre>
<p>å…¶ä¸­å¤§å¤šæ•°æ˜¯é…ç½®æ–‡ä»¶,ä½†æˆ‘ä»¬åº”è¯¥çªå‡ºæ˜¾ç¤ºä¸€äº›æ–‡ä»¶.</p>
<a class="header" href="print.html#indexhtml" id="indexhtml"><h3><code>index.html</code></h3></a>
<p>è¿™æ˜¯ç½‘é¡µçš„æ ¹HTMLæ–‡ä»¶. å®ƒé™¤äº†åŠ è½½<code>bootstrap.js</code>ä¹‹å¤–æ²¡æœ‰å…¶ä»–ä½œç”¨,è¿™æ˜¯ä¸€ä¸ªéå¸¸è–„çš„<code>index.js</code>åŒ…è£….</p>
<pre><code class="language-html">&lt;html&gt;
    &lt;head&gt;
        &lt;meta content=&quot;text/html;charset=utf-8&quot; http-equiv=&quot;Content-Type&quot;/&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;script src='./bootstrap.js'&gt;&lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<a class="header" href="print.html#indexjs" id="indexjs"><h3><code>index.js</code></h3></a>
<p>è¯¥<code>index.js</code>æ˜¯æˆ‘ä»¬ç½‘é¡µçš„ JavaScript çš„ä¸»è¦å…¥å£ç‚¹. å®ƒå¯¼å…¥é¡¹ç›®çš„WebAssemblyæ¨¡å—,å¹¶è°ƒç”¨æ¨¡å—<code>greet</code>å‡½æ•°.</p>
<pre><code class="language-js">import { greet } from &quot;./wasm_game_of_life&quot;;

greet(&quot;Rust and WebAssembly&quot;);
</code></pre>
<a class="header" href="print.html#srclibrs" id="srclibrs"><h3><code>src/lib.rs</code></h3></a>
<p>è¯¥<code>src/lib.rs</code>æ–‡ä»¶æ˜¯æˆ‘ä»¬æ­£åœ¨ç¼–è¯‘åˆ° WebAssemblyçš„RuståŒ… çš„æ ¹. å®ƒç”¨<code>wasm_bindgen</code>ä¸ JavaScriptäº¤äº’. å®ƒå¯¼å…¥äº†<code>window.alert</code> - JavaScriptå‡½æ•°,å¹¶å¯¼å‡º<code>greet</code>rustå‡½æ•°,å‡½æ•°éœ€è¦ä¸€ä¸ª<code>name</code>å‚æ•°ä»¥ä¾¿ ä¼ é€’ç»™<code>alert</code>å‡½æ•°ä½¿ç”¨.</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#![feature(use_extern_macros)]

#fn main() {
extern crate wasm_bindgen;

use wasm_bindgen::prelude::*;

#[wasm_bindgen]
extern {
    fn alert(s: &amp;str);
}

#[wasm_bindgen]
pub fn greet(name: &amp;str) {
    alert(&amp;format!(&quot;Hello, {}!&quot;, name));
}
#}</code></pre></pre>
<a class="header" href="print.html#aæ„å»ºä¸å¯åŠ¨æœåŠ¡å™¨" id="aæ„å»ºä¸å¯åŠ¨æœåŠ¡å™¨"><h2>æ„å»ºä¸å¯åŠ¨æœåŠ¡å™¨</h2></a>
<p>é¦–å…ˆ,ç¡®ä¿ä¸ºæ­¤é¡¹ç›®å®‰è£…äº†JavaScriptæ„å»ºä¾èµ–é¡¹:</p>
<pre><code class="language-text">npm install
</code></pre>
<p>æ­¤å‘½ä»¤åªéœ€è¿è¡Œä¸€æ¬¡,å¹¶å°†å®‰è£…<code>webpack</code> - JavaScript bundleråŠå…¶å¼€å‘æœåŠ¡å™¨. æ³¨æ„:ä½¿ç”¨<code>webpack</code>å¯¹ Rustå’ŒWebAssembly æ¥è¯´ä¸æ˜¯å¿…éœ€çš„,å®ƒåªæ˜¯æˆ‘ä»¬ä¸ºæ–¹ä¾¿èµ·è§è€Œé€‰æ‹©çš„æ†ç»‘å™¨å’Œå¼€å‘æœåŠ¡å™¨.</p>
<p>æ„å»º Rust crate{ğŸ“¦} ä¸º WebAssembly å¹¶ç”Ÿæˆ<code>wasm_bindgen</code>èƒ¶æ°´,è¿è¡Œæ­¤å‘½ä»¤:</p>
<pre><code class="language-text">npm run build-debug
</code></pre>
<p>ç¬¬ä¸€ä¸ªæ„å»ºå¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´,å› ä¸ºéœ€è¦ç¼–è¯‘ä¾èµ–é¡¹. ä½†ä¸è¦æ‹…å¿ƒ: åç»­æ„å»º,å½“ä¾èµ–å…³ç³»ä¸éœ€è¦é‡æ–°ç¼–è¯‘æ—¶,å°†ä¼šå¿«å¾—å¤š.</p>
<p>å‘½ä»¤ä¼šåˆ›å»º Rust cratesçš„&quot;debug&quot;ç‰ˆæœ¬: æœªä¼˜åŒ–åº”ç”¨çš„æ„å»º,å¹¶åŒ…å«ç¬¦å·ä»¥ä¾¿åœ¨æµè§ˆå™¨çš„å¼€å‘äººå‘˜å·¥å…·ä¸­è¿›è¡Œæ›´å¥½çš„è°ƒè¯•. æ‚¨è¿˜å¯ä»¥åˆ›å»ºä¸€ä¸ª&quot;å‘å¸ƒ-release&quot;ç‰ˆæœ¬,è¯¥ç‰ˆæœ¬æœ‰ä¼˜åŒ–åº”ç”¨çš„è¿‡ç¨‹:</p>
<pre><code>npm run build-release
</code></pre>
<p>è¿™æ˜¯æˆ‘ä»¬æƒ³è¦ç”¨æ¥åˆ›å»º, ç”¨äºåˆ†æå’Œéƒ¨ç½²åˆ°ç”Ÿäº§çš„<code>.wasm</code>äºŒè¿›åˆ¶æ–‡ä»¶çš„å‘½ä»¤.</p>
<p>æ¥ä¸‹æ¥,ä¸ºå¼€å‘æœåŠ¡å™¨æ‰“å¼€ä¸€ä¸ªæ–°ç»ˆç«¯. åœ¨æ–°ç»ˆç«¯ä¸­è¿è¡ŒæœåŠ¡å™¨è®©æˆ‘ä»¬è®©å®ƒåœ¨åå°è¿è¡Œ,å¹¶ä¸”ä¸ä¼šé˜»æ­¢æˆ‘ä»¬åœ¨æ­¤æœŸé—´è¿è¡Œå…¶ä»–å‘½ä»¤. åœ¨æ–°ç»ˆç«¯ä¸­,è¿è¡Œä»¥ä¸‹å‘½ä»¤:</p>
<pre><code>npm run serve
</code></pre>
<p>æµè§ˆWebæµè§ˆå™¨<a href="http://localhost:8080/">http://localhost:8080/)</a>ä½ åº”è¯¥æ”¶åˆ°ä¸€æ¡ <code>alert</code> ä¿¡æ¯:</p>
<p><a href="./images/game-of-life/setup.png"><img src="./images/game-of-life/setup.png" alt="Screenshot of the &quot;Hello, Rust and WebAssembly!&quot; Web page alert" /></a></p>
<p>ä»»ä½•æ—¶å€™ä½ åšå‡ºæ”¹å˜,å¹¶å¸Œæœ›å®ƒä»¬åæ˜ åˆ°<a href="http://localhost:8080/">http://localhost:8080/)</a>,åªæ˜¯é‡æ–°è¿è¡Œ<code>npm run build-debug</code>å‘½ä»¤.</p>
<a class="header" href="print.html#aç»ƒä¹ " id="aç»ƒä¹ "><h2>ç»ƒä¹ </h2></a>
<ul>
<li>ä¿®æ”¹<code>index.js</code>ç”¨ä½ çš„åå­—è€Œä¸æ˜¯&quot;Rustå’ŒWebAssembly&quot;æ¥ è¿è¡Œ <code>alert</code>å‡½æ•°. </li>
</ul>
<a class="header" href="print.html#aåº·å¨ç”Ÿå‘½æ¸¸æˆè§„åˆ™" id="aåº·å¨ç”Ÿå‘½æ¸¸æˆè§„åˆ™"><h1>åº·å¨ç”Ÿå‘½æ¸¸æˆè§„åˆ™</h1></a>
<p><em>æ³¨æ„: å¦‚æœæ‚¨å·²ç†Ÿæ‚‰åº·å¨çš„ç”Ÿå‘½æ¸¸æˆåŠå…¶è§„åˆ™,è¯·è·³åˆ°ä¸‹ä¸€éƒ¨åˆ†!</em></p>
<p><a href="https://zh.wikipedia.org/wiki/%E5%BA%B7%E5%A8%81%E7%94%9F%E5%91%BD%E6%B8%B8%E6%88%8F">ç»´åŸºç™¾ç§‘å¯¹ åº·å¨çš„ç”Ÿå‘½æ¸¸æˆè§„åˆ™ è¿›è¡Œäº†å¾ˆå¥½çš„æè¿°: </a></p>
<blockquote>
<p>ç”Ÿå‘½æ¸¸æˆçš„å®‡å®™æ˜¯æ–¹å½¢å•å…ƒçš„æ— é™äºŒç»´æ­£äº¤ç½‘æ ¼,æ¯ä¸ªæ–¹æ ¼å•å…ƒå¤„äºä¸¤ç§å¯èƒ½çŠ¶æ€ä¹‹ä¸€,æ´»ç€æˆ–æ­»äº¡,æˆ–&quot;å¡«å……&quot;æˆ–&quot;æœªå¡«å……&quot;. æ¯ä¸ªç»†èƒä¸å…¶å…«ä¸ªé‚»å±…ç›¸äº’ä½œç”¨ - è¿™å…«ä¸ªé‚»å±…æ˜¯æ°´å¹³,å‚ç›´æˆ–å¯¹è§’ç›¸é‚»çš„ç»†èƒ. åœ¨æ¯ä¸ªæ­¥éª¤ä¸­,å‘ç”Ÿä»¥ä¸‹è½¬æ¢:</p>
<ol>
<li>å½“å‰ç»†èƒä¸ºå­˜æ´»çŠ¶æ€æ—¶ï¼Œå½“å‘¨å›´ä½äº2ä¸ªï¼ˆä¸åŒ…å«2ä¸ªï¼‰å­˜æ´»ç»†èƒæ—¶ï¼Œ è¯¥ç»†èƒå˜æˆæ­»äº¡çŠ¶æ€ã€‚ï¼ˆæ¨¡æ‹Ÿç”Ÿå‘½æ•°é‡ç¨€å°‘ï¼‰</li>
<li>å½“å‰ç»†èƒä¸ºå­˜æ´»çŠ¶æ€æ—¶ï¼Œå½“å‘¨å›´æœ‰2ä¸ªæˆ–3ä¸ªå­˜æ´»ç»†èƒæ—¶ï¼Œ è¯¥ç»†èƒä¿æŒåŸæ ·ã€‚</li>
<li>å½“å‰ç»†èƒä¸ºå­˜æ´»çŠ¶æ€æ—¶ï¼Œå½“å‘¨å›´æœ‰3ä¸ªä»¥ä¸Šçš„å­˜æ´»ç»†èƒæ—¶ï¼Œè¯¥ç»†èƒå˜æˆæ­»äº¡çŠ¶æ€ã€‚ï¼ˆæ¨¡æ‹Ÿç”Ÿå‘½æ•°é‡è¿‡å¤šï¼‰</li>
<li>å½“å‰ç»†èƒä¸ºæ­»äº¡çŠ¶æ€æ—¶ï¼Œå½“å‘¨å›´æœ‰3ä¸ªå­˜æ´»ç»†èƒæ—¶ï¼Œè¯¥ç»†èƒå˜æˆå­˜æ´»çŠ¶æ€ã€‚ ï¼ˆæ¨¡æ‹Ÿç¹æ®–ï¼‰</li>
</ol>
</blockquote>
<blockquote>
<p>å¯ä»¥æŠŠæœ€åˆçš„ç»†èƒç»“æ„å®šä¹‰ä¸ºç§å­ï¼Œå½“æ‰€æœ‰åœ¨ç§å­ä¸­çš„ç»†èƒåŒæ—¶è¢«ä»¥ä¸Šè§„åˆ™å¤„ç†å, å¯ä»¥å¾—åˆ°ç¬¬ä¸€ä»£ç»†èƒå›¾ã€‚æŒ‰è§„åˆ™ç»§ç»­å¤„ç†å½“å‰çš„ç»†èƒå›¾ï¼Œå¯ä»¥å¾—åˆ°ä¸‹ä¸€ä»£çš„ç»†èƒå›¾ï¼Œå‘¨è€Œå¤å§‹ã€‚</p>
</blockquote>
<p>è€ƒè™‘ä»¥ä¸‹åˆå§‹ Universe:</p>
<p><img src='./images/game-of-life/initial-universe.png' alt='Initial Universe' width="80" /></p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è€ƒè™‘æ¯ä¸ªå•å…ƒæ¥è®¡ç®—ä¸‹ä¸€ä»£. å·¦ä¸Šè§’çš„å•å…ƒæ ¼å·²ç»æ­»äº†. è§„åˆ™ (4) æ˜¯é€‚ç”¨äºæ­»ç»†èƒçš„å”¯ä¸€è½¬æ¢è§„åˆ™. ä½†æ˜¯,å› ä¸ºå·¦ä¸Šè§’çš„å•å…ƒæ ¼æ²¡æœ‰æ­£å¥½ä¸‰ä¸ªæ´»åŠ¨é‚»å±…,æ‰€ä»¥è½¬æ¢è§„åˆ™ä¸é€‚ç”¨,å¹¶ä¸”å®ƒåœ¨ä¸‹ä¸€ä»£ä¸­ä»ç„¶ä¸å­˜åœ¨. å¯¹äº ç¬¬ä¸€è¡Œ ä¸­çš„æ¯ä¸ªå…¶ä»–å•å…ƒä¹Ÿæ˜¯å¦‚æ­¤.</p>
<p>å½“æˆ‘ä»¬è€ƒè™‘ç¬¬äºŒåˆ—,ç¬¬ä¸‰åˆ—ä¸­çš„æ´»ç»†èƒæ—¶,äº‹æƒ…å˜å¾—æœ‰è¶£. å¯¹äºæ´»ç»†èƒ,å‰ä¸‰ä¸ªè§„åˆ™ä¸­çš„ä»»ä½•ä¸€ä¸ªéƒ½å¯èƒ½é€‚ç”¨. åœ¨è¿™ä¸ªé»‘å•å…ƒçš„æƒ…å†µä¸‹,å®ƒåªæœ‰ä¸‹é¢ä¸€ä¸ªæ´»çš„é‚»å±…,å› æ­¤è§„åˆ™ (1) é€‚ç”¨: è¿™ä¸ªå•å…ƒå°†åœ¨ä¸‹ä¸€ä»£ä¸­æ­»äº¡. åŒæ ·çš„å‘½è¿ä¹Ÿå¯¹åº”ç€æœ€ä¸‹é¢çš„æ´»é»‘ç»†èƒ.</p>
<p>ä¸­é—´æ´»ç»†èƒæœ‰ä¸¤ä¸ªæ´»çš„é‚»å±…: é¡¶éƒ¨å’Œåº•éƒ¨æ´»ç»†èƒ. è¿™æ„å‘³ç€è§„åˆ™ (2) é€‚ç”¨,å¹¶ä¸”å®ƒä»ç„¶å­˜åœ¨äºä¸‹ä¸€ä»£.</p>
<p>æœ€åæœ‰è¶£çš„æ¡ˆä¾‹æ˜¯ä¸­é—´æ´»ç»†èƒå·¦ä¾§å’Œå³ä¾§çš„æ­»ç»†èƒ. è¿™ä¸‰ä¸ªæ´»ç»†èƒéƒ½æ˜¯è¿™äº›ç»†èƒçš„é‚»å±…,è¿™æ„å‘³ç€è§„åˆ™ (4) é€‚ç”¨,å¹¶ä¸”è¿™äº›ç»†èƒå°†åœ¨ä¸‹ä¸€ä»£ä¸­å­˜æ´».</p>
<p>æŠŠå®ƒä»¬æ”¾åœ¨ä¸€èµ·,æˆ‘ä»¬åœ¨ä¸‹ä¸€ä¸ªæ»´ç­”ä¹‹åå¾—åˆ°è¿™ä¸ªå®‡å®™:</p>
<p><img src='./images/game-of-life/next-universe.png' alt='Next Universe' width=80 /></p>
<p>ä»è¿™äº›ç®€å•çš„,ç¡®å®šæ€§çš„è§„åˆ™å‡ºç°,å¥‡æ€ªå’Œä»¤äººå…´å¥‹çš„è¡Œä¸ºå‡ºç°äº†:</p>
<table><thead><tr><th> Gosperçš„æ»‘ç¿”æœºæª                                                                                        </th><th> è„‰å†²æ˜Ÿ                                                                                    </th><th> å¤ªç©ºé£èˆ¹                                                                                                         </th></tr></thead><tbody>
<tr><td> <img src="https://upload.wikimedia.org/wikipedia/commons/e/e5/Gospers_glider_gun.gif" alt="Gosper's glider gun" /> </td><td> <img src="https://upload.wikimedia.org/wikipedia/commons/0/07/Game_of_life_pulsar.gif" alt="Pulsar" /> </td><td> <img src="https://upload.wikimedia.org/wikipedia/commons/3/37/Game_of_life_animated_LWSS.gif" alt="Lighweight space ship" /> </td></tr>
</tbody></table>
<p><center></p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/C2vgICfQawE?rel=0&amp;start=65" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
</center>
<a class="header" href="print.html#aç»ƒä¹ -1" id="aç»ƒä¹ -1"><h2>ç»ƒä¹ </h2></a>
<ul>
<li>
<p>æ‰‹åŠ¨è®¡ç®—æˆ‘ä»¬çš„ç¤ºä¾‹ Universeçš„ä¸‹ä¸€ä¸ªæ»´ç­”. æ³¨æ„åƒä»€ä¹ˆ?</p>
</li>
<li>
<p>ä½ èƒ½æ‰¾åˆ°ä¸€ä¸ªç¨³å®šçš„åˆå§‹å®‡å®™å—? ä¹Ÿå°±æ˜¯è¯´,æ¯ä¸€ä»£äººéƒ½æ˜¯ä¸€æ ·çš„å®‡å®™.</p>
</li>
</ul>
<a class="header" href="print.html#aå®æ–½åº·å¨çš„ç”Ÿå‘½æ¸¸æˆ" id="aå®æ–½åº·å¨çš„ç”Ÿå‘½æ¸¸æˆ"><h1>å®æ–½åº·å¨çš„ç”Ÿå‘½æ¸¸æˆ</h1></a>
<a class="header" href="print.html#aè®¾è®¡" id="aè®¾è®¡"><h2>è®¾è®¡</h2></a>
<p>åœ¨æˆ‘ä»¬æ·±å…¥ä¹‹å‰,æˆ‘ä»¬æœ‰ä¸€äº›è®¾è®¡é€‰æ‹©éœ€è¦è€ƒè™‘.</p>
<a class="header" href="print.html#aæ— é™çš„å®‡å®™" id="aæ— é™çš„å®‡å®™"><h3>æ— é™çš„å®‡å®™</h3></a>
<p>ç”Ÿå‘½æ¸¸æˆæ˜¯åœ¨æ— é™çš„å®‡å®™ä¸­è¿›è¡Œçš„,ä½†æˆ‘ä»¬æ²¡æœ‰æ— é™çš„è®°å¿†å’Œè®¡ç®—èƒ½åŠ›. è§£å†³è¿™ä¸ªç›¸å½“æ¼äººçš„é™åˆ¶é€šå¸¸æœ‰ä»¥ä¸‹ä¸‰ç§é£æ ¼ä¹‹ä¸€:</p>
<ol>
<li>
<p>è·Ÿè¸ªå®‡å®™çš„å“ªä¸ªå­é›†å‘ç”Ÿäº†æœ‰è¶£çš„äº‹æƒ…,å¹¶æ ¹æ®éœ€è¦,æ‰©å±•æ­¤åŒºåŸŸ. åœ¨æœ€åçš„æƒ…å†µä¸‹,è¿™ç§æ‰©å±•æ˜¯æ— é™åˆ¶çš„,å®ç°å°†å˜å¾—è¶Šæ¥è¶Šæ…¢,æœ€ç»ˆè€—å°½å†…å­˜.</p>
</li>
<li>
<p>åˆ›å»ºå›ºå®šå¤§å°çš„ Universeï¼Œè¾¹ç¼˜ä¸Šçš„å•å…ƒæ ¼å…·æœ‰è¾ƒå°‘çš„é‚»å±…
æ¯”ä¸­é—´çš„ç»†èƒã€‚ è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹æ˜¯æ— é™
åƒæ»‘ç¿”æœºä¸€æ ·åˆ°è¾¾å®‡å®™å°½å¤´çš„æ¨¡å¼è¢«æ‰¼æ€äº†ã€‚</p>
</li>
<li>
<p>åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„å‘¨æœŸæ€§ Universe <code>ç§»åŠ¨</code>,å…¶ä¸­è¾¹ç¼˜ä¸Šçš„å•å…ƒæ ¼å…·æœ‰ç¯ç»•åˆ° Universe å¦ä¸€ä¾§çš„é‚»å±…. å› ä¸ºé‚»å±…ç¯ç»•å®‡å®™çš„è¾¹ç¼˜,æ»‘ç¿”æœºå¯ä»¥æ°¸è¿œè¿è¡Œ.</p>
</li>
</ol>
<p>æˆ‘ä»¬å°†å®æ–½<code>ç¬¬ä¸‰ç§</code>é€‰æ‹©.</p>
<a class="header" href="print.html#aè¿æ¥-rust-å’Œ-javascript" id="aè¿æ¥-rust-å’Œ-javascript"><h3>è¿æ¥ Rust å’Œ JavaScript</h3></a>
<blockquote>
<p>âš¡ è¿™æ˜¯ç†è§£å’Œä»æœ¬æ•™ç¨‹ä¸­ä½ è·å–çš„æœ€é‡è¦çš„æ¦‚å¿µä¹‹ä¸€!</p>
</blockquote>
<p>JavaScript çš„åƒåœ¾æ”¶é›†å † - <code>Object</code>,<code>Array</code>å’Œ DOM èŠ‚ç‚¹ è¢«åˆ†é… - ä¸åŒäº WebAssembly çš„çº¿æ€§å†…å­˜ç©ºé—´,æˆ‘ä»¬çš„ Rust å€¼ å­˜åœ¨äºå…¶ä¸­. WebAssembly ç›®å‰æ— æ³•ç›´æ¥è®¿é—®åƒåœ¾æ”¶é›†å † (æˆªè‡³ 2018 å¹´ 4 æœˆ,é¢„è®¡ä¼šéšä¹‹æ”¹å˜<a href="https://github.com/WebAssembly/host-bindings/blob/master/proposals/host-bindings/Overview.md">&quot;ä¸»æœºç»‘å®š host-bindings&quot;ææ¡ˆ</a>) . å¦ä¸€æ–¹é¢,JavaScript å¯ä»¥è¯»å–å’Œå†™å…¥ WebAssembly çº¿æ€§å­˜å‚¨ç©ºé—´,ä½†ä»…ä½œä¸ºä¸€ä¸ª<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code>ArrayBuffer</code></a>æ ‡é‡å€¼ (<code>u8</code>,<code>i32</code>,<code>f64</code>ç­‰ç­‰......) WebAssembly å‡½æ•°ä¹Ÿæ¥å—,å¹¶è¿”å›æ ‡é‡å€¼. è¿™äº›æ˜¯æ„æˆ WebAssembly å’Œ JavaScript é€šä¿¡ çš„æ‰€æœ‰æ„å»ºå—.</p>
<p><code>wasm_bindgen</code>å®šä¹‰äº†å¦‚ä½•åœ¨è¿™ä¸ªè¾¹ç•Œä¸Š,ä½¿ç”¨å¤åˆç»“æ„çš„å…±åŒç†è§£. å®ƒæ¶‰åŠè£…ç®± Rust ç»“æ„,å°†æŒ‡é’ˆåŒ…è£…åœ¨ JavaScript ç±» ä¸­ä»¥å®ç°å¯ç”¨æ€§,æˆ–è€… ç´¢å¼•åˆ° Rust ä¸­çš„ JavaScript å¯¹è±¡è¡¨. <code>wasm_bindgen</code>éå¸¸æ–¹ä¾¿,ä½†å®ƒä¸éœ€è¦è€ƒè™‘æˆ‘ä»¬çš„æ•°æ®è¡¨ç¤º,ä»¥åŠè·¨è¶Šè¿™ä¸ªè¾¹ç•Œä¼ é€’ä»€ä¹ˆå€¼å’Œç»“æ„. ç›¸å,å°†å…¶è§†ä¸ºå®ç°æ‚¨é€‰æ‹©çš„æ¥å£è®¾è®¡çš„å·¥å…·.</p>
<p>åœ¨è®¾è®¡ WebAssembly å’Œ JavaScript ä¹‹é—´çš„æ¥å£æ—¶,æˆ‘ä»¬å¸Œæœ›é’ˆå¯¹ä»¥ä¸‹å±æ€§è¿›è¡Œä¼˜åŒ–:</p>
<ol>
<li>
<p>**æœ€å°åŒ–å¤åˆ¶ WebAssembly çº¿æ€§å­˜å‚¨å™¨çš„ è¿›/å‡º .**ä¸å¿…è¦çš„å‰¯æœ¬ä¼šäº§ç”Ÿä¸å¿…è¦çš„å¼€é”€.</p>
</li>
<li>
<p>**æœ€å°åŒ–åºåˆ—åŒ–å’Œååºåˆ—åŒ–.**ä¸å‰¯æœ¬ç±»ä¼¼,åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä¹Ÿä¼šäº§ç”Ÿå¼€é”€,å¹¶ä¸”é€šå¸¸ä¹Ÿä¼šè¿›è¡Œå¤åˆ¶. å¦‚æœæˆ‘ä»¬å¯ä»¥å°†ä¸é€æ˜æ§åˆ¶ä¼ é€’ç»™æ•°æ®ç»“æ„ - è€Œä¸æ˜¯ä¸€ä¾§åºåˆ—åŒ–å,å°†å…¶å¤åˆ¶åˆ° WebAssembly çº¿æ€§å­˜å‚¨å™¨ä¸­çš„æŸä¸ªå·²çŸ¥ä½ç½®,å¹¶åœ¨å¦ä¸€ä¾§è¿›è¡Œååºåˆ—åŒ– - æˆ‘ä»¬é€šå¸¸å¯ä»¥å‡å°‘å¤§é‡å¼€é”€. <code>wasm_bindgen</code>å¸®åŠ©æˆ‘ä»¬ å®šä¹‰å’Œä½¿ç”¨ JavaScript çš„ä¸é€æ˜æ§åˆ¶<code>Object</code>æˆ– ç›’è£… Rust ç»“æ„.</p>
</li>
</ol>
<p>ä½œä¸ºä¸€èˆ¬çš„ç»éªŒæ³•åˆ™,ä¸€ä¸ªå¥½çš„ JavaScriptâ†”WebAssembly æ¥å£è®¾è®¡é€šå¸¸æ˜¯å°†å¤§å‹,é•¿å¯¿å‘½çš„æ•°æ®ç»“æ„å®ç°ä¸º ç”Ÿæ´»åœ¨ WebAssembly çº¿æ€§å†…å­˜ ä¸­çš„ Rust ç±»å‹,å¹¶ä½œä¸ºä¸é€æ˜æ§åˆ¶æš´éœ²ç»™ JavaScript. JavaScript è°ƒç”¨å¯¼å‡ºçš„ WebAssembly å‡½æ•°,è¿™äº›å‡½æ•°æ¥å—è¿™äº›ä¸é€æ˜çš„æ§åˆ¶,è½¬æ¢æ•°æ®,æ‰§è¡Œç¹é‡çš„è®¡ç®—,æŸ¥è¯¢æ•°æ®,æœ€ç»ˆè¿”å›ä¸€ä¸ªå°çš„å¯å¤åˆ¶ç»“æœ. é€šè¿‡ä»…è¿”å›è®¡ç®—çš„å°ç»“æœ,æˆ‘ä»¬é¿å…åœ¨ JavaScript åƒåœ¾æ”¶é›†å †å’Œ WebAssembly çº¿æ€§å­˜å‚¨å™¨ ä¹‹é—´,æ¥å›å¤åˆ¶å’Œåºåˆ—åŒ–æ‰€æœ‰å†…å®¹.</p>
<a class="header" href="print.html#aåœ¨æˆ‘ä»¬çš„ç”Ÿå‘½æ¸¸æˆä¸­è¿æ¥-rust-å’Œ-javascript" id="aåœ¨æˆ‘ä»¬çš„ç”Ÿå‘½æ¸¸æˆä¸­è¿æ¥-rust-å’Œ-javascript"><h3>åœ¨æˆ‘ä»¬çš„ç”Ÿå‘½æ¸¸æˆä¸­è¿æ¥ Rust å’Œ JavaScript</h3></a>
<p>è®©æˆ‘ä»¬é¦–å…ˆåˆ—ä¸¾ä¸€äº›è¦é¿å…çš„å±é™©. æˆ‘ä»¬ä¸å¸Œæœ›åœ¨æ¯ä¸ª<code>tick</code>ä¸Šå°†æ•´ä¸ª Universe å¤åˆ¶åˆ° WebAssembly çº¿æ€§å†…å­˜ ä¸­. æˆ‘ä»¬ä¸å¸Œæœ›ä¸ºå®‡å®™ä¸­çš„æ¯ä¸ªå•å…ƒåˆ†é…å¯¹è±¡,ä¹Ÿä¸æƒ³å¼ºåŠ å‡½æ•°è°ƒç”¨æ¥è¯»å†™æ¯ä¸ªå•å…ƒ.</p>
<p>è¿™ç»™æˆ‘ä»¬ç•™ä¸‹äº†ä»€ä¹ˆ? æˆ‘ä»¬å¯ä»¥å°† Universe è¡¨ç¤ºä¸ºä½äº WebAssembly çº¿æ€§å†…å­˜ä¸­çš„å¹³é¢æ•°ç»„,å¹¶ä¸”æ¯ä¸ªå•å…ƒæ ¼éƒ½æœ‰ä¸€ä¸ªå­—èŠ‚. <code>0</code>æ˜¯ä¸€ä¸ªæ­»ç»†èƒ,<code>1</code>æ˜¯ä¸€ä¸ªæ´»ç»†èƒ.</p>
<p>ä»¥ä¸‹æ˜¯ 4 x 4 å®‡å®™åœ¨å†…å­˜ä¸­çš„æ ·å­:</p>
<p><img src="./images/game-of-life/universe.png" alt="Screenshot of a 4 by 4 universe" /></p>
<p>è¦åœ¨ Universe ä¸­çš„ç»™å®šè¡Œå’Œåˆ—ä¸­æŸ¥æ‰¾å•å…ƒæ ¼çš„æ•°ç»„ç´¢å¼•,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å…¬å¼:</p>
<pre><code class="language-text">index(row, column, universe) = row * width(universe) + column
</code></pre>
<p>æˆ‘ä»¬æœ‰å‡ ç§æ–¹æ³•å¯ä»¥å°† Universe çš„å•å…ƒæ ¼æš´éœ²ç»™ JavaScript. é¦–å…ˆ,æˆ‘ä»¬æ·»åŠ å®æ–½<a href="https://doc.rust-lang.org/1.25.0/std/fmt/trait.Display.html"><code>std::fmt::Display</code></a>åˆ°<code>Universe</code>,æˆ‘ä»¬å¯ä»¥ç”¨æ¥å±•ç¤º ä¸€ä¸ª Rust<code>String</code> å‘ˆç°ä¸ºæ–‡æœ¬å­—ç¬¦çš„å•å…ƒæ ¼. ç„¶åå°†æ­¤ Rust String ä» WebAssembly çº¿æ€§å†…å­˜ å¤åˆ¶åˆ° JavaScript çš„åƒåœ¾å›æ”¶å †ä¸­ çš„ JavaScript String ä¸­,ç„¶åé€šè¿‡è®¾ç½®<code>HTML</code>æ˜¾ç¤º<code>textContent</code>. åœ¨æœ¬ç« çš„åé¢,æˆ‘ä»¬å°†æ¨æ¼”è¿™ä¸ªå®ç°,ä»¥é¿å…åœ¨å †ä¹‹é—´å¤åˆ¶ Universe çš„å•å…ƒæ ¼,å†æ¸²æŸ“<code>&lt;canvas&gt;</code>.</p>
<p><em>å¦ä¸€ä¸ªå¯è¡Œçš„è®¾è®¡æ›¿ä»£æ–¹æ¡ˆæ˜¯ Rust è¿”å›æ¯ä¸ªæ»´ç­”å,æ›´æ”¹çŠ¶æ€çš„æ¯ä¸ªå•å…ƒæ ¼çš„åˆ—è¡¨,è€Œä¸æ˜¯å°†æ•´ä¸ª Universe æš´éœ²ç»™ JavaScript. è¿™æ ·,JavaScript åœ¨æ¸²æŸ“æ—¶ä¸éœ€è¦éå†æ•´ä¸ª Universe ,åªéœ€è¦ç›¸å…³çš„å­é›†. æƒè¡¡çš„é—®é¢˜æ˜¯è¿™ç§ åŸºäº delta çš„è®¾è®¡å®æ–½èµ·æ¥ç¨å¾®å›°éš¾ä¸€äº›.</em></p>
<a class="header" href="print.html#rust-å®ç°" id="rust-å®ç°"><h2>Rust å®ç°</h2></a>
<p>åœ¨ä¸Šä¸€ç« ä¸­,æˆ‘ä»¬å…‹éš†äº†ä¸€ä¸ªåˆå§‹é¡¹ç›®æ¨¡æ¿. æˆ‘ä»¬ç°åœ¨å°†ä¿®æ”¹è¯¥é¡¹ç›®æ¨¡æ¿.</p>
<p>è®©æˆ‘ä»¬å¼€å§‹åˆ é™¤ <code>alert</code> import å’Œ<code>greet</code> å‡½æ•° - <code>src/lib.rs</code>, å¹¶ç”¨å•å…ƒæ ¼çš„ç±»å‹å®šä¹‰æ›¿æ¢å®ƒä»¬:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
#[repr(u8)]
#[derive(Clone, Copy, Debug, PartialEq, Eq)]
pub enum Cell {
    Dead = 0,
    Alive = 1,
}
#}</code></pre></pre>
<p>é‡è¦çš„æ˜¯æˆ‘ä»¬æ‹¥æœ‰<code>#[repr(u8)]</code>,ä»¥ä¾¿æ¯ä¸ªå•å…ƒæ ¼è¡¨ç¤ºä¸ºå•ä¸ªå­—èŠ‚. åŒæ ·é‡è¦çš„æ˜¯<code>Dead</code>ä»£è¡¨<code>0</code>,é‚£ä¸ª<code>Alive</code>æ˜¯<code>1</code>,è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è½»æ¾åœ°è®¡ç®—ä¸€ä¸ªç»†èƒçš„æ´»ä½“é‚»å±….</p>
<p>æ¥ä¸‹æ¥,è®©æˆ‘ä»¬å®šä¹‰å®‡å®™. å®‡å®™å…·æœ‰å®½åº¦å’Œé«˜åº¦,ä»¥åŠé•¿åº¦ä¸ºå•å…ƒæ ¼çš„å‘é‡<code>width * height</code>.</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
#[wasm_bindgen]
pub struct Universe {
    width: u32,
    height: u32,
    cells: Vec&lt;Cell&gt;,
}
#}</code></pre></pre>
<p>è¦è®¿é—®ç»™å®šè¡Œå’Œåˆ—çš„å•å…ƒæ ¼,æˆ‘ä»¬å°† è¡Œå’Œåˆ— è½¬æ¢ä¸º å•å…ƒæ ¼å‘é‡ çš„ç´¢å¼•,å¦‚å‰æ‰€è¿°:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
impl Universe {
    fn get_index(&amp;self, row: u32, column: u32) -&gt; usize {
        (row * self.width + column) as usize
    }

    // ...
}
#}</code></pre></pre>
<p>ä¸ºäº†è®¡ç®—å•å…ƒæ ¼çš„ä¸‹ä¸€ä¸ªçŠ¶æ€,æˆ‘ä»¬éœ€è¦è®¡ç®— å…¶é‚»å±…æœ‰å¤šå°‘ æ˜¯æ´»ç€çš„. æˆ‘ä»¬æ¥å†™ä¸€ä¸ª<code>live_neighbor_count</code>åšåˆ°è¿™ä¸€ç‚¹çš„æ–¹æ³•!</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
impl Universe {
    // ...

    fn live_neighbor_count(&amp;self, row: u32, column: u32) -&gt; u8 {
        let mut count = 0;
        for delta_row in [self.height - 1, 0, 1].iter().cloned() {
            for delta_col in [self.width - 1, 0, 1].iter().cloned() {
                if delta_row == 0 &amp;&amp; delta_col == 0 {
                    continue;
                }

                let neighbor_row = (row + delta_row) % self.height;
                let neighbor_col = (column + delta_col) % self.width;
                let idx = self.get_index(neighbor_row, neighbor_col);
                count += self.cells[idx] as u8;
            }
        }
        count
    }
}
#}</code></pre></pre>
<p>è¯¥<code>live_neighbor_count</code>æ–¹æ³•ä½¿ç”¨ å¢é‡å’Œæ¨¡æ•°æ¥ é¿å… å®‡å®™çš„è¾¹ç¼˜æƒ…å†µ. å½“ delta åº”ç”¨ <code>-1</code>,æˆ‘ä»¬<em>æ·»åŠ </em>
<code>self.height - 1</code>è®© æ¨¡æ•° åšå®ƒçš„äº‹,è€Œä¸æ˜¯è¯•å›¾å‡å»<code>1</code>. <code>row</code>å’Œ<code>column</code>å¯ä»¥ä¸º<code>0</code>,å¦‚æœæˆ‘ä»¬è¯•å›¾å‡å»<code>1</code>, ä»ä»–ä»¬æ¥çœ‹,ä¼šæœ‰ä¸€ä¸ª æ— ç¬¦å·æ•´æ•° ä¸‹æº¢.</p>
<p>ç°åœ¨æˆ‘ä»¬æ‹¥æœ‰äº†ä»å½“å‰è®¡ç®—ä¸‹ä¸€ä»£æ‰€éœ€çš„ä¸€åˆ‡! æ¯ä¸ªæ¸¸æˆçš„è§„åˆ™éµå¾ª ç›´æ¥è½¬æ¢æ¡ä»¶ç”¨<code>match</code>è¡¨è¾¾. å¦å¤–,å› ä¸ºæˆ‘ä»¬å¸Œæœ› JavaScript æ§åˆ¶æ»´ç­”æ—¶é—´,æˆ‘ä»¬å°†æŠŠè¿™ä¸ªæ–¹æ³•æ”¾åœ¨ä¸€ä¸ª<code>#[wasm_bindgen]</code>æ³¨é‡Šä¸‹,ä»¥ä¾¿å®ƒæš´éœ²ç»™ JavaScript.</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
/// Public methods, exported to JavaScript.
#[wasm_bindgen]
impl Universe {
    pub fn tick(&amp;mut self) {
        let mut next = self.cells.clone();

        for row in 0..self.height {
            for col in 0..self.width {
                let idx = self.get_index(row, col);
                let cell = self.cells[idx];
                let live_neighbors = self.live_neighbor_count(row, col);

                let next_cell = match (cell, live_neighbors) {
                    // Rule 1: Any live cell with fewer than two live neighbours
                    // dies, as if caused by underpopulation.
                    (Cell::Alive, x) if x &lt; 2 =&gt; Cell::Dead,
                    // Rule 2: Any live cell with two or three live neighbours
                    // lives on to the next generation.
                    (Cell::Alive, 2) | (Cell::Alive, 3) =&gt; Cell::Alive,
                    // Rule 3: Any live cell with more than three live
                    // neighbours dies, as if by overpopulation.
                    (Cell::Alive, x) if x &gt; 3 =&gt; Cell::Dead,
                    // Rule 4: Any dead cell with exactly three live neighbours
                    // becomes a live cell, as if by reproduction.
                    (Cell::Dead, 3) =&gt; Cell::Alive,
                    // All other cells remain in the same state.
                    (otherwise, _) =&gt; otherwise,
                };

                next[idx] = next_cell;
            }
        }

        self.cells = next;
    }

    // ...
}
#}</code></pre></pre>
<p>åˆ°ç›®å‰ä¸ºæ­¢,å®‡å®™çš„çŠ¶æ€è¢«è¡¨ç¤ºä¸º ç»†èƒ çš„è½½ä½“. ä¸ºäº†ä½¿è¿™ä¸ªå¯è¯»,è®©æˆ‘ä»¬å®ç°ä¸€ä¸ªåŸºæœ¬çš„æ–‡æœ¬æ¸²æŸ“å™¨. æˆ‘ä»¬çš„æƒ³æ³•æ˜¯é€è¡Œå°† Universe å†™æˆæ–‡æœ¬,å¯¹äºæ¯ä¸ªæ´»ç€çš„å•å…ƒæ ¼,æ‰“å° Unicode å­—ç¬¦<code>â—¼ï¸</code> (&quot;é»‘è‰²æ–¹æ ¼&quot;) . å¯¹äºæ­»ç»†èƒ,æˆ‘ä»¬å°†æ‰“å°<code>â—»ï¸</code> (&quot;ç™½è‰²æ–¹æ ¼&quot;) .</p>
<p>é€šè¿‡å®æ–½<a href="https://doc.rust-lang.org/1.25.0/std/fmt/trait.Display.html"><code>Display</code></a>æ˜¯æ¥è‡ª Rust æ ‡å‡†åº“ çš„ç‰¹æ€§,æˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ç§ä»¥ é¢å‘ç”¨æˆ·çš„æ–¹å¼ æ ¼å¼åŒ–ç»“æ„çš„æ–¹æ³•. è¿™ä¹Ÿä¼šè‡ªåŠ¨ç»™æˆ‘ä»¬ä¸€ä¸ª<a href="https://doc.rust-lang.org/1.25.0/std/string/trait.ToString.html"><code>to_string</code></a>æ–¹æ³•.</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
use std::fmt;

impl fmt::Display for Universe {
    fn fmt(&amp;self, f: &amp;mut fmt::Formatter) -&gt; fmt::Result {
        for line in self.cells.as_slice().chunks(self.width as usize) {
            for &amp;cell in line {
                let symbol = if cell == Cell::Dead { &quot;â—»ï¸&quot; } else { &quot;â—¼ï¸&quot; };
                write!(f, &quot;{}&quot;, symbol)?;
            }
            write!(f, &quot;\n&quot;)?;
        }

        Ok(())
    }
}
#}</code></pre></pre>
<p>æœ€å,æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ„é€ å‡½æ•°,ç”¨ä¸€ä¸ªæœ‰è¶£çš„ æ´»ç»†èƒå’Œæ­»ç»†èƒ æ¨¡å¼æ¥åˆå§‹åŒ–å®‡å®™,ä»¥åŠ<code>render</code>æ–¹æ³•:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
/// Public methods, exported to JavaScript.
#[wasm_bindgen]
impl Universe {
    // ...

    pub fn new() -&gt; Universe {
        let width = 64;
        let height = 64;

        let cells = (0..width * height)
            .map(|i| {
                if i % 2 == 0 || i % 7 == 0 {
                    Cell::Alive
                } else {
                    Cell::Dead
                }
            })
            .collect();

        Universe {
            width,
            height,
            cells,
        }
    }

    pub fn render(&amp;self) -&gt; String {
        self.to_string()
    }
}
#}</code></pre></pre>
<p>æœ‰äº†è¿™ä¸ª,æˆ‘ä»¬çš„ç”Ÿå‘½æ¸¸æˆ Rust å®ç°çš„ä¸€åŠå°±å®Œæˆäº†!</p>
<a class="header" href="print.html#aä½¿ç”¨-javascript-æ¸²æŸ“" id="aä½¿ç”¨-javascript-æ¸²æŸ“"><h2>ä½¿ç”¨ JavaScript æ¸²æŸ“</h2></a>
<p>é¦–å…ˆ,è®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ª<code>&lt;pre&gt;</code>HTML ç”¨äºæ¸²æŸ“:</p>
<pre><code class="language-html">&lt;body&gt;
    &lt;pre id=&quot;game-of-life-canvas&quot;&gt;&lt;/pre&gt;
    &lt;script src='./bootstrap.js'&gt;&lt;/script&gt;
&lt;/body&gt;
</code></pre>
<p>å¦å¤–,æˆ‘ä»¬æƒ³è¦çš„<code>&lt;pre&gt;</code>ä»¥ç½‘é¡µä¸­é—´ä¸ºä¸­å¿ƒ. æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ CSS flex æ¥å®Œæˆè¿™é¡¹ä»»åŠ¡. æ·»åŠ ä»¥ä¸‹å†…å®¹<code>&lt;style&gt;</code>åœ¨<code>index.html</code>çš„<code>&lt;head&gt;</code>é‡Œé¢:</p>
<pre><code class="language-html">&lt;style&gt;
    body {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
    }
&lt;/style&gt;
</code></pre>
<p>åœ¨é¡¶ç«¯<code>index.js</code>,è®©æˆ‘ä»¬ä¿®å¤æˆ‘ä»¬çš„å¯¼å…¥æ¥å¼•å…¥<code>Universe</code>è€Œä¸æ˜¯æ—§çš„<code>greet</code>åŠŸèƒ½:</p>
<pre><code class="language-js">import {Universe} from './wasm_game_of_life';
</code></pre>
<p>å¦å¤–,è®©æˆ‘ä»¬è·å–<code>&lt;pre&gt;</code>å¹¶å®ä¾‹åŒ–æ–° Universe çš„å…ƒç´ :</p>
<pre><code class="language-js">const pre = document.getElementById('game-of-life-canvas');
const universe = Universe.new();
</code></pre>
<p>JavaScript è¿è¡Œäº<code>requestAnimationFrame</code>å¾ªç¯. åœ¨æ¯æ¬¡è¿­ä»£ä¸­,å®ƒå°†å½“å‰çš„ Universe ç»˜åˆ¶åˆ°<code>&lt;pre&gt;</code>,ç„¶åè¿è¡Œ<code>Universe::tick</code>.</p>
<pre><code class="language-js">const renderLoop = () =&gt; {
  pre.textContent = universe.render();
  universe.tick();

  requestAnimationFrame(renderLoop);
};
</code></pre>
<p>è¦å¼€å§‹æ¸²æŸ“è¿‡ç¨‹,æˆ‘ä»¬æ‰€è¦åšçš„å°±æ˜¯ä¸ºæ¸²æŸ“å¾ªç¯çš„ç¬¬ä¸€æ¬¡è¿­ä»£è¿›è¡Œåˆå§‹è°ƒç”¨:</p>
<pre><code class="language-js">requestAnimationFrame(renderLoop);
</code></pre>
<p>è¿™å°±æ˜¯å®ƒç°åœ¨çš„æ ·å­:</p>
<p><a href="./images/game-of-life/initial-game-of-life-pre.png"><img src="./images/game-of-life/initial-game-of-life-pre.png" alt="Screenshot of the Game of Life implementation with text rendering" /></a></p>
<a class="header" href="print.html#aç›´æ¥ä»å†…å­˜æ¸²æŸ“åˆ°ç”»å¸ƒ" id="aç›´æ¥ä»å†…å­˜æ¸²æŸ“åˆ°ç”»å¸ƒ"><h2>ç›´æ¥ä»å†…å­˜æ¸²æŸ“åˆ°ç”»å¸ƒ</h2></a>
<p>åœ¨ Rust ä¸­ç”Ÿæˆ (å’Œåˆ†é…) ä¸€ä¸ª<code>String</code>, ç„¶åæœ‰<code>wasm-bindgen</code>å°†å…¶è½¬æ¢ä¸ºæœ‰æ•ˆçš„ JavaScript å­—ç¬¦ä¸² ,æ¥ä¼šç”Ÿæˆ Universe å•å…ƒæ ¼ çš„ä¸å¿…è¦å‰¯æœ¬. å…¶å®åœ¨ JavaScript ä»£ç  çŸ¥é“ Universe çš„å®½åº¦å’Œé«˜åº¦,å¹¶ä¸”å¯ä»¥ç›´æ¥ä» JavaScript ä¸­è¯»å– WebAssembly çº¿æ€§å†…å­˜ ä¸­çš„å•å…ƒæ ¼å­—èŠ‚, æˆ‘ä»¬å°±å¯ä»¥ä¿®æ”¹<code>render</code>æ–¹æ³•,ç”¨æ¥è¿”å› å•å…ƒæ•°ç»„çš„å¼€å¤´æŒ‡é’ˆ.</p>
<p>è¿˜æœ‰,æˆ‘ä»¬å°†åˆ‡æ¢åˆ°ä½¿ç”¨<a href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API">Canvas API</a>. è€Œä¸æ˜¯æ¸²æŸ“ unicode æ–‡æœ¬. æˆ‘ä»¬å°†åœ¨æœ¬æ•™ç¨‹çš„å…¶ä½™éƒ¨åˆ†ä¸­ä½¿ç”¨æ­¤è®¾è®¡.</p>
<p>é¦–å…ˆ,è®©æˆ‘ä»¬æ›¿æ¢<code>pre</code>,æ¢æˆäº†ä¸€ä¸ª<code>&lt;canvas&gt;</code> (å®ƒä¹Ÿåº”è¯¥åœ¨<code>&lt;body&gt;</code>, <code>&lt;script&gt;</code>åŠ è½½æˆ‘ä»¬çš„ JavaScript ä¹‹å‰) :</p>
<pre><code class="language-html">&lt;body&gt;
    &lt;canvas id=&quot;game-of-life-canvas&quot;&gt;&lt;/canvas&gt;
    &lt;script src='./bootstrap.js'&gt;&lt;/script&gt;
&lt;/body&gt;
</code></pre>
<p>ä¸ºäº†ä» Rust å®ç° ä¸­è·å–å¿…è¦çš„ä¿¡æ¯,æˆ‘ä»¬éœ€è¦ä¸º Universe çš„å®½åº¦,é«˜åº¦å’ŒæŒ‡å‘ å…¶å•å…ƒæ•°ç»„ çš„æŒ‡é’ˆ æ·»åŠ ä¸€äº›æ›´å¤šçš„ <code>getter</code>å‡½æ•°. æ‰€æœ‰è¿™äº›éƒ½æš´éœ²åœ¨ JavaScript ä¸­.</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
/// Public methods, exported to JavaScript.
#[wasm_bindgen]
impl Universe {
    // ...

    pub fn width(&amp;self) -&gt; u32 {
        self.width
    }

    pub fn height(&amp;self) -&gt; u32 {
        self.height
    }

    pub fn cells(&amp;self) -&gt; *const Cell {
        self.cells.as_ptr()
    }
}
#}</code></pre></pre>
<p>æ¥ä¸‹æ¥,è®©æˆ‘ä»¬åœ¨<code>import</code>ä»£ç è¡Œä¸‹é¢å®šä¹‰ JavaScript åœ¨æ¸²æŸ“ç”»å¸ƒæ—¶å°†ä½¿ç”¨çš„ä¸€äº›å¸¸é‡:</p>
<pre><code class="language-js">import {Universe} from './wasm_game_of_life';

const CELL_SIZE = 5; // px
const GRID_COLOR = '#CCCCCC';
const DEAD_COLOR = '#FFFFFF';
const ALIVE_COLOR = '#000000';

// è¿™äº›å¿…é¡»åŒ¹é… `Cell::Alive` å’Œ `Cell::Dead` in `src/lib.rs`.
const DEAD = 0;
const ALIVE = 1;
</code></pre>
<p>ç°åœ¨,è®©æˆ‘ä»¬é‡å†™å½“å‰çš„ JS ä»£ç  (å¯¼å…¥é™¤å¤–) ,ä¸å†å†™å…¥<code>&lt;pre&gt;</code>è€Œæ˜¯ä¸“æ³¨åœ¨<code>&lt;canvas&gt;</code>:</p>
<pre><code class="language-js">// æ„é€  the universe, and get its width and height.
const universe = Universe.new();
const width = universe.width();
const height = universe.height();

// Give the canvas room for all of our cells and a 1px border
// around each of them.
const canvas = document.getElementById('game-of-life-canvas');
canvas.height = (CELL_SIZE + 1) * height + 1;
canvas.width = (CELL_SIZE + 1) * width + 1;

const ctx = canvas.getContext('2d');

const renderLoop = () =&gt; {
  universe.tick();

  drawGrid();
  drawCells();

  requestAnimationFrame(renderLoop);
};
</code></pre>
<p>ä¸ºäº†åœ¨å•å…ƒæ ¼ä¹‹é—´ç»˜åˆ¶ç½‘æ ¼,æˆ‘ä»¬ç»˜åˆ¶ ä¸€ç»„ç­‰é—´éš” çš„ æ°´å¹³çº¿ å’Œ ä¸€ç»„ç­‰é—´è· çš„ å‚ç›´çº¿. è¿™äº›çº¿ çºµæ¨ªäº¤é”™ å½¢æˆç½‘æ ¼.</p>
<pre><code class="language-js">const drawGrid = () =&gt; {
  ctx.beginPath();
  ctx.lineWidth = 1 / window.devicePixelRatio;
  ctx.strokeStyle = GRID_COLOR;

  // Vertical lines.
  for (let i = 0; i &lt;= width; i++) {
    ctx.moveTo(i * (CELL_SIZE + 1) + 1, 0);
    ctx.lineTo(i * (CELL_SIZE + 1) + 1, (CELL_SIZE + 1) * height + 1);
  }

  // Horizontal lines.
  for (let j = 0; j &lt;= height; j++) {
    ctx.moveTo(0, j * (CELL_SIZE + 1) + 1);
    ctx.lineTo((CELL_SIZE + 1) * width + 1, j * (CELL_SIZE + 1) + 1);
  }

  ctx.stroke();
};
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡<code>memory</code>æ‹¿åˆ° WebAssembly çš„ çº¿æ€§å†…å­˜, è€Œè¿™ä¸ª<code>memory</code>æœ‰åŸç”Ÿ wasm æ¨¡å—<code>wasm_game_of_life_bg</code>æä¾›.ä¸ºäº†ç»˜åˆ¶ ç»†èƒ,æˆ‘ä»¬ä» <code>universe's cells</code> æ‹¿åˆ°æŒ‡é’ˆ ,æ„é€ ä¸€ä¸ªè¦†ç›–ç»†èƒé¢ç§¯çš„<code>Uint8Array</code>ç¼“å†²åŒº,è¿­ä»£æ¯ä¸ªç»†èƒ,å¹¶åˆ†åˆ«æ ¹æ® ç»†èƒæ˜¯æ­»è¿˜æ˜¯æ´»,ç»˜åˆ¶ç™½è‰²æˆ–é»‘è‰²çŸ©å½¢. é€šè¿‡ä½¿ç”¨ <code>idx</code> å’Œ è¦†ç›–,æˆ‘ä»¬é¿å…åœ¨æ¯ä¸ª<code>tick</code>ä¸Šè·¨è¶Šè¾¹ç•Œå¤åˆ¶å•å…ƒæ ¼.</p>
<pre><code class="language-js">// Import the WebAssembly memory at the top of the file.
import {memory} from './wasm_game_of_life_bg';

// ...

const getIndex = (row, column) =&gt; {
  return row * width + column;
};

const drawCells = () =&gt; {
  const cellsPtr = universe.cells(); // &lt; universe's cells
  const cells = new Uint8Array(memory.buffer, cellsPtr, width * height);

  ctx.beginPath();

  for (let row = 0; row &lt; height; row++) {
    for (let col = 0; col &lt; width; col++) {
      const idx = getIndex(row, col);

      ctx.fillStyle = cells[idx] === DEAD ? DEAD_COLOR : ALIVE_COLOR;

      ctx.fillRect(
        col * (CELL_SIZE + 1) + 1,
        row * (CELL_SIZE + 1) + 1,
        CELL_SIZE,
        CELL_SIZE
      );
    }
  }

  ctx.stroke();
};
</code></pre>
<p>è¦å¼€å§‹æ¸²æŸ“è¿‡ç¨‹,æˆ‘ä»¬å°†ä½¿ç”¨ä¸ ä¸Šéƒ¨åˆ†ç›¸åŒçš„ä»£ç  æ¥å¼€å§‹æ¸²æŸ“å¾ªç¯çš„ç¬¬ä¸€æ¬¡è¿­ä»£:</p>
<pre><code class="language-js">requestAnimationFrame(renderLoop);
</code></pre>
<a class="header" href="print.html#aå®ƒå·¥ä½œäº†" id="aå®ƒå·¥ä½œäº†"><h2>å®ƒå·¥ä½œäº†!</h2></a>
<p>é‡å»º WebAssembly å’Œ ç»‘å®š :</p>
<pre><code>npm run build-debug
</code></pre>
<p>ç¡®ä¿æ‚¨çš„å¼€å‘æœåŠ¡å™¨ä»åœ¨è¿è¡Œ. å¦‚æœä¸æ˜¯,è¯·å†æ¬¡å¯åŠ¨:</p>
<pre><code>npm run serve
</code></pre>
<p>å¦‚æœä½ åˆ·æ–°<a href="http://localhost:8080/">http://localhost:8080/</a>,ä½ åº”è¯¥å—åˆ°ä»¤äººå…´å¥‹çš„å±•ç¤º!</p>
<p><a href="./images/game-of-life/initial-game-of-life.png"><img src="./images/game-of-life/initial-game-of-life.png" alt="Screenshot of the Game of Life implementation" /></a></p>
<p>æ‚¨å¯ä»¥ checkout <code>chapter-one</code> branch æ‰¾åˆ°å®Œæ•´ä»£ç .</p>
<p>è¿˜æœ‰ä¸€ä¸ªéå¸¸å·§å¦™çš„ç®—æ³•,æ¥å®ç°ç”Ÿå‘½æ¸¸æˆ<a href="https://en.wikipedia.org/wiki/Hashlife">hashlife</a>. å®ƒä½¿ç”¨ç§¯æçš„è®°å¿†,å®é™…ä¸Šå¯ä»¥è·å¾—<em>æŒ‡æ•°çº§æ›´å¿«</em>è®¡ç®—åä»£çš„æ—¶é—´è¶Šé•¿! é‰´äºæ­¤,æ‚¨å¯èƒ½æƒ³çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨æœ¬æ•™ç¨‹ä¸­æ²¡æœ‰å®ç°<code>hashlife</code>. å› ä¸ºå®ƒè¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´,æˆ‘ä»¬ä¸“æ³¨äº Rust å’Œ WebAssembly é›†æˆ,ä½†æˆ‘ä»¬å¼ºçƒˆå»ºè®®æ‚¨è‡ªå·±å»äº†è§£<code>hashlife</code>!</p>
<a class="header" href="print.html#aç»ƒä¹ -2" id="aç»ƒä¹ -2"><h2>ç»ƒä¹ </h2></a>
<ul>
<li>
<p>ä½¿ç”¨å•ä¸ªå¤ªç©ºé£èˆ¹,åˆå§‹åŒ–å®‡å®™.</p>
</li>
<li>
<p>ä¸æ˜¯ç¡¬ç¼–ç æœ€åˆçš„å®‡å®™,è€Œæ˜¯ç”Ÿæˆä¸€ä¸ªéšæœºçš„,æœ‰äº”åäº”ä¸ªç»†èƒæ´»ç€æˆ–æ­»äº¡çš„æœºä¼š.</p>
<p><em>æç¤º: ä½¿ç”¨<code>wasm_bindgen</code> import <code>Math.random</code> JavaScript å‡½æ•°:</em></p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
#[wasm_bindgen]
extern {
    #[wasm_bindgen(js_namespace = Math)]
    fn random() -&gt; f64;
}
#}</code></pre></pre>
</li>
<li>
<p>ç”¨ ä¸€ä¸ªå­—èŠ‚ è¡¨ç¤º æ¯ä¸ªå•å…ƒæ ¼ å¯ä»¥å¾ˆå®¹æ˜“åœ°è¿­ä»£å•å…ƒæ ¼,ä½†è¿™æ˜¯ä»¥æµªè´¹å†…å­˜ä¸ºä»£ä»·çš„. æ¯ä¸ªå­—èŠ‚æ˜¯ 8 ä½,ä½†æˆ‘ä»¬åªéœ€è¦ ä¸€ä¸ªä½ æ¥è¡¨ç¤ºæ¯ä¸ªå•å…ƒ æ˜¯æ´»è¿˜æ˜¯æ­». é‡æ„æ•°æ®è¡¨ç¤º,ä»¥ä¾¿æ¯ä¸ªå•å…ƒ,ä»…ä½¿ç”¨ä¸€ä¸ªç©ºæ ¼ä½.</p>
</li>
</ul>
<a class="header" href="print.html#aè°ƒè¯•" id="aè°ƒè¯•"><h1>è°ƒè¯•</h1></a>
<p>åœ¨æˆ‘ä»¬ç¼–å†™æ›´å¤šä»£ç ä¹‹å‰,æˆ‘ä»¬éœ€è¦åœ¨å‡ºç°é—®é¢˜æ—¶ä½¿ç”¨ä¸€äº›è°ƒè¯•å·¥å…·.</p>
<a class="header" href="print.html#aä½¿ç”¨è°ƒè¯•ç¬¦å·æ„å»º" id="aä½¿ç”¨è°ƒè¯•ç¬¦å·æ„å»º"><h2>ä½¿ç”¨è°ƒè¯•ç¬¦å·æ„å»º</h2></a>
<blockquote>
<p>âš¡ è°ƒè¯•æ—¶,è¯·åŠ¡å¿…ç¡®ä¿ä½¿ç”¨è°ƒè¯•ç¬¦å·æ„å»º!</p>
</blockquote>
<p>å¦‚æœæ‚¨æ²¡æœ‰å¯ç”¨è°ƒè¯•ç¬¦å·,é‚£ä¹ˆ<code>&quot;name&quot;</code>éƒ¨åˆ†å°†ä¸ä¼šå‡ºç°åœ¨<code>.wasm</code>äºŒè¿›åˆ¶ç¼–è¯‘ä¸­å’Œå †æ ˆè·Ÿè¸ªå°†å…·æœ‰ç±»ä¼¼çš„å‡½æ•°åç§°<code>wasm[42]</code>è€Œä¸æ˜¯<code>wasm_game_of_life::Universe::live_neighbor_count</code>.</p>
<p>ä½¿ç”¨&quot;debug&quot;ç‰ˆæœ¬æ—¶ (åˆç§°<code>npm run build-debug</code>) é»˜è®¤æƒ…å†µä¸‹å¯ç”¨è°ƒè¯•ç¬¦å·.</p>
<p>ä½¿ç”¨&quot;release&quot;æ„å»ºæ—¶,é»˜è®¤æƒ…å†µä¸‹ä¸å¯ç”¨è°ƒè¯•ç¬¦å·. è¦å¯ç”¨è°ƒè¯•ç¬¦å·,è¯·ç¡®ä¿æ‚¨<code>debug = true</code>åœ¨<code>Cargo.toml</code>çš„<code>[profile.release]</code>:</p>
<pre><code class="language-toml">[profile.release]
debug = true
</code></pre>
<p>é»˜è®¤æƒ…å†µä¸‹æˆ‘ä»¬ä¸€ç›´åœ¨ä½¿ç”¨çš„é¡¹ç›®æ¨¡æ¿æ·»åŠ äº†è¿™ä¸ª<code>Cargo.toml</code>,ä¸ºæ–¹ä¾¿èµ·è§.</p>
<a class="header" href="print.html#aè®°å½•" id="aè®°å½•"><h2>è®°å½•</h2></a>
<p>è®°å½•æ˜¯æˆ‘ä»¬ç”¨æ¥è¯æ˜å’Œåé©³æˆ‘ä»¬çš„ç¨‹åºé”™è¯¯åŸå› çš„æœ€æœ‰æ•ˆå·¥å…·ä¹‹ä¸€. åœ¨ web ä¸Š,<code>console.log</code> æ˜¯å°†æ¶ˆæ¯è®°å½•åˆ°æµè§ˆå™¨çš„å¼€å‘äººå‘˜å·¥å…·æ§åˆ¶å°çš„æ–¹æ³•. æˆ‘ä»¬å¯ä»¥ç”¨<code>wasm_bindgen</code>å¯¼å…¥å¯¹å®ƒçš„å¼•ç”¨,å¦‚ä¸‹æ‰€ç¤º:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
#[wasm_bindgen]
extern {
    #[wasm_bindgen(js_namespace = console)]
    fn log(msg: &amp;str);
}

// A macro to æä¾› `println!(..)`-style syntax ç»™ `console.log` logging.
macro_rules! log {
    ($($t:tt)*) =&gt; (log(&amp;format!($($t)*)))
}
#}</code></pre></pre>
<p>ç„¶å,æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ Rust ä»£ç ä¸­,æ’å…¥<code>log</code>è°ƒç”¨å°†æ¶ˆæ¯è®°å½•åˆ°æ§åˆ¶å°. ä¾‹å¦‚,è¦è®°å½•æ¯ä¸ªå•å…ƒçš„çŠ¶æ€,æ´»åŠ¨é‚»å±…æ•°å’Œä¸‹ä¸€ä¸ªçŠ¶æ€,æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·ä¿®æ”¹æˆ‘ä»¬çš„ä»£ç :</p>
<pre><code class="language-diff">diff --git a/src/lib.rs b/src/lib.rs
index f757641..a30e107 100755
--- a/src/lib.rs
+++ b/src/lib.rs
@@ -63,6 +63,11 @@ impl Universe {
                 let cell = self.cells[idx];
                 let live_neighbors = self.live_neighbor_count(row, col);

+                log!(
+                    &quot;cell[{}, {}] is initially {:?} and has {} live neighbors&quot;,
+                    row, col, cell, live_neighbors
+                );
+
                 let next_cell = match (cell, live_neighbors) {
                     // Rule 1: Any live cell with fewer than two live neighbours
                     // dies, as if caused by underpopulation.
@@ -80,6 +85,8 @@ impl Universe {
                     (otherwise, _) =&gt; otherwise,
                 };

+                log!(&quot;    it becomes {:?}&quot;, next_cell);
+
                 next[idx] = next_cell;
             }
         }
</code></pre>
<p><code>console.log</code>æˆ–è€…<code>console.error</code>å‡½æ•°å…·æœ‰ç›¸åŒçš„æ¥å£<code>,ä½†æ˜¯,</code>console.error`åœ¨å¼€å‘äººå‘˜å·¥å…·ä¹Ÿå€¾å‘äºåœ¨è®°å½•æ¶ˆæ¯æ—¶æ•è·å¹¶æ˜¾ç¤ºå †æ ˆè·Ÿè¸ªç”¨æ¥.</p>
<a class="header" href="print.html#aå‚è€ƒ" id="aå‚è€ƒ"><h3>å‚è€ƒ</h3></a>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Console">è¯¥<code>console</code>å¯¹è±¡</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Tools/Web_Console">Firefox å¼€å‘äººå‘˜å·¥å…· - Web æ§åˆ¶å°</a></li>
<li><a href="https://docs.microsoft.com/en-us/microsoft-edge/devtools-guide/console">Microsoft Edge å¼€å‘äººå‘˜å·¥å…· - æ§åˆ¶å°</a></li>
<li><a href="https://developers.google.com/web/tools/chrome-devtools/console/get-started">å¼€å§‹ä½¿ç”¨ Chrome DevTools æ§åˆ¶å°</a></li>
</ul>
<a class="header" href="print.html#aå´©æºƒæ—¥å¿—" id="aå´©æºƒæ—¥å¿—"><h2>å´©æºƒæ—¥å¿—</h2></a>
<p><a href="https://github.com/rustwasm/console_error_panic_hook">è¿™ <code>console_error_panic_hook</code> ç®±å­ é€šè¿‡<code>console.error</code>ä¸ºå¼€å‘è€…è®°å½•äº†å¼‚å¸¸çš„å´©æºƒ</a> è€Œä¸æ˜¯å¾—åˆ° æ€ªå¼‚çš„,
éš¾ä»¥è°ƒè¯•çš„ <code>RuntimeError: unreachable executed</code> é”™è¯¯ä¿¡æ¯, å®ƒä¼šç»™ä½ æ ¼å¼åŒ–çš„å´©æºƒä¿¡æ¯.</p>
<p>åšåˆ°è¿™äº›, ä½ åªéœ€è¦åœ¨åˆå§‹åŒ–å‡½æ•°ä¸­è½½å…¥é’©å­æˆ–è€…é€‚åº”ä¸‹é¢çš„é€šç”¨ä»£ç :</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
extern crate console_error_panic_hook;

// Expose an `init` function to be called by JS after instantiating the wasm
// module which installs the `console.error` panic hook.
#[wasm_bindgen]
pub fn init() {
    use std::panic;
    panic::set_hook(Box::new(console_error_panic_hook::hook));
}

// OR

// Ensure the the panic hook is set on some common code path. Under the hood,
// this makes sure that it is only installed once.
console_error_panic_hook::set_once();
#}</code></pre></pre>
<a class="header" href="print.html#aä½¿ç”¨è°ƒè¯•å™¨" id="aä½¿ç”¨è°ƒè¯•å™¨"><h2>ä½¿ç”¨è°ƒè¯•å™¨</h2></a>
<p>ä¸å¹¸çš„æ˜¯,WebAssembly çš„è°ƒè¯•ä»ç„¶ä¸æˆç†Ÿ. åœ¨å¤§å¤šæ•° Unix ç³»ç»Ÿä¸Š,<a href="http://dwarfstd.org/">DWARF</a>ç”¨äºç¼–ç è°ƒè¯•å™¨æä¾›æ­£åœ¨è¿è¡Œçš„ç¨‹åºçš„æºçº§æ£€æŸ¥çš„ä¿¡æ¯. åœ¨ Windows ä¸Šæœ‰ä¸€ç§æ›¿ä»£æ ¼å¼å¯ä»¥ç¼–ç ç±»ä¼¼çš„ä¿¡æ¯. ç›®å‰, WebAssembly æ²¡æœ‰ç­‰ä»·ç‰©. å› æ­¤,è°ƒè¯•å™¨ç›®å‰æä¾›æœ‰é™çš„å®ç”¨ç¨‹åº,æˆ‘ä»¬æœ€ç»ˆé€æ­¥æ‰§è¡Œç¼–è¯‘å™¨å‘å‡ºçš„åŸå§‹ WebAssembly æŒ‡ä»¤,è€Œä¸æ˜¯æˆ‘ä»¬ç¼–å†™çš„ Rust æºæ–‡æœ¬.</p>
<p>å°½ç®¡å¦‚æ­¤,è°ƒè¯•å™¨ä»ç„¶å¯ç”¨äºæ£€æŸ¥ ä¸ WebAssembly äº¤äº’çš„ JavaScript. ä¾‹å¦‚,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è°ƒè¯•å™¨åœ¨æˆ‘ä»¬çš„<code>renderLoop</code>å‡½æ•°æ¯æ¬¡è¿­ä»£ä¸­æš‚åœ. è¿™ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„æ£€æŸ¥ç‚¹,ç”¨äºæ£€æŸ¥è®°å½•çš„æ¶ˆæ¯,å¹¶å°†å½“å‰å‘ˆç°çš„å¸§ä¸å‰ä¸€å¸§è¿›è¡Œæ¯”è¾ƒ.</p>
<p><a href="./images/game-of-life/debugging.png"><img src="./images/game-of-life/debugging.png" alt="Screenshot of debugging the Game of Life" /></a></p>
<a class="header" href="print.html#aå‚è€ƒ-1" id="aå‚è€ƒ-1"><h3>å‚è€ƒ</h3></a>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Tools/Debugger">Firefox å¼€å‘è€…å·¥å…· - è°ƒè¯•å™¨</a></li>
<li><a href="https://docs.microsoft.com/en-us/microsoft-edge/devtools-guide/debugger">Microsoft Edge å¼€å‘äººå‘˜å·¥å…· - è°ƒè¯•å™¨</a></li>
<li><a href="https://developers.google.com/web/tools/chrome-devtools/javascript/">å¼€å§‹åœ¨ Chrome DevTools ä¸­è°ƒè¯• JavaScript</a></li>
</ul>
<a class="header" href="print.html#aé¦–å…ˆé¿å…è°ƒè¯•-webassembly" id="aé¦–å…ˆé¿å…è°ƒè¯•-webassembly"><h2>é¦–å…ˆé¿å…è°ƒè¯• WebAssembly</h2></a>
<p>è™½ç„¶ä¸€äº›é”™è¯¯ç‰¹å®šäº JavaScript å’Œ WebAssembly çš„æ¥å£,ä½†ç»éªŒè¡¨æ˜å¤§å¤šæ•°é”™è¯¯éƒ½æ²¡æœ‰. å°è¯•å°† bug é‡ç° é€šè¿‡æ­£å¸¸çš„ Rust<code>#[test]</code>å‡½æ•°,æ‚¨å¯ä»¥åœ¨è°ƒè¯•æ—¶åˆ©ç”¨æ“ä½œç³»ç»Ÿçš„æˆç†Ÿå·¥å…·. ä½¿ç”¨æµ‹è¯•ç®±å­<a href="https://crates.io/crates/quickcheck"><code>quickcheck</code></a>ç»ƒä¹ æ‚¨å‘ JavaScript å…¬å¼€çš„æ¥å£. æœ€ç»ˆ,å¦‚æœæ‚¨å¯ä»¥åœ¨ä¸éœ€è¦ä¸ JavaScript äº¤äº’ çš„å°æµ‹è¯•ç”¨ä¾‹ä¸­éš”ç¦»å®ƒä»¬,æ‚¨å°†æ›´å®¹æ˜“æ‰¾åˆ°å¹¶ä¿®å¤é”™è¯¯.</p>
<p>æ³¨æ„,ä¸ºäº†è¿è¡Œ<code>#[test]</code>æ²¡æœ‰ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨é”™è¯¯,ä½ éœ€è¦æ·»åŠ <code>#![wasm_bindgen]</code>æ³¨é‡Šå’Œ<code>crate-type = &quot;cdylib&quot;</code>.</p>
<a class="header" href="print.html#aç»ƒä¹ -3" id="aç»ƒä¹ -3"><h2>ç»ƒä¹ </h2></a>
<ul>
<li>
<p>æ·»åŠ æ—¥å¿—è®°å½•åˆ°<code>tick</code>å‡½æ•°,è®°å½•æ¯ä¸ªå•å…ƒæ ¼çš„è¡Œå’Œåˆ— - çŠ¶æ€ä»æ´»åŠ¨è½¬æ¢ä¸ºæ­»äº¡,åä¹‹äº¦ç„¶.</p>
</li>
<li>
<p>ä»‹ç»ä¸€ä¸ª<code>panic!()</code>åœ¨<code>Universe::new</code>æ–¹æ³•é‡Œé¢. åœ¨ Web æµè§ˆå™¨çš„ JavaScript è°ƒè¯•å™¨ ä¸­æ£€æŸ¥ææ…Œçš„å›æº¯. ç¦ç”¨è°ƒè¯•ç¬¦å·,é‡å»ºå¹¶å†æ¬¡æ£€æŸ¥å †æ ˆè·Ÿè¸ª. ä¸æ˜¯å¾ˆæœ‰ç”¨,æ˜¯å—?</p>
</li>
<li>
<p>checkout <code>chapter-one-with-bug</code> branch. é‡å»ºå¹¶é‡æ–°åŠ è½½ç½‘é¡µ. ç°åœ¨å¾ˆæ˜æ˜¾, è¿™ä¸ªåˆ†æ”¯çš„å®ç°åŒ…å«ä¸€ä¸ª<code>bug</code>, æ¯ä¸ªå•å…ƒæ ¼æ˜¾ç„¶éƒ½æ˜¯æ´»ç€çš„. è¿™æ˜¯æ‚¨çš„ä½œè€…åœ¨æœ€åˆåˆ›å»ºç¤ºä¾‹ä»£ç æ—¶, æ‰€çŠ¯çš„çœŸå®ä¸–ç•Œ (tm) é”™è¯¯. æ‰¾åˆ°é”™è¯¯å¹¶ä¿®å¤å®ƒ. _ä¸è¦çœ‹æäº¤å†å²! é‚£æ˜¯ä½œå¼Š ;-) _</p>
</li>
</ul>
<a class="header" href="print.html#aå¢åŠ äº¤äº’æ€§" id="aå¢åŠ äº¤äº’æ€§"><h1>å¢åŠ äº¤äº’æ€§</h1></a>
<p>æˆ‘ä»¬å°†é€šè¿‡åœ¨ Game of Life å®ç°ä¸­, æ·»åŠ ä¸€äº›äº¤äº’åŠŸèƒ½æ¥ç»§ç»­æ¢ç´¢ JavaScriptå’ŒWebAssemblyæ¥å£. æˆ‘ä»¬å°†å…è®¸ç”¨æˆ·é€šè¿‡å•å‡»,æ¥åˆ‡æ¢å•å…ƒæ ¼æ˜¯æ´»ç€è¿˜æ˜¯æ­»äº¡,å¹¶å…è®¸æš‚åœæ¸¸æˆ,è¿™ä½¿å¾—ç»˜åˆ¶å•å…ƒæ ¼æ¨¡å¼æ›´åŠ å®¹æ˜“.</p>
<a class="header" href="print.html#aæš‚åœå’Œæ¢å¤æ¸¸æˆ" id="aæš‚åœå’Œæ¢å¤æ¸¸æˆ"><h2>æš‚åœå’Œæ¢å¤æ¸¸æˆ</h2></a>
<p>è®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªæŒ‰é’®æ¥åˆ‡æ¢æ¸¸æˆæ˜¯æ­£åœ¨æ’­æ”¾è¿˜æ˜¯æš‚åœ. åˆ°<code>index.html</code>,åœ¨<code>&lt;canvas&gt;</code>ä¸Šæ–¹æ·»åŠ æŒ‰é’®:</p>
<pre><code class="language-html">&lt;button id=&quot;play-pause&quot;&gt;&lt;/button&gt;
</code></pre>
<p>åœ¨ JavaScript ä¸­,æˆ‘ä»¬å°†è¿›è¡Œä»¥ä¸‹æ›´æ”¹:</p>
<ul>
<li>
<p>è·Ÿè¸ªæœ€æ–°è¿”å›çš„æ ‡è¯†ç¬¦<code>requestAnimationFrame</code>,
ä»¥ä¾¿æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨<code>cancelAnimationFrame</code>å–æ¶ˆé‚£ä¸ªæ ‡è¯†ç¬¦åŠ¨ç”».</p>
</li>
<li>
<p>å•å‡»æ’­æ”¾/æš‚åœæŒ‰é’®æ—¶,æ£€æŸ¥æˆ‘ä»¬æ˜¯å¦å…·æœ‰æ’é˜ŸåŠ¨ç”»å¸§çš„æ ‡è¯†ç¬¦.
1.ç‚¹å‡»æ—¶,æ¸¸æˆå½“å‰æ­£åœ¨æ’­æ”¾,å–æ¶ˆåŠ¨ç”»å¸§<code>renderLoop</code>,æœ‰æ•ˆåœ°æš‚åœæ¸¸æˆ.
2.ç‚¹å‡»æ—¶,å½“å‰æš‚åœ,æ²¡æœ‰æ’é˜ŸåŠ¨ç”»å¸§çš„æ ‡è¯†ç¬¦,æˆ‘ä»¬æƒ³è¿è¡Œ<code>requestAnimationFrame</code>æ¢å¤æ¯”èµ›.</p>
</li>
</ul>
<p>å› ä¸º JavaScript æ­£åœ¨é©±åŠ¨ Rustå’ŒWebAssembly,æ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿™æ ·åš,è€Œä¸”æˆ‘ä»¬ä¸éœ€è¦æ›´æ”¹ Rustæºä»£ç .</p>
<p>æˆ‘ä»¬ä»‹ç»ä¸€ä¸‹<code>animationId</code>å˜é‡æ¥è·Ÿè¸ªè¿”å›çš„æ ‡è¯†ç¬¦<code>requestAnimationFrame</code>. å½“æ²¡æœ‰æ’é˜Ÿçš„åŠ¨ç”»å¸§æ—¶,æˆ‘ä»¬å°†æ­¤å˜é‡è®¾ç½®ä¸º<code>null</code>.</p>
<pre><code class="language-js">let animationId = null;

// This function is the same as before, except the
// result of `requestAnimationFrame` is assigned to
// `animationId`.
const renderLoop = () =&gt; {
  universe.tick();

  drawCells();
  drawGrid();

  animationId = requestAnimationFrame(renderLoop);
};
</code></pre>
<p>åœ¨ä»»ä½•æ—¶åˆ»,æˆ‘ä»¬éƒ½å¯ä»¥é€šè¿‡<code>animationId</code>æ£€æŸ¥æ¸¸æˆ,æ¥åˆ¤æ–­æ¸¸æˆæ˜¯å¦æš‚åœ:</p>
<pre><code class="language-js">const isPaused = () =&gt; {
  return animationId === null;
};
</code></pre>
<p>ç°åœ¨,å½“ç‚¹å‡» æ’­æ”¾/æš‚åœ æŒ‰é’®æ—¶,æˆ‘ä»¬ä¼šæ£€æŸ¥æ¸¸æˆå½“å‰æ˜¯æš‚åœè¿˜æ˜¯æ­£åœ¨æ’­æ”¾,è¦ä¹ˆç»§ç»­æ’­æ”¾<code>renderLoop</code>åŠ¨ç”»è¦ä¹ˆå–æ¶ˆä¸‹ä¸€ä¸ªåŠ¨ç”»å¸§.
æ­¤å¤–,æˆ‘ä»¬æ›´æ–°æŒ‰é’®çš„æ–‡æœ¬å›¾æ ‡,ä»¥åæ˜ æŒ‰é’®åœ¨ä¸‹æ¬¡å•å‡»æ—¶å°†æ‰§è¡Œçš„æ“ä½œ.</p>
<pre><code class="language-js">const playPauseButton = document.getElementById(&quot;play-pause&quot;);

const play = () =&gt; {
  playPauseButton.textContent = &quot;â¸&quot;;
  renderLoop();
};

const pause = () =&gt; {
  playPauseButton.textContent = &quot;â–¶&quot;;
  cancelAnimationFrame(animationId);
  animationId = null;
};

playPauseButton.addEventListener(&quot;click&quot;, event =&gt; {
  if (isPaused()) {
    play();
  } else {
    pause();
  }
});
</code></pre>
<p>æœ€å,æˆ‘ä»¬ç›´æ¥è°ƒç”¨<code>requestAnimationFrame(renderLoop)</code>ç”¨æ¥å¯åŠ¨ä¹‹å‰çš„æ¸¸æˆåŠå…¶åŠ¨ç”»,
ä½†æˆ‘ä»¬æƒ³ç”¨<code>play</code>æ›¿æ¢å®ƒ,ä»¥ä¾¿æŒ‰é’®è·å¾—æ­£ç¡®çš„åˆå§‹æ–‡æœ¬å›¾æ ‡.</p>
<pre><code class="language-diff">// This used to be `requestAnimationFrame(renderLoop)`.
play();
</code></pre>
<p>åˆ·æ–°<a href="http://localhost:8080/">http://localhost:8080/</a>ç°åœ¨ä½ åº”è¯¥å¯ä»¥é€šè¿‡ç‚¹å‡»æŒ‰é’®æ¥æš‚åœå’Œæ¢å¤æ¸¸æˆ!</p>
<a class="header" href="print.html#aåˆ‡æ¢ä¸€ä¸ªcellçš„çŠ¶æ€clickæ´»åŠ¨" id="aåˆ‡æ¢ä¸€ä¸ªcellçš„çŠ¶æ€clickæ´»åŠ¨"><h2>åˆ‡æ¢ä¸€ä¸ªCellçš„çŠ¶æ€<code>&quot;click&quot;</code>æ´»åŠ¨</h2></a>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥æš‚åœæ¸¸æˆäº†,ç°åœ¨æ˜¯æ—¶å€™æ·»åŠ é€šè¿‡ç‚¹å‡»å®ƒä»¬æ¥æ”¹å˜ç»†èƒçš„èƒ½åŠ›äº†.</p>
<p>åˆ‡æ¢å•å…ƒæ ¼æ˜¯å°†å…¶çŠ¶æ€ä»æ´»åŠ¨çŠ¶æ€è½¬æ¢ä¸ºæ­»äº¡çŠ¶æ€,æˆ–ä»æ­»äº¡çŠ¶æ€è½¬æ¢ä¸ºæ´»åŠ¨çŠ¶æ€:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
impl Cell {
    fn toggle(&amp;mut self) {
        *self = match *self {
            Cell::Dead =&gt; Cell::Alive,
            Cell::Alive =&gt; Cell::Dead,
        };
    }
}
#}</code></pre></pre>
<p>è¦åˆ‡æ¢ç»™å®šè¡Œå’Œåˆ—çš„å•å…ƒæ ¼çŠ¶æ€,æˆ‘ä»¬å°†è¡Œå’Œåˆ—å¯¹è½¬æ¢ä¸ºå•å…ƒæ ¼å‘é‡çš„ç´¢å¼•,å¹¶åœ¨è¯¥ç´¢å¼•å¤„çš„å•å…ƒæ ¼ä¸Šè°ƒç”¨<code>toggle</code>æ–¹æ³•:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
/// Public methods, exported to JavaScript.
#[wasm_bindgen]
impl Universe {
    // ...

    pub fn toggle_cell(&amp;mut self, row: u32, column: u32) {
        let idx = self.get_index(row, column);
        self.cells[idx].toggle();
    }
}
#}</code></pre></pre>
<p>è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨<code>impl</code>å¸¦æœ‰æ³¨é‡Šçš„å—<code>#[wasm_bindgen]</code>è¿™æ ·å®ƒå°±å¯ä»¥è¢« JavaScript è°ƒç”¨.</p>
<p>åœ¨ JavaScript ä¸­,æˆ‘ä»¬ä¼šç›‘å¬ ç‚¹å‡»äº‹ä»¶<code>&lt;canvas&gt;</code>å…ƒç´ ,å°† <code>clickäº‹ä»¶</code>çš„é¡µé¢ ç›¸å¯¹åæ ‡è½¬æ¢ä¸ºç”»å¸ƒç›¸å¯¹åæ ‡,
ç„¶åè½¬æ¢ä¸ºè¡Œå’Œåˆ—,è°ƒç”¨<code>toggle_cell</code>æ–¹æ³•,æœ€åé‡ç»˜åœºæ™¯.</p>
<pre><code class="language-js">canvas.addEventListener(&quot;click&quot;, event =&gt; {
  const boundingRect = canvas.getBoundingClientRect();

  const scaleX = canvas.width / boundingRect.width;
  const scaleY = canvas.height / boundingRect.height;

  const canvasLeft = (event.clientX - boundingRect.left) * scaleX;
  const canvasTop = (event.clientY - boundingRect.top) * scaleY;

  const row = Math.min(Math.floor(canvasTop / (CELL_SIZE + 1)), height - 1);
  const col = Math.min(Math.floor(canvasLeft / (CELL_SIZE + 1)), width - 1);

  universe.toggle_cell(row, col);

  drawCells();
  drawGrid();
});
</code></pre>
<p>åˆ·æ–°<a href="http://localhost:8080/">http://localhost:8080/</a>å†æ¬¡,æ‚¨ç°åœ¨å¯ä»¥é€šè¿‡å•å‡»å•å…ƒæ ¼å¹¶åˆ‡æ¢å…¶çŠ¶æ€æ¥ç»˜åˆ¶è‡ªå·±çš„æ¨¡å¼.</p>
<p>æ‚¨å¯ä»¥åœ¨ checkout <code>chapter-two</code> branch , æ‰¾åˆ°æ­¤å®ç°çš„å®Œæ•´æºä»£ç .</p>
<a class="header" href="print.html#aç»ƒä¹ -4" id="aç»ƒä¹ -4"><h2>ç»ƒä¹ </h2></a>
<ul>
<li>
<p>æ·»åŠ ä¸€ä¸ª<a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/range"><code>&lt;input type=&quot;range&quot;&gt;</code></a>ç”¨äºæ§åˆ¶æ¯ä¸ªåŠ¨ç”»å¸§å‡ºç°å¤šå°‘<code>tick</code>çš„å°éƒ¨ä»¶.</p>
</li>
<li>
<p>æ·»åŠ ä¸€ä¸ªå°†<code>Universe</code>é‡ç½®ä¸ºéšæœºåˆå§‹çŠ¶æ€çš„æŒ‰é’®. å¦ä¸€ä¸ªæŒ‰é’®å°†å®‡å®™é‡ç½®ä¸ºæ‰€æœ‰æ­»ç»†èƒ.</p>
</li>
<li>
<p><code>Ctrl + Click</code>,æ’å…¥ä¸€ä¸ª<a href="https://en.wikipedia.org/wiki/Glider_(Conway%27s_Life)">æ»‘ç¿”æœº</a>ä»¥ç›®æ ‡ç»†èƒä¸ºä¸­å¿ƒ. ä¸Š<code>Shift + Click</code>,æ’å…¥ä¸€ä¸ªè„‰å†²æ˜Ÿ.</p>
</li>
</ul>
<a class="header" href="print.html#aæ—¶é—´åˆ†æ" id="aæ—¶é—´åˆ†æ"><h1>æ—¶é—´åˆ†æ</h1></a>
<p>æœ¬ç« ä»‹ç»å¦‚ä½•ä½¿ç”¨ Rust å’Œ WebAssembly æ¥åˆ†æ Web é¡µé¢,å…¶ç›®æ ‡æ˜¯æé«˜ååé‡æˆ–é™ä½å»¶è¿Ÿ.</p>
<blockquote>
<p>âš¡ å§‹ç»ˆç¡®ä¿ä½¿ç”¨çš„æ˜¯<code>--release</code>åˆ†æ! ä½¿ç”¨æˆ‘ä»¬çš„é¡¹ç›®æ¨¡æ¿,è¿™æ„å‘³ç€ä½¿ç”¨<code>npm run build-release</code>ä»£æ›¿<code>npm run build-debug</code>.</p>
</blockquote>
<a class="header" href="print.html#aå¯ç”¨å·¥å…·" id="aå¯ç”¨å·¥å…·"><h2>å¯ç”¨å·¥å…·</h2></a>
<a class="header" href="print.html#aè¯¥performancenowè®¡æ—¶å™¨" id="aè¯¥performancenowè®¡æ—¶å™¨"><h3>è¯¥<code>performance.now()</code>è®¡æ—¶å™¨</h3></a>
<p>è¯¥<a href="https://developer.mozilla.org/en-US/docs/Web/API/Performance/now"><code>performance.now()</code></a>å‡½æ•°è¿”å›,è‡ªåŠ è½½ç½‘é¡µä»¥æ¥ä»¥æ¯«ç§’ä¸ºå•ä½æµ‹é‡çš„å•è°ƒæ—¶é—´æˆ³. æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥è®¡ç®—å„ç§æ“ä½œçš„æ—¶é—´,æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ ä» Rust è®¿é—®å®ƒ,é€šè¿‡<code>wasm_bindgen</code>å¯¼å…¥ç”³æŠ¥:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
#[wasm_bindgen]
extern {
    #[wasm_bindgen(js_namespace = performance)]
    fn now() -&gt; f64;
}
#}</code></pre></pre>
<p>è°ƒç”¨<code>performance.now</code>å¼€é”€å¾ˆå°,å› æ­¤æˆ‘ä»¬å¯ä»¥ä»ä¸­åˆ›å»ºç®€å•çš„æµ‹é‡,è€Œä¸ä¼šæ‰­æ›²ç³»ç»Ÿå…¶ä»–éƒ¨åˆ†çš„æ€§èƒ½.</p>
<p>ä¾‹å¦‚,æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªç®€å•çš„ <code>FPS-å¸§æ•°</code> è®¡æ•°å™¨,æˆ‘ä»¬åœ¨æ¯æ¬¡è¿­ä»£<code>renderLoop</code>æ—¶æ›´æ–°.</p>
<p>è®©æˆ‘ä»¬å¼€å§‹åœ¨<code>index.js</code>æ·»åŠ ä¸€ä¸ª<code>fps</code>å¯¹è±¡</p>
<pre><code class="language-js">const fps = new class {
  constructor() {
    this.fps = document.getElementById('fps');
    this.frames = [];
    this.lastFrameTimeStamp = performance.now();
  }

  render() {
    // æ—¶é—´è®¡ç®—.
    const now = performance.now();
    const delta = now - this.lastFrameTimeStamp;
    this.lastFrameTimeStamp = now;
    const fps = (1 / delta) * 1000;

    // Save only the latest 100 timings.
    this.frames.push(fps);
    if (this.frames.length &gt; 100) {
      this.frames.shift();
    }

    // æ‰¾å‡ºæˆ‘ä»¬100ä¸ªæœ€æ–°æ—¶é—´çš„æœ€å¤§å€¼ï¼Œæœ€å°å€¼å’Œå¹³å‡å€¼.
    let min = Infinity;
    let max = -Infinity;
    let sum = 0;
    for (let i = 0; i &lt; this.frames.length; i++) {
      sum += this.frames[i];
      min = Math.min(this.frames[i], min);
      max = Math.max(this.frames[i], max);
    }
    let mean = sum / this.frames.length;

    // Render the statistics.
    this.fps.textContent = `
Frames per Second:
         latest = ${Math.round(fps)}
avg of last 100 = ${Math.round(mean)}
min of last 100 = ${Math.round(min)}
max of last 100 = ${Math.round(max)}
`.trim();
  }
}();
</code></pre>
<p>æ¥ä¸‹æ¥ æˆ‘ä»¬è¿è¡Œ <code>fps</code> <code>render</code> å‡½æ•° ,åœ¨æ¯æ¬¡è¿­ä»£<code>renderLoop</code>æ—¶æ›´æ–°:</p>
<pre><code class="language-js">const renderLoop = () =&gt; {
  fps.render(); //new

  universe.tick();
  drawCells();
  drawGrid();

  animationId = requestAnimationFrame(renderLoop);
};
</code></pre>
<p>æœ€å, ä¸è¦å¿˜è®°æ·»åŠ  <code>fps</code> å…ƒç´  åˆ° <code>index.html</code>:</p>
<pre><code class="language-html">    &lt;div id=&quot;fps&quot;&gt;&lt;div&gt;
</code></pre>
<p>å™¢è€¶! ç°åœ¨ä½ æœ‰äº†ä¸€ä¸ª FPS è®¡æ•°å™¨!</p>
<a class="header" href="print.html#aå¼€å‘äººå‘˜å·¥å…·-profilers" id="aå¼€å‘äººå‘˜å·¥å…·-profilers"><h3>å¼€å‘äººå‘˜å·¥å…· Profilers</h3></a>
<p>æ‰€æœ‰ Web æµè§ˆå™¨ çš„å†…ç½®å¼€å‘äººå‘˜å·¥å…·éƒ½åŒ…å«ä¸€ä¸ªåˆ†æå™¨. è¿™äº›åˆ†æå™¨æ˜¾ç¤ºå“ªäº›å‡½æ•°èŠ±è´¹æœ€å¤šæ—¶é—´çš„å¯è§†åŒ–,å¦‚è°ƒç”¨æ ‘å’Œç«ç„°å›¾. å¦‚æœä½ <a href="./game-of-life/debugging.html#building-with-debug-symbols">ç”¨è°ƒè¯•ç¬¦å·æ„å»º</a>,ç„¶åè¿™äº›åˆ†æå™¨åº”è¯¥æ˜¾ç¤º Rust å‡½æ•°åç§° è€Œä¸æ˜¯åƒ<code>wasm-function[123]</code>. è¯·æ³¨æ„è¿™äº›åˆ†æå™¨<em>æƒ¯äº</em>æ˜¾ç¤ºå†…è”å‡½æ•°,ç”±äº Rust å’Œ LLVM ä¾èµ–äºå¦‚æ­¤å¤§é‡çš„å†…è”,ç»“æœå¯èƒ½ä¼šæœ‰ç‚¹ä»¤äººå›°æƒ‘.</p>
<p><a href="./images/game-of-life/profiler-with-rust-names.png"><img src="./images/game-of-life/profiler-with-rust-names.png" alt="Screenshot of profiler with Rust symbols" /></a></p>
<a class="header" href="print.html#aèµ„æº" id="aèµ„æº"><h4>èµ„æº</h4></a>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Tools/Performance">Firefox å¼€å‘è€…å·¥å…· - æ€§èƒ½</a></li>
<li><a href="https://docs.microsoft.com/en-us/microsoft-edge/devtools-guide/performance">Microsoft Edge å¼€å‘äººå‘˜å·¥å…· - æ€§èƒ½</a></li>
<li><a href="https://developers.google.com/web/tools/chrome-devtools/rendering-tools/js-execution">Chrome DevTools JavaScript Profiler</a></li>
</ul>
<a class="header" href="print.html#consoletimeå’ŒconsoletimeendåŠŸèƒ½" id="consoletimeå’ŒconsoletimeendåŠŸèƒ½"><h3><code>console.time</code>å’Œ<code>console.timeEnd</code>åŠŸèƒ½</h3></a>
<p><code>console.time</code>å’Œ<code>console.timeEnd</code>å‡½æ•°å…è®¸æ‚¨å°†å‘½åæ“ä½œçš„æ—¶é—´è®°å½•åˆ°æµè§ˆå™¨çš„å¼€å‘äººå‘˜å·¥å…·æ§åˆ¶å°.</p>
<p>ä½ å¯ä»¥ç”¨å®ƒå°†å®ƒä»¬å¯¼å…¥ Rust<code>wasm-bindgen</code> å£°æ˜ä¸­:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
#[wasm_bindgen]
extern {
    #[wasm_bindgen(js_namespace = console)]
    fn time(name: &amp;str);

    #[wasm_bindgen(js_namespace = console)]
    fn timeEnd(name: &amp;str);
}
#}</code></pre></pre>
<p>å› ä¸º<code>console.timeEnd</code>æœ‰å¯¹åº”çš„<code>console.time</code>è°ƒç”¨,å°†å®ƒä»¬åŒ…è£…åœ¨ RAII ç±»å‹ä¸­å¾ˆæ–¹ä¾¿:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
pub struct Timer&lt;'a&gt; {
    name: &amp;'a str,
}

impl&lt;'a&gt; Timer&lt;'a&gt; {
    pub fn new(name: &amp;'a str) -&gt; Timer&lt;'a&gt; {
        time(name);
        Timer { name }
    }
}

impl&lt;'a&gt; Drop for Timer&lt;'a&gt; {
    fn drop(&amp;mut self) {
        timeEnd(self.name);
    }
}
#}</code></pre></pre>
<p>ç„¶å,æˆ‘ä»¬å¯ä»¥è®¡ç®—æ¯ä¸ªæ—¶é—´<code>Universe::tick</code>,å°†æ­¤ä»£ç æ®µæ·»åŠ åˆ°æ–¹æ³•çš„é¡¶éƒ¨:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
let _timer = Timer::new(&quot;Universe::tick&quot;);
#}</code></pre></pre>
<p>ç°åœ¨æ¯æ¬¡è¿è¡Œçš„æ—¶é—´<code>Universe::tick</code>éƒ½ä¼šè®°å½•äº†:</p>
<p><a href="./images/game-of-life/console-time.png"><img src="./images/game-of-life/console-time.png" alt="Screenshot of console.time logs" /></a></p>
<p>å¦å¤–,<code>console.time</code>å’Œ<code>console.timeEnd</code>å¯¹å°†æ˜¾ç¤ºåœ¨,æµè§ˆå™¨çš„åˆ†æå™¨çš„&quot;timeline&quot;æˆ–&quot;waterfall&quot;è§†å›¾ä¸­:</p>
<p><a href="./images/game-of-life/console-time-in-profiler.png"><img src="./images/game-of-life/console-time-in-profiler.png" alt="Screenshot of console.time logs" /></a></p>
<a class="header" href="print.html#aè¿ç”¨benchä¸æœ¬åœ°ä»£ç " id="aè¿ç”¨benchä¸æœ¬åœ°ä»£ç "><h3>è¿ç”¨<code>#[bench]</code>ä¸æœ¬åœ°ä»£ç </h3></a>
<p>æˆ‘ä»¬é€šå¸¸ä¹Ÿå¯ä»¥é€šè¿‡ç¼–å†™,æ¥åˆ©ç”¨æˆ‘ä»¬æ“ä½œç³»ç»Ÿçš„æœ¬æœºä»£ç è°ƒè¯•å·¥å…·<code>#[test]</code>è€Œä¸æ˜¯åœ¨ Web ä¸Šè°ƒè¯•,æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç¼–å†™<code>#[bench]</code>åŠŸèƒ½.</p>
<p>ç„¶è€Œ!åœ¨ä¸ºæœ¬æœºä»£ç åˆ†ææŠ•å…¥å¤§é‡ç²¾åŠ›ä¹‹å‰,è¯·ç¡®ä¿æ‚¨çŸ¥é“ç“¶é¢ˆåœ¨ WebAssembly ä¸­! ä½¿ç”¨æµè§ˆå™¨çš„åˆ†æå™¨ç¡®è®¤è¿™ä¸€ç‚¹,å¦åˆ™æ‚¨å¯èƒ½ä¼šæµªè´¹æ—¶é—´æ¥ä¼˜åŒ–ä¸çƒ­çš„ä»£ç .</p>
<a class="header" href="print.html#aå‘å±•æˆ‘ä»¬çš„ç”Ÿå‘½åšå¼ˆå®‡å®™" id="aå‘å±•æˆ‘ä»¬çš„ç”Ÿå‘½åšå¼ˆå®‡å®™"><h2>å‘å±•æˆ‘ä»¬çš„ç”Ÿå‘½åšå¼ˆå®‡å®™</h2></a>
<p>å¦‚æœæˆ‘ä»¬è®©æˆ‘ä»¬çš„ç”Ÿå‘½æ¸¸æˆä¸–ç•Œæ›´å¤§,ä¼šå‘ç”Ÿä»€ä¹ˆ? ä½¿ç”¨ 128 x 128 å®‡å®™æ›¿æ¢ 64 x 64 å®‡å®™å¯¼è‡´ FPS ä» å¹³æ»‘çš„ 60 ä¸‹é™åˆ° 40-ish.</p>
<p>å¦‚æœæˆ‘ä»¬è®°å½•ä¸€ä¸ªé…ç½®æ–‡ä»¶å¹¶æŸ¥çœ‹ç€‘å¸ƒè§†å›¾,æˆ‘ä»¬ä¼šçœ‹åˆ°æ¯ä¸ªåŠ¨ç”»å¸§èŠ±è´¹è¶…è¿‡ 20 æ¯«ç§’. å›æƒ³ä¸€ä¸‹,æ¯ç§’ 60 å¸§,æ¯å¸§å¤§æ¦‚ 16 æ¯«ç§’. 16 æ¯«ç§’å†…ä¸ä»…ä»…æ˜¯æœ‰æˆ‘ä»¬çš„ JavaScript å’Œ WebAssembly ,è¿˜æœ‰æµè§ˆå™¨æ­£åœ¨åšçš„å…¶ä»–äº‹æƒ…,æ¯”å¦‚ç»˜åˆ¶é¡µé¢.</p>
<p><a href="./images/game-of-life/drawCells-before-waterfall.png"><img src="./images/game-of-life/drawCells-before-waterfall.png" alt="Screenshot of a waterfall view of rendering a frame" /></a></p>
<p>å¦‚æœæˆ‘ä»¬çœ‹ä¸€ä¸‹å•ä¸ªåŠ¨ç”»å¸§ä¸­å‘ç”Ÿçš„äº‹æƒ…,æˆ‘ä»¬å°±ä¼šçœ‹åˆ°<code>CanvasRenderingContext2D.fillStyle</code> å¾ˆé•¿!</p>
<p><a href="./images/game-of-life/drawCells-before-flamegraph.png"><img src="./images/game-of-life/drawCells-before-flamegraph.png" alt="Screenshot of a flamegraph view of rendering a frame" /></a></p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹è°ƒç”¨æ ‘çš„å¤šä¸ªå¸§çš„èšåˆæ¥ç¡®è®¤è¿™ä¸æ˜¯å¼‚å¸¸:</p>
<p><a href="./images/game-of-life/drawCells-before-calltree.png"><img src="./images/game-of-life/drawCells-before-calltree.png" alt="Screenshot of a flamegraph view of rendering a frame" /></a></p>
<p>æˆ‘ä»¬å°†è¿‘ 40%çš„æ—¶é—´éƒ½èŠ±åœ¨äº†è¿™ä¸ªå‡½æ•°èº«ä¸Š!</p>
<blockquote>
<p>âš¡ æˆ‘ä»¬å¯èƒ½å¯¹æ­¤æœ‰æ‰€æœŸå¾…<code>tick</code>æ–¹æ³•æ˜¯æ€§èƒ½ç“¶é¢ˆ,ä½†äº‹å®å¹¶éå¦‚æ­¤. è®©åˆ†æå¼•å¯¼æ‚¨çš„æ³¨æ„åŠ›,è€Œä¸æ˜¯æŠŠæ—¶é—´èŠ±åœ¨æ‚¨æƒ³å½“ç„¶çš„åœ°æ–¹.</p>
</blockquote>
<p>åœ¨<code>drawCells</code>å‡½æ•°,åœ¨æ¯ä¸ªåŠ¨ç”»å¸§ä¸Š,<code>fillStyle</code>ä¸ºå®‡å®™ä¸­çš„æ¯ä¸ªå•å…ƒæ ¼è®¾ç½®ä¸€æ¬¡:</p>
<pre><code class="language-js">for (let row = 0; row &lt; height; row++) {
  for (let col = 0; col &lt; width; col++) {
    const idx = getIndex(row, col);

    ctx.fillStyle = cells[idx] === DEAD ? DEAD_COLOR : ALIVE_COLOR;

    ctx.fillRect(
      col * (CELL_SIZE + 1) + 1,
      row * (CELL_SIZE + 1) + 1,
      CELL_SIZE,
      CELL_SIZE
    );
  }
}
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»å‘ç°äº†è¿™ä¸ª<code>fillStyle</code>æ˜¯å¦‚æ­¤æ˜‚è´µ,æˆ‘ä»¬å¯ä»¥åšäº›ä»€ä¹ˆæ¥é¿å…ç»å¸¸è®¾ç½®å®ƒ? æ”¹å˜<code>fillStyle</code>å–å†³äºç»†èƒæ˜¯æ´»ç€è¿˜æ˜¯æ­»äº¡. å¦‚æœæˆ‘ä»¬è®¾å®š<code>fillStyle = ALIVE_COLOR</code>, ç„¶ååœ¨ä¸€æ¬¡æ€»ç»˜åˆ¶æ¯ä¸ªæ´»ç»†èƒ,ç„¶åè®¾ç½®<code>fillStyle = DEAD_COLOR</code>,å¹¶åœ¨å¦ä¸€æ¬¡æ€»ç»˜åˆ¶æ¯ä¸ªæ­»ç»†èƒ,é‚£ä¹ˆæˆ‘ä»¬åªè®¾ç½®<code>fillStyle</code>ä¸¤æ¬¡,è€Œä¸æ˜¯æ¯ä¸ªç»†èƒä¸€æ¬¡.</p>
<pre><code class="language-js">// Alive cells.
ctx.fillStyle = ALIVE_COLOR;
for (let row = 0; row &lt; height; row++) {
  for (let col = 0; col &lt; width; col++) {
    const idx = getIndex(row, col);
    if (cells[idx] !== ALIVE) {
      continue;
    }

    ctx.fillRect(
      col * (CELL_SIZE + 1) + 1,
      row * (CELL_SIZE + 1) + 1,
      CELL_SIZE,
      CELL_SIZE
    );
  }
}

// Dead cells.
ctx.fillStyle = DEAD_COLOR;
for (let row = 0; row &lt; height; row++) {
  for (let col = 0; col &lt; width; col++) {
    const idx = getIndex(row, col);
    if (cells[idx] !== DEAD) {
      continue;
    }

    ctx.fillRect(
      col * (CELL_SIZE + 1) + 1,
      row * (CELL_SIZE + 1) + 1,
      CELL_SIZE,
      CELL_SIZE
    );
  }
}
</code></pre>
<p>ä¿å­˜è¿™äº›æ›´æ”¹å¹¶åˆ·æ–°å<a href="http://localhost:8080/">http://localhost:8080/</a>,æ¸²æŸ“å›åˆ°å¹³æ»‘æ¯ç§’ 60 å¸§.</p>
<p>å¦‚æœæˆ‘ä»¬é‡‡ç”¨å¦ä¸€ä¸ªé…ç½®æ–‡ä»¶,æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç°åœ¨æ¯ä¸ªåŠ¨ç”»å¸§åªèŠ±è´¹å¤§çº¦ 10 æ¯«ç§’.</p>
<p><a href="./images/game-of-life/drawCells-after-waterfall.png"><img src="./images/game-of-life/drawCells-after-waterfall.png" alt="Screenshot of a waterfall view of rendering a frame after the drawCells changes" /></a></p>
<p>æ‰“ç ´äº†è¶…æ—¶å¸§,æˆ‘ä»¬çœ‹åˆ°äº†<code>fillStyle</code>æ˜‚è´µçš„æˆæœ¬æ¶ˆå¤±äº†,æˆ‘ä»¬çš„å¤§éƒ¨åˆ†æ—¶é—´èŠ±åœ¨äº†å†…éƒ¨<code>fillRect</code>,ç»˜åˆ¶æ¯ä¸ªå•å…ƒæ ¼çš„çŸ©å½¢.</p>
<p><a href="./images/game-of-life/drawCells-after-flamegraph.png"><img src="./images/game-of-life/drawCells-after-flamegraph.png" alt="Screenshot of a flamegraph view of rendering a frame after the drawCells changes" /></a></p>
<a class="header" href="print.html#aè®©æ—¶é—´æ›´å¿«" id="aè®©æ—¶é—´æ›´å¿«"><h2>è®©æ—¶é—´æ›´å¿«</h2></a>
<p>æœ‰äº›äººä¸å–œæ¬¢ç­‰å¾…,è®¤ä¸ºæ¯ä¸ªåŠ¨ç”»å¸§æ˜¯ 9 ä¸ª <code>tick</code>. æˆ‘ä»¬å¯ä»¥ä¿®æ”¹<code>renderLoop</code>å‡½æ•°,è¿™å¾ˆå®¹æ˜“åšåˆ°è¿™ä¸€ç‚¹:</p>
<pre><code class="language-js">for (let i = 0; i &lt; 9; i++) {
  universe.tick();
}
</code></pre>
<p>åœ¨æˆ‘çš„æœºå™¨ä¸Š,è¿™ä½¿æˆ‘ä»¬æ¢å¤åˆ°æ¯ç§’ 35 å¸§. ä¸å¥½. æˆ‘ä»¬æƒ³è¦é‚£ä¸ªç¾ä¸½çš„ <code>60!</code></p>
<p>ç°åœ¨æˆ‘ä»¬çŸ¥é“æ—¶é—´èŠ±åœ¨äº†<code>Universe::tick</code>,è®©æˆ‘ä»¬æ·»åŠ ä¸€äº›<code>Timer</code>,ç”¨å®ƒæ¥åŒ…è£…,ç»™äºˆ<code>console.time</code>å’Œ<code>console.timeEnd</code>è¿è¡Œ,å¼•å¯¼æˆ‘ä»¬. æˆ‘çš„å‡è®¾æ˜¯,åˆ†é…ä¸€ä¸ªæ–°çš„ç»†èƒè½½ä½“,å¹¶åœ¨æ¯ä¸ªæ»´ç­”ä¸Šé‡Šæ”¾æ—§çš„æ˜¯æ˜‚è´µçš„æˆæœ¬,å ç”¨äº†æˆ‘ä»¬æ—¶é—´é¢„ç®—çš„å¾ˆå¤§ä¸€éƒ¨åˆ†.</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
pub fn tick(&amp;mut self) {
    let _timer = Timer::new(&quot;Universe::tick&quot;);

    let mut next = {
        let _timer = Timer::new(&quot;allocate next cells&quot;);
        self.cells.clone()
    };

    {
        let _timer = Timer::new(&quot;new generation&quot;);
        for row in 0..self.height {
            for col in 0..self.width {
                let idx = self.get_index(row, col);
                let cell = self.cells[idx];
                let live_neighbors = self.live_neighbor_count(row, col);

                let next_cell = match (cell, live_neighbors) {
                    // Rule 1: Any live cell with fewer than two live neighbours
                    // dies, as if caused by underpopulation.
                    (Cell::Alive, x) if x &lt; 2 =&gt; Cell::Dead,
                    // Rule 2: Any live cell with two or three live neighbours
                    // lives on to the next generation.
                    (Cell::Alive, 2) | (Cell::Alive, 3) =&gt; Cell::Alive,
                    // Rule 3: Any live cell with more than three live
                    // neighbours dies, as if by overpopulation.
                    (Cell::Alive, x) if x &gt; 3 =&gt; Cell::Dead,
                    // Rule 4: Any dead cell with exactly three live neighbours
                    // becomes a live cell, as if by reproduction.
                    (Cell::Dead, 3) =&gt; Cell::Alive,
                    // All other cells remain in the same state.
                    (otherwise, _) =&gt; otherwise,
                };

                next[idx] = next_cell;
            }
        }
    }

    let _timer = Timer::new(&quot;free old cells&quot;);
    self.cells = next;
}
#}</code></pre></pre>
<p>çœ‹çœ‹æ—¶é—´,å¾ˆæ˜æ˜¾æˆ‘çš„å‡è®¾æ˜¯ä¸æ­£ç¡®çš„: å®é™…ä¸Šç»å¤§éƒ¨åˆ†æ—¶é—´èŠ±åœ¨,è®¡ç®—ä¸‹ä¸€ä»£ç»†èƒä¸Š. ä»¤äººæƒŠè®¶çš„æ˜¯,åœ¨æ¯ä¸ªå•å…ƒä¸Šåˆ†é…å’Œé‡Šæ”¾è½½ä½“ä¼¼ä¹å…·æœ‰å¯å¿½ç•¥çš„æˆæœ¬. å†ä¸€æ¬¡å‘Šè¯‰æŒ‡å¯¼æˆ‘ä»¬çš„åˆ†æå·¥ä½œ!</p>
<p><a href="./images/game-of-life/console-time-in-universe-tick.png"><img src="./images/game-of-life/console-time-in-universe-tick.png" alt="Screenshot of a Universe::tick timer results" /></a></p>
<p>æˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªæœ¬æœºä»£ç <code>#[bench]</code>æ¥åšåŒæ ·çš„äº‹æƒ… - æˆ‘ä»¬çš„ WebAssembly æ­£åœ¨åšçš„, ä½†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ›´æˆç†Ÿçš„åˆ†æå·¥å…·. è¿™å°±æ˜¯æ–°çš„<code>benches/bench.rs</code>:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#![feature(test)]

#fn main() {
extern crate test;
extern crate wasm_game_of_life;

#[bench]
fn universe_ticks(b: &amp;mut test::Bencher) {
    let mut universe = wasm_game_of_life::Universe::new();

    b.iter(|| {
        universe.tick();
    });
}
#}</code></pre></pre>
<p>æˆ‘ä»¬è¿˜è¦ç»™ä¸Šæ‰€æœ‰çš„<code>#[wasm_bindgen]</code>æ³¨é‡Šå’Œ<code>&quot;cdylib&quot;</code> - æ¥è‡ª<code>Cargo.toml</code>, å¦åˆ™æ„å»ºæœ¬æœºä»£ç å°†å¤±è´¥å¹¶å‡ºç°é“¾æ¥é”™è¯¯.</p>
<p>æœ‰äº†è¿™ä¸€åˆ‡,æˆ‘ä»¬å°±å¯ä»¥è¿è¡Œäº†<code>cargo bench</code>ç¼–è¯‘å¹¶è¿è¡Œæˆ‘ä»¬çš„åŸºå‡†æµ‹è¯•!</p>
<pre><code>$ cargo bench
    Finished release [optimized + debuginfo] target(s) in 0.0 secs
     Running target/release/deps/wasm_game_of_life-91574dfbe2b5a124

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out

     Running target/release/deps/bench-8474091a05cfa2d9

running 1 test
test universe_ticks ... bench:     664,421 ns/iter (+/- 51,926)

test result: ok. 0 passed; 0 failed; 0 ignored; 1 measured; 0 filtered out
</code></pre>
<p>è¿™ä¹Ÿå‘Šè¯‰æˆ‘ä»¬äºŒè¿›åˆ¶æ–‡ä»¶çš„ä½ç½®,æˆ‘ä»¬å¯ä»¥å†æ¬¡è¿è¡ŒåŸºå‡†æµ‹è¯•,ä½†è¿™æ¬¡æ˜¯åœ¨æˆ‘ä»¬çš„æ“ä½œç³»ç»Ÿçš„åˆ†æå™¨ä¸‹. å°±æˆ‘è€Œè¨€,æˆ‘è¿è¡Œåœ¨ Linux,æ‰€ä»¥<a href="https://perf.wiki.kernel.org/index.php/Main_Page"><code>perf</code></a>æ˜¯æˆ‘å°†ä½¿ç”¨çš„æ¢æŸ¥å™¨:</p>
<pre><code>$ perf record -g target/release/deps/bench-8474091a05cfa2d9 --bench
running 1 test
test universe_ticks ... bench:     635,061 ns/iter (+/- 38,764)

test result: ok. 0 passed; 0 failed; 0 ignored; 1 measured; 0 filtered out

[ perf record: Woken up 1 times to write data ]
[ perf record: Captured and wrote 0.178 MB perf.data (2349 samples) ]
</code></pre>
<p>ä½¿ç”¨<code>perf report</code>åŠ è½½é…ç½®æ–‡ä»¶å,è¡¨æ˜æˆ‘ä»¬æ‰€æœ‰çš„æ—¶é—´éƒ½èŠ±åœ¨äº†<code>Universe::tick</code>,å¦‚é¢„æœŸçš„é‚£æ ·:</p>
<p><a href="./images/game-of-life/bench-perf-report.png"><img src="./images/game-of-life/bench-perf-report.png" alt="Screenshot of perf report" /></a></p>
<p><code>perf</code>æ³¨é‡Šè¯´æ˜å‡½æ•°çš„æ—¶é—´,é€šè¿‡æŒ‡ä»¤<code>a</code>:</p>
<p><a href="./images/game-of-life/bench-perf-annotate.png"><img src="./images/game-of-life/bench-perf-annotate.png" alt="Screenshot of perf's instruction annotation" /></a></p>
<p>è¿™å‘Šè¯‰æˆ‘ä»¬ <code>26.67%</code> çš„æ—¶é—´ç”¨äºæ±‚å’Œç›¸é‚»å•å…ƒæ ¼çš„å€¼,<code>23.41%</code> çš„æ—¶é—´ç”¨äºè·å–é‚»å±…çš„åˆ—ç´¢å¼•,å¦å¤– <code>15.42%</code> çš„æ—¶é—´ç”¨äºè·å–é‚»å±…çš„è¡Œç´¢å¼•. åœ¨è¿™ä¸‰ä¸ªæœ€æ˜‚è´µçš„æŒ‡ä»¤ä¸­,ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªæŒ‡ä»¤éƒ½å¾ˆæ˜‚è´µä¹‹äº<code>div è¯´æ˜</code>. <code>div</code>å®ç°æ¨¡æ•°ç´¢å¼•é€»è¾‘åœ¨<code>Universe::live_neighbor_count</code>.</p>
<p>å›æƒ³ä¸€ä¸‹<code>live_neighbor_count</code>å®šä¹‰:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
fn live_neighbor_count(&amp;self, row: u32, column: u32) -&gt; u8 {
    let mut count = 0;
    for delta_row in [self.height - 1, 0, 1].iter().cloned() {
        for delta_col in [self.width - 1, 0, 1].iter().cloned() {
            if delta_row == 0 &amp;&amp; delta_col == 0 {
                continue;
            }

            let neighbor_row = (row + delta_row) % self.height;
            let neighbor_col = (column + delta_col) % self.width;
            let idx = self.get_index(neighbor_row, neighbor_col);
            count += self.cells[idx] as u8;
        }
    }
    count
}
#}</code></pre></pre>
<p>æˆ‘ä»¬ä½¿ç”¨ å¤šæ¡ä»¶ çš„åŸå› æ˜¯ä¸ºäº†é¿å…ä½¿ä»£ç æ··ä¹±, é€šè¿‡ä½¿ç”¨<code>if</code>,ç¬¬ä¸€è¡Œæˆ–æœ€åä¸€è¡Œæˆ–åˆ—è¾¹ç¼˜æƒ…å†µçš„æ¡ä»¶. ä½†æˆ‘ä»¬ä»˜å‡ºçš„ä»£ä»·æ˜¯<code>div</code>, ä¹Ÿå°±æ˜¯æœ€å¸¸è§çš„æƒ…å†µ,æ—¢ä¸æ˜¯<code>row</code>ä¹Ÿä¸æ˜¯<code>column</code>,è€Œæ˜¯åœ¨å®‡å®™çš„è¾¹ç¼˜,ä»–ä»¬ä¸éœ€è¦æ¨¡æ•°åŒ…è£¹å¤„ç†. ç›¸å,å¦‚æœæˆ‘ä»¬ä½¿ç”¨å¤šä¸ª<code>if</code>ä¸ºè¾¹ç¼˜æƒ…å†µ,å¹¶å±•å¼€æ­¤å¾ªç¯,CPU çš„åˆ†æ”¯é¢„æµ‹å™¨<em>åº”è¯¥</em>å¯ä»¥å¾ˆå¥½åœ°é¢„æµ‹å®ƒ.</p>
<p>æˆ‘ä»¬æ”¹å†™<code>live_neighbor_count</code>,åƒè¿™æ ·è¿™ä¸ª:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
fn live_neighbor_count(&amp;self, row: u32, column: u32) -&gt; u8 {
    let mut count = 0;

    let north = if row == 0 {
        self.height - 1
    } else {
        row - 1
    };

    let south = if row == self.height - 1 {
        0
    } else {
        row + 1
    };

    let west = if column == 0 {
        self.width - 1
    } else {
        column - 1
    };

    let east = if column == self.width - 1 {
        0
    } else {
        column + 1
    };

    let nw = self.get_index(north, west);
    count += self.cells[nw] as u8;

    let n = self.get_index(north, column);
    count += self.cells[n] as u8;

    let ne = self.get_index(north, east);
    count += self.cells[ne] as u8;

    let w = self.get_index(row, west);
    count += self.cells[w] as u8;

    let e = self.get_index(row, east);
    count += self.cells[e] as u8;

    let sw = self.get_index(south, west);
    count += self.cells[sw] as u8;

    let s = self.get_index(south, column);
    count += self.cells[s] as u8;

    let se = self.get_index(south, east);
    count += self.cells[se] as u8;

    count
}
#}</code></pre></pre>
<p>ç°åœ¨è®©æˆ‘ä»¬å†æ¬¡è¿è¡ŒåŸºå‡†æµ‹è¯•!</p>
<pre><code>$ cargo bench
   Compiling wasm_game_of_life v0.1.0 (file:///home/fitzgen/wasm_game_of_life)
    Finished release [optimized + debuginfo] target(s) in 0.82 secs
     Running target/release/deps/wasm_game_of_life-91574dfbe2b5a124

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out

     Running target/release/deps/bench-8474091a05cfa2d9

running 1 test
test universe_ticks ... bench:      87,258 ns/iter (+/- 14,632)

test result: ok. 0 passed; 0 failed; 0 ignored; 1 measured; 0 filtered out
</code></pre>
<p>çœ‹èµ·æ¥å¥½å¤šäº†! æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒæœ‰å¤šå¥½,é€šè¿‡<a href="https://github.com/BurntSushi/cargo-benchcmp"><code>cargo benchcmp</code></a>å·¥å…·:</p>
<pre><code>$ cargo benchcmp before.txt after.txt
 name            before.txt ns/iter  after.txt ns/iter  diff ns/iter   diff %  speedup
 universe_ticks  664,421             87,258                 -577,163  -86.87%   x 7.61
</code></pre>
<p>å“‡! 7.61 å€åŠ é€Ÿ!</p>
<p>WebAssembly æ˜ å°„åˆ°å¸¸è§çš„ç¡¬ä»¶æ¶æ„,ä½†æˆ‘ä»¬ç¡®å®éœ€è¦ä¸ºè¿™ä¸ªæœ¬æœºä»£ç åŠ é€Ÿ.</p>
<p>è®©æˆ‘ä»¬æ¢å¤æ‰€æœ‰<code>#[wasm_bindgen]</code>æ³¨é‡Š,é‡å»º<code>.wasm</code>åŒ<code>npm run build-release</code>,å¹¶åˆ·æ–°<a href="http://localhost:8080/">http://localhost:8080/</a>. åœ¨æˆ‘çš„æœºå™¨ä¸Š,é¡µé¢å†æ¬¡ä»¥æ¯ç§’ 60 å¸§çš„é€Ÿåº¦è¿è¡Œ,å¹¶ä¸”ä½¿ç”¨æµè§ˆå™¨çš„åˆ†æå™¨è®°å½•,å¦ä¸€ä¸ªé…ç½®æ–‡ä»¶æ˜¾ç¤ºæ¯ä¸ªåŠ¨ç”»å¸§å¤§çº¦éœ€è¦ 10 æ¯«ç§’.</p>
<p>æˆåŠŸ!</p>
<p><a href="./images/game-of-life/waterfall-after-branches-and-unrolling.png"><img src="./images/game-of-life/waterfall-after-branches-and-unrolling.png" alt="Screenshot of a waterfall view of rendering a frame after replacing modulos with branches" /></a></p>
<a class="header" href="print.html#aç»ƒä¹ -5" id="aç»ƒä¹ -5"><h2>ç»ƒä¹ </h2></a>
<ul>
<li>
<p>åœ¨è¿™ä¸€ç‚¹ä¸Š,ä¸‹ä¸€ä¸ªåŠ é€Ÿ<code>Universe::tick</code>æ˜¯åˆ é™¤åˆ†é…å’Œå…è´¹. å®ç°ç»†èƒçš„åŒç¼“å†²,å…¶ä¸­<code>Universe</code>ç»´æŠ¤ä¸¤ä¸ªå‘é‡,å¹¶ä¸”ä¸é‡Šæ”¾å®ƒä»¬ä¸­çš„ä»»ä½•ä¸€ä¸ª,é‚£ä¹ˆå°±æ°¸è¿œä¸ä¼šåˆ†é…æ–°çš„ç¼“å†²åŒº<code>tick</code>.</p>
</li>
<li>
<p>ä»&quot;å®ç°ç”Ÿå‘½&quot;ä¸€ç« çš„å®ç°æ˜¯ åŸºäº delta çš„è®¾è®¡,å…¶ä¸­ Rust ä»£ç  è¿”å› å°†çŠ¶æ€æ›´æ”¹ä¸º JavaScript çš„å•å…ƒæ ¼åˆ—è¡¨. è¿™ä¼šä½¿æ¸²æŸ“<code>&lt;canvas&gt;</code>æ›´å¿«? ä½ å¯ä»¥å®ç°è¿™ä¸ªè®¾è®¡, è€Œä¸å¿…åœ¨æ¯ä¸ªæ»´ç­”ä¸Šåˆ†é…ä¸€ä¸ªæ–°çš„å¢é‡åˆ—è¡¨å— ?</p>
</li>
<li>
<p>æ­£å¦‚æˆ‘ä»¬çš„åˆ†æå‘æˆ‘ä»¬å±•ç¤ºçš„é‚£æ ·,2D<code>&lt;canvas&gt;</code>æ¸²æŸ“é€Ÿåº¦ä¸æ˜¯ç‰¹åˆ«å¿«. ç”¨ <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API">WebGL</a> æ¸²æŸ“å™¨æ›¿æ¢ 2 canvas æ¸²æŸ“å™¨. WebGL ç‰ˆæœ¬çš„é€Ÿåº¦æœ‰å¤šå¿« ? åœ¨ WebGL æ¸²æŸ“æˆä¸ºç“¶é¢ˆä¹‹å‰,ä½ èƒ½åˆ›é€ å¤šå¤§çš„å®‡å®™ ?</p>
</li>
</ul>
<a class="header" href="print.html#aæ”¶ç¼©wasmå°ºå¯¸" id="aæ”¶ç¼©wasmå°ºå¯¸"><h1>æ”¶ç¼©<code>.wasm</code>å°ºå¯¸</h1></a>
<p>æœ¬ç« å°†æ•™ä½ å¦‚ä½•ä¼˜åŒ–ä½ çš„<code>.wasm</code>å¤§å°,ä»¥åŠå¦‚ä½•æ”¹å˜Rustæºä»£ç ä»¥ç¼©å°<code>.wasm</code>ä»£ç .</p>
<a class="header" href="print.html#aä¼˜åŒ–ä»£ç å¤§å°çš„æ„å»º" id="aä¼˜åŒ–ä»£ç å¤§å°çš„æ„å»º"><h2>ä¼˜åŒ–ä»£ç å¤§å°çš„æ„å»º</h2></a>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>rustc</code>å¾ˆå¤šé…ç½®é€‰é¡¹å˜å°<code>.wasm</code>äºŒè¿›åˆ¶æ–‡ä»¶. åœ¨æŸäº›æƒ…å†µä¸‹,æˆ‘ä»¬çš„ç¼–è¯‘æ—¶é—´è¾ƒé•¿,<code>.wasm</code>æ›´å°. åœ¨å…¶ä»–æƒ…å†µä¸‹,æˆ‘ä»¬ä»¥è¾ƒå°çš„ä»£ç å¤§å°äº¤æ¢WebAssembly çš„è¿è¡Œæ—¶é€Ÿåº¦. æˆ‘ä»¬åº”è¯¥è®¤è¯†åˆ°æ¯ä¸ªé€‰é¡¹çš„æƒè¡¡,å¹¶ä¸”åœ¨æˆ‘ä»¬äº¤æ¢ä»£ç å¤§å°,æ¦‚å†µå’Œåº¦é‡çš„è¿è¡Œæ—¶é€Ÿåº¦, ä»¥ä¾¿åšå‡ºå…³äºäº¤æ˜“æ˜¯å¦å€¼å¾—çš„æ˜æ™ºå†³ç­–.</p>
<a class="header" href="print.html#aç¦ç”¨è°ƒè¯•ç¬¦å·" id="aç¦ç”¨è°ƒè¯•ç¬¦å·"><h3>ç¦ç”¨è°ƒè¯•ç¬¦å·</h3></a>
<p>åŒ…å«ç”¨äºè°ƒè¯•çš„å‡½æ•°åå­—ç¬¦ä¸²çš„éƒ¨åˆ†, å ç”¨çš„ç©ºé—´æ¯”æ‚¨æƒ³è±¡çš„è¦å¤š. å¦‚æœæ‚¨æ²¡æœ‰è°ƒè¯•æˆ–åˆ†æ, å¹¶å¸Œæœ›ç”Ÿæˆä¸€ä¸ªå°çš„<code>.wasm</code>äºŒè¿›åˆ¶,éœ€è¦ç¦ç”¨è¿™äº›åç§°.</p>
<p>åœ¨<code>Cargo.toml</code>è®¾ç½®:</p>
<pre><code class="language-toml">[profile.release]
debug = false
</code></pre>
<a class="header" href="print.html#aä½¿ç”¨é“¾æ¥æ—¶é—´ä¼˜åŒ–-lto-è¿›è¡Œç¼–è¯‘" id="aä½¿ç”¨é“¾æ¥æ—¶é—´ä¼˜åŒ–-lto-è¿›è¡Œç¼–è¯‘"><h3>ä½¿ç”¨é“¾æ¥æ—¶é—´ä¼˜åŒ– (LTO) è¿›è¡Œç¼–è¯‘</h3></a>
<p>åœ¨<code>Cargo.toml</code>,æ·»åŠ <code>lto = true</code>åœ¨<code>[profile.release]</code>éƒ¨åˆ†:</p>
<pre><code class="language-toml">[profile.release]
lto = true
</code></pre>
<p>è¿™ä¸º LLVM æä¾›äº†æ›´å¤šå†…è”å’Œä¿®å‰ªåŠŸèƒ½çš„æœºä¼š. å®ƒä¸ä»…ä¼šæˆåŠŸ<code>.wasm</code>æ›´å°,ä½†å®ƒä¹Ÿä¼šåœ¨è¿è¡Œæ—¶æ›´å¿«! ç¼ºç‚¹æ˜¯ç¼–è¯‘éœ€è¦æ›´é•¿æ—¶é—´.</p>
<a class="header" href="print.html#aå‘Šè¯‰-llvm-ä¼˜åŒ–å¤§å°è€Œä¸æ˜¯é€Ÿåº¦" id="aå‘Šè¯‰-llvm-ä¼˜åŒ–å¤§å°è€Œä¸æ˜¯é€Ÿåº¦"><h3>å‘Šè¯‰ LLVM ä¼˜åŒ–å¤§å°è€Œä¸æ˜¯é€Ÿåº¦</h3></a>
<p>é»˜è®¤æƒ…å†µä¸‹,è°ƒæ•´LLVMçš„ä¼˜åŒ–è¿‡ç¨‹æ˜¯æé«˜é€Ÿåº¦,è€Œä¸æ˜¯å¤§å°. æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹ç›®æ ‡, æ¥å°†ç›®æ ‡æ›´æ”¹ä¸ºä»£ç å¤§å°</p>
<p><code>[profile.release]</code>éƒ¨åˆ†:</p>
<pre><code class="language-toml">[profile.release]
opt-level = 's'
</code></pre>
<p>æˆ–è€…,æ›´è¿›ä¸€æ­¥ä¼˜åŒ–å°ºå¯¸,ä»¥æ›´å¤§çš„é€Ÿåº¦æˆæœ¬:</p>
<pre><code class="language-toml">[profile.release]
opt-level = 'z'
</code></pre>
<p>è¯·æ³¨æ„,ä»¤äººæƒŠè®¶çš„æ˜¯,<code>opt-level = &quot;s&quot;</code>,æœ‰æ—¶ä¼šå¯¼è‡´ æ¯” <code>opt-level = &quot;z&quot;</code> æ›´å°. æ€»æ˜¯è¦å¯¹æ¯”çœ‹çœ‹!</p>
<a class="header" href="print.html#aä½¿ç”¨wasm-optå·¥å…·" id="aä½¿ç”¨wasm-optå·¥å…·"><h3>ä½¿ç”¨<code>wasm-opt</code>å·¥å…·</h3></a>
<p>è¯¥<a href="https://github.com/WebAssembly/binaryen">Binaryen</a>toolkit æ˜¯ç‰¹å®šäº WebAssemblyçš„ç¼–è¯‘å™¨å·¥å…·çš„é›†åˆ. å®ƒæ¯”LLVM çš„WebAssemblyåç«¯ æ›´è¿›ä¸€æ­¥.</p>
<p>ä½¿ç”¨<code>wasm-opt</code>å,å¤„ç† LLVM ç”Ÿæˆçš„<code>.wasm</code>äºŒè¿›åˆ¶æ–‡ä»¶é€šå¸¸å¯ä»¥èŠ‚çœ15-20%çš„ä»£ç å¤§å°. å®ƒé€šå¸¸è¿˜èƒ½å¸®è¿è¡Œæ—¶åŠ é€Ÿ!</p>
<pre><code class="language-bash"># Optimize for size.
wasm-opt -Os -o output.wasm input.wasm

# Optimize aggressively for size.
wasm-opt -Oz -o output.wasm input.wasm

# Optimize for speed.
wasm-opt -O -o output.wasm input.wasm

# Optimize aggressively for speed.
wasm-opt -O3 -o output.wasm input.wasm
</code></pre>
<a class="header" href="print.html#aè¿™äº›æ„å»ºé…ç½®è®©æˆ‘ä»¬çš„ç”Ÿå‘½æ¸¸æˆwasmäºŒè¿›åˆ¶æœ‰å¤šå°" id="aè¿™äº›æ„å»ºé…ç½®è®©æˆ‘ä»¬çš„ç”Ÿå‘½æ¸¸æˆwasmäºŒè¿›åˆ¶æœ‰å¤šå°"><h3>è¿™äº›æ„å»ºé…ç½®è®©æˆ‘ä»¬çš„ç”Ÿå‘½æ¸¸æˆ<code>.wasm</code>äºŒè¿›åˆ¶æœ‰å¤šå°?</h3></a>
<p>ä½¿ç”¨é»˜è®¤ç‰ˆæœ¬æ„å»ºé…ç½® (æ²¡æœ‰è°ƒè¯•ç¬¦å·) ,æˆ‘ä»¬çš„WebAssemblyäºŒè¿›åˆ¶æ–‡ä»¶ä¸º240,605å­—èŠ‚:</p>
<pre><code>$ wc -c wasm_game_of_life_bg.wasm
240605 wasm_game_of_life_bg.wasm
</code></pre>
<p>å¯ç”¨ LTO å,è¿›è¡Œè®¾ç½®<code>opt-level = &quot;z&quot;</code>,å¹¶è¿è¡Œ<code>wasm-opt -Oz</code>, æ‰€ç»“æœçš„<code>.wasm</code>äºŒè¿›åˆ¶ç¼©å°åˆ°åªæœ‰37,424å­—èŠ‚!</p>
<pre><code>$ wc -c wasm_game_of_life_bg.wasm
37424 wasm_game_of_life_bg.wasm
</code></pre>
<a class="header" href="print.html#aå¤§å°åˆ†æ" id="aå¤§å°åˆ†æ"><h2>å¤§å°åˆ†æ</h2></a>
<p>å¦‚æœè°ƒæ•´æ„å»ºé…ç½®ä»¥ä¼˜åŒ–ä»£ç å¤§å°å,ä¸ä¼šå¯¼è‡´è¶³å¤Ÿå°<code>.wasm</code>äºŒè¿›åˆ¶,æ˜¯æ—¶å€™è¿›è¡Œä¸€äº›åˆ†æ,ä»¥æŸ¥çœ‹å‰©ä½™ä»£ç å¤§å°çš„æ¥æº.</p>
<blockquote>
<p>âš¡å°±åƒæˆ‘ä»¬å¦‚ä½•è®©æ—¶é—´åˆ†ææŒ‡å¯¼æˆ‘ä»¬çš„åŠ é€Ÿå·¥ä½œä¸€æ ·,æˆ‘ä»¬å¸Œæœ›è®©å¤§å°åˆ†ææŒ‡å¯¼æˆ‘ä»¬çš„ä»£ç å¤§å°ç¼©å°å·¥ä½œé‡. ä¸è¿™æ ·åš,ä½ å¯èƒ½ä¼šæµªè´¹è‡ªå·±çš„æ—¶é—´!</p>
</blockquote>
<a class="header" href="print.html#aè¯¥twiggyä»£ç å¤§å°åˆ†æå™¨" id="aè¯¥twiggyä»£ç å¤§å°åˆ†æå™¨"><h3>è¯¥<code>twiggy</code>ä»£ç å¤§å°åˆ†æå™¨</h3></a>
<p><a href="https://github.com/rustwasm/twiggy"><code>twiggy</code>æ˜¯ä¸€ä¸ªä»£ç å¤§å°åˆ†æå™¨</a>æ”¯æŒ WebAssembly ä½œä¸ºè¾“å…¥. å®ƒåˆ†æäºŒè¿›åˆ¶çš„è°ƒç”¨å›¾æ¥å›ç­”å¦‚ä¸‹é—®é¢˜:</p>
<ul>
<li>
<p>ä¸ºä»€ä¹ˆè¿™ä¸ªå‡½æ•°é¦–å…ˆåŒ…å«åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­?</p>
</li>
<li>
<p>è¿™ä¸ªå‡½æ•°<em>ä¿ç•™å¤§å°</em>å¤šå°‘? å³å¦‚æœåˆ é™¤å®ƒ, ä»¥åŠåˆ é™¤åæ‰€æœ‰æ­»ä»£ç çš„å‡½æ•°,å°†èŠ‚çœå¤šå°‘ç©ºé—´?</p>
</li>
</ul>
<style>
/* For whatever reason, the defautl mdbook fonts fonts break with the
   following box-drawing characters, hence the manual style. */
pre, code {
  font-family: "SFMono-Regular",Consolas,"Liberation Mono",Menlo,Courier,monospace;
}
</style>
<pre><code class="language-text">$ twiggy top -n 20 wasm_game_of_life_bg.wasm
 Shallow Bytes â”‚ Shallow % â”‚ Item
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          9158 â”Š    19.65% â”Š &quot;function names&quot; subsection
          3251 â”Š     6.98% â”Š dlmalloc::dlmalloc::Dlmalloc::malloc::h632d10c184fef6e8
          2510 â”Š     5.39% â”Š &lt;str as core::fmt::Debug&gt;::fmt::he0d87479d1c208ea
          1737 â”Š     3.73% â”Š data[0]
          1574 â”Š     3.38% â”Š data[3]
          1524 â”Š     3.27% â”Š core::fmt::Formatter::pad::h6825605b326ea2c5
          1413 â”Š     3.03% â”Š std::panicking::rust_panic_with_hook::h1d3660f2e339513d
          1200 â”Š     2.57% â”Š core::fmt::Formatter::pad_integral::h06996c5859a57ced
          1131 â”Š     2.43% â”Š core::str::slice_error_fail::h6da90c14857ae01b
          1051 â”Š     2.26% â”Š core::fmt::write::h03ff8c7a2f3a9605
           931 â”Š     2.00% â”Š data[4]
           864 â”Š     1.85% â”Š dlmalloc::dlmalloc::Dlmalloc::free::h27b781e3b06bdb05
           841 â”Š     1.80% â”Š &lt;char as core::fmt::Debug&gt;::fmt::h07742d9f4a8c56f2
           813 â”Š     1.74% â”Š __rust_realloc
           708 â”Š     1.52% â”Š core::slice::memchr::memchr::h6243a1b2885fdb85
           678 â”Š     1.45% â”Š &lt;core::fmt::builders::PadAdapter&lt;'a&gt; as core::fmt::Write&gt;::write_str::h96b72fb7457d3062
           631 â”Š     1.35% â”Š universe_tick
           631 â”Š     1.35% â”Š dlmalloc::dlmalloc::Dlmalloc::dispose_chunk::hae6c5c8634e575b8
           514 â”Š     1.10% â”Š std::panicking::default_hook::{{closure}}::hfae0c204085471d5
           503 â”Š     1.08% â”Š &lt;&amp;'a T as core::fmt::Debug&gt;::fmt::hba207e4f7abaece6
</code></pre>
<a class="header" href="print.html#aæ‰‹åŠ¨æ£€æŸ¥-llvm-ir" id="aæ‰‹åŠ¨æ£€æŸ¥-llvm-ir"><h3>æ‰‹åŠ¨æ£€æŸ¥ LLVM-IR</h3></a>
<p>LLVM-IR æ˜¯ LLVM ç”Ÿæˆ WebAssemblyä¹‹å‰ç¼–è¯‘å™¨å·¥å…·é“¾ä¸­çš„æœ€ç»ˆä¸­é—´è¡¨ç¤º. å› æ­¤,å®ƒä¸æœ€ç»ˆå‘å‡ºçš„ WebAssembly éå¸¸ç›¸ä¼¼. æ›´å¤šLLVM-IR é€šå¸¸æ„å‘³ç€æ›´å¤š<code>.wasm</code>å¤§å°,å¦‚æœä¸€ä¸ªå‡½æ•°å  LLVM-IRçš„25%,é‚£ä¹ˆå®ƒé€šå¸¸ä¼šå 25%<code>.wasm</code>. è™½ç„¶è¿™äº›æ•°å­—ä¸€èˆ¬åªä¿ç•™. LLVM-IR å…·æœ‰å…³é”®ä¿¡æ¯,è€Œè¿™äº›ä¿¡æ¯å¹¶ä¸å­˜åœ¨<code>.wasm</code>ä¸­ (å› ä¸º WebAssembly ç¼ºå°‘åƒ DWAR Fè¿™æ ·çš„è°ƒè¯•æ ¼å¼) : å“ªäº›å­ç¨‹åºè¢«å†…è”åˆ° ç»™å®šçš„å‡½æ•°ä¸­.</p>
<p>æ‚¨å¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•ç”Ÿæˆ LLVM-IR:</p>
<pre><code>cargo rustc --release -- --emit llvm-ir
</code></pre>
<p>ç„¶å,ä½ å¯ä»¥ä½¿ç”¨<code>find</code>æ‰¾åˆ°<code>.ll</code>åŒ…å« LLVM-IR çš„æ–‡ä»¶:</p>
<pre><code>find target/release -type f -name '*.ll'
</code></pre>
<a class="header" href="print.html#aå‚è€ƒ-2" id="aå‚è€ƒ-2"><h4>å‚è€ƒ</h4></a>
<ul>
<li><a href="https://llvm.org/docs/LangRef.html">LLVMè¯­è¨€å‚è€ƒæ‰‹å†Œ</a></li>
</ul>
<a class="header" href="print.html#aæ›´å…·ä¾µå…¥æ€§çš„å·¥å…·å’ŒæŠ€æœ¯" id="aæ›´å…·ä¾µå…¥æ€§çš„å·¥å…·å’ŒæŠ€æœ¯"><h2>æ›´å…·ä¾µå…¥æ€§çš„å·¥å…·å’ŒæŠ€æœ¯</h2></a>
<p>è°ƒæ•´æ„å»ºé…ç½®,ä»¥ç¼©å°<code>.wasm</code>äºŒè¿›åˆ¶æ–‡ä»¶éå¸¸é€‚åˆ. ä½†æ˜¯,å½“æ‚¨éœ€è¦åŠ å€åŠªåŠ›æ—¶,æ‚¨å‡†å¤‡ä½¿ç”¨æ›´å…·ä¾µå…¥æ€§çš„æŠ€æœ¯,ä¾‹å¦‚é‡å†™æºä»£ç ä»¥é¿å…è†¨èƒ€. æ¥ä¸‹æ¥æ˜¯ä¸€ç³»åˆ—å¯ä»¥åº”ç”¨äºè·å–è¾ƒå°ä»£ç çš„è‡ªé€‚åº”æŠ€å·§.</p>
<a class="header" href="print.html#aé¿å…ä½¿ç”¨å­—ç¬¦ä¸²æ ¼å¼" id="aé¿å…ä½¿ç”¨å­—ç¬¦ä¸²æ ¼å¼"><h3>é¿å…ä½¿ç”¨å­—ç¬¦ä¸²æ ¼å¼</h3></a>
<p><code>format!</code>,<code>to_string</code>ç­‰ç­‰...å¯ä»¥å¸¦æ¥å¾ˆå¤šä»£ç è‡ƒè‚¿. å¦‚æœå¯èƒ½,ä»…åœ¨è°ƒè¯•æ¨¡å¼ä¸‹è¿›è¡Œå­—ç¬¦ä¸²æ ¼å¼åŒ–,åœ¨å‘å¸ƒæ¨¡å¼ä¸‹ä½¿ç”¨é™æ€å­—ç¬¦ä¸².</p>
<a class="header" href="print.html#aé¿å…ææ…Œ" id="aé¿å…ææ…Œ"><h3>é¿å…ææ…Œ</h3></a>
<p>è¿™è¯´èµ·æ¥å®¹æ˜“åšèµ·æ¥éš¾,ä½†å·¥å…·å°±åƒ<code>twiggy</code>å¹¶æ‰‹åŠ¨æ£€æŸ¥LLVM-IRå¯ä»¥å¸®åŠ©æ‚¨æ‰¾å‡ºå“ªäº›åŠŸèƒ½ä»¤äººææ…Œ.</p>
<p>ææ…Œå¹¶ä¸æ€»æ˜¯è¡¨ç°ä¸º<code>panic!()</code>å®è°ƒç”¨. å®ƒä»¬éšå«åœ°æ¥è‡ªè®¸å¤šç»“æ„,ä¾‹å¦‚:</p>
<ul>
<li>
<p>å¯¹è¶…å‡ºèŒƒå›´ç´¢å¼•çš„åˆ‡ç‰‡è¿›è¡Œç´¢å¼•: <code>my_slice[i]</code></p>
</li>
<li>
<p>å¦‚æœé™¤æ•°ä¸ºé›¶,åˆ™ åˆ†å¾—æ•° ä¼šæƒŠæ…Œå¤±æª: <code>dividend / divisor</code></p>
</li>
<li>
<p>æ‰“å¼€ä¸€ä¸ª<code>Option</code>æˆ–è€…<code>Result</code>: <code>opt.unwrap()</code>æˆ–è€…<code>res.unwrap()</code></p>
</li>
</ul>
<p>å‰ä¸¤ä¸ªå¯ä»¥ä½“ç°ä¸ºç¬¬ä¸‰ä¸ª. ç´¢å¼•å¯ä»¥ç”¨<code>my_slice.get(i)</code>æ“ä½œ. åˆ†å¾—æ•° å¯ä»¥<code>checked_div</code>è°ƒç”¨. ç°åœ¨æˆ‘ä»¬åªæœ‰ä¸€ä¸ªæ¡ˆä¾‹å¯ä»¥åº”å¯¹.</p>
<p>æ‰“å¼€ä¸€ä¸ª<code>Option</code>æˆ–è€…<code>Result</code>æ²¡æœ‰ææ…Œæœ‰ä¸¤ç§é£æ ¼: å®‰å…¨å’Œä¸å®‰å…¨.</p>
<p>å®‰å…¨çš„æ–¹æ³•æ˜¯<code>abort</code>ä»£æ›¿ææ…Œ,å½“å¾—å‡ºä¸€ä¸ª<code>None</code>æˆ–ä¸€ä¸ª<code>Error</code>:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
#[inline]
pub fn unwrap_abort&lt;T&gt;(o: Option&lt;T&gt;) -&gt; T {
    use std::process;
    match o {
        Some(t) =&gt; t,
        None =&gt; process::abort(),
    }
}
#}</code></pre></pre>
<p>æœ€ç»ˆ,æ— è®ºå¦‚ä½•åœ¨<code>wasm32-unknown-unknown</code>ææ…Œéƒ½ä¼šè½¬åŒ–ä¸º aborts ,æ‰€ä»¥è¿™ç»™ä½ ç›¸åŒçš„è¡Œä¸º,ä½†æ²¡æœ‰ä»£ç è†¨èƒ€.</p>
<p>æˆ–è€…,<a href="https://crates.io/crates/unreachable"><code>unreachable</code>ç®±</a>æä¾›ä¸å®‰å…¨çš„<a href="https://docs.rs/unreachable/1.0.0/unreachable/trait.UncheckedOptionExt.html#tymethod.unchecked_unwrap"><code>unchecked_unwrap</code>æ‰©å±•æ–¹æ³•</a>å¯¹äº<code>Option</code>å’Œ<code>Result</code>, å®ƒå‘Šè¯‰Rustç¼–è¯‘å™¨<em>æ‰¿æ‹…</em>é‚£ä¸ª<code>Option</code>æ˜¯<code>Some</code>æˆ–è€…<code>Result</code>æ˜¯<code>Ok</code>. å®ƒæ˜¯æœªå®šä¹‰å¦‚æœè¯¥å‡è®¾ä¸æˆç«‹,ä¼šå‘ç”Ÿä»€ä¹ˆ. ä½ çœŸçš„åªèƒ½å½“ä½ 110%ç¡®å®šæ—¶,ä½¿ç”¨è¿™ç§ä¸å®‰å…¨çš„æ–¹æ³•,è€Œä¸”ç¼–è¯‘å™¨åªæ˜¯ä¸å¤Ÿèªæ˜çœ‹åˆ°å®ƒ. å³ä½¿ä½ æ²¿ç€è¿™æ¡è·¯èµ°ä¸‹å»,ä½ ä¹Ÿåº”è¯¥æœ‰ä¸€ä¸ªä»ç„¶è¿›è¡Œæ£€æŸ¥çš„è°ƒè¯•æ„å»ºé…ç½®,å¹¶ä¸”åªåœ¨å‘å¸ƒç‰ˆæœ¬ä¸­ä½¿ç”¨æœªç»æ£€æŸ¥çš„æ“ä½œ.</p>
<a class="header" href="print.html#aé¿å…åˆ†é…æˆ–åˆ‡æ¢åˆ°wee_alloc" id="aé¿å…åˆ†é…æˆ–åˆ‡æ¢åˆ°wee_alloc"><h3>é¿å…åˆ†é…æˆ–åˆ‡æ¢åˆ°<code>wee_alloc</code></h3></a>
<p>Rustå¯¹WebAssemblyçš„é»˜è®¤åˆ†é…å™¨,æ˜¯<code>dlmalloc</code>çš„ä¸€éƒ¨åˆ†. å®ƒçš„é‡é‡å¤§çº¦åœ¨10åƒå­—èŠ‚å·¦å³. å¦‚æœä½ å¯ä»¥å®Œå…¨é¿å…åŠ¨æ€åˆ†é…,é‚£ä¹ˆä½ åº”è¯¥èƒ½å¤Ÿå‡å°‘è¿™åä¸ªåƒå­—èŠ‚.</p>
<p>å®Œå…¨é¿å…åŠ¨æ€åˆ†é…å¯èƒ½éå¸¸å›°éš¾. ä½†æ˜¯ä»çƒ­ä»£ç è·¯å¾„ä¸­åˆ é™¤åˆ†é…é€šå¸¸è¦å®¹æ˜“å¾—å¤š (å¹¶ä¸”é€šå¸¸ä¹Ÿæœ‰åŠ©äºä½¿è¿™äº›çƒ­ä»£ç è·¯å¾„æ›´å¿«) . åœ¨è¿™äº›æƒ…å†µä¸‹,<a href="https://github.com/rustwasm/wee_alloc">ç”¨,æ›¿æ¢é»˜è®¤çš„å…¨å±€åˆ†é…å™¨<code>wee_alloc</code></a>åº”è¯¥èŠ‚çœä½ æœ€å¤š (ä½†ä¸æ˜¯å…¨éƒ¨) çš„ååƒå­—èŠ‚. <code>wee_alloc</code>æ˜¯ä¸€ä¸ªä¸ºæ‚¨éœ€è¦<em>ä¸€äº›</em>ç±»å‹æƒ…å†µæ—¶è®¾è®¡,ä½†ä¸éœ€è¦ç‰¹åˆ«å¿«çš„åˆ†é…å™¨,å¹¶å°†æ„‰å¿«åœ°äº¤æ¢åˆ†é…é€Ÿåº¦è¾ƒå°çš„ä»£ç å¤§å°çš„åˆ†é…å™¨.</p>
<a class="header" href="print.html#aä½¿ç”¨ç‰¹å¾å¯¹è±¡è€Œä¸æ˜¯é€šç”¨ç±»å‹å‚æ•°" id="aä½¿ç”¨ç‰¹å¾å¯¹è±¡è€Œä¸æ˜¯é€šç”¨ç±»å‹å‚æ•°"><h3>ä½¿ç”¨ç‰¹å¾å¯¹è±¡è€Œä¸æ˜¯é€šç”¨ç±»å‹å‚æ•°</h3></a>
<p>å½“æ‚¨åˆ›å»ºä½¿ç”¨ç±»å‹å‚æ•°çš„æ³›å‹å‡½æ•°æ—¶,å¦‚ä¸‹æ‰€ç¤º:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
fn whatever&lt;T: MyTrait&gt;(t: T) { ... }
#}</code></pre></pre>
<p>ç„¶å<code>rustc</code>å’Œ LLVM å°†ä¸ºæ¯ä¸ªåˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°å‰¯æœ¬ - <code>T</code>ç±»å‹å‡½æ•°. è¿™ä¸ºåŸºäºç‰¹å®šçš„<code>T</code>æ¯ä¸ªå‰¯æœ¬éƒ½åœ¨ä½¿ç”¨çš„ç¼–è¯‘å™¨çš„ä¼˜åŒ–æä¾›äº†è®¸å¤šæœºä¼š,ä½†è¿™äº›å‰¯æœ¬åœ¨ä»£ç å¤§å°æ–¹é¢å¿«é€Ÿå¢åŠ .</p>
<p>å¦‚æœæ‚¨ä½¿ç”¨ç‰¹å¾å¯¹è±¡è€Œä¸æ˜¯ç±»å‹å‚æ•°,å¦‚ä¸‹æ‰€ç¤º:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
fn whatever(t: Box&lt;MyTrait&gt;) { ... }
// or
fn whatever(t: &amp;MyTrait) { ... }
// etc...
#}</code></pre></pre>
<p>ç„¶åä½¿ç”¨é€šè¿‡è™šæ‹Ÿè°ƒç”¨çš„åŠ¨æ€è°ƒåº¦,å¹¶ä¸”ä»…åœ¨è¯¥å‡½æ•°ä¸­å‘å‡ºå•ä¸ªç‰ˆæœ¬çš„å‡½æ•°<code>.wasm</code>. ç¼ºç‚¹æ˜¯å¤±å»äº†ç¼–è¯‘å™¨ä¼˜åŒ–æœºä¼š,ä»¥åŠé—´æ¥åŠ¨æ€è°ƒåº¦å‡½æ•°è°ƒç”¨çš„é¢å¤–æˆæœ¬.</p>
<a class="header" href="print.html#aä½¿ç”¨wasm-snipå·¥å…·" id="aä½¿ç”¨wasm-snipå·¥å…·"><h3>ä½¿ç”¨<code>wasm-snip</code>å·¥å…·</h3></a>
<p><a href="https://github.com/fitzgen/wasm-snip"><code>wasm-snip</code>ç”¨ä¸€ä¸ªæ›¿æ¢WebAssemblyå‡½æ•°çš„ä¸»ä½“çš„<code>unreachable</code>æŒ‡ä»¤. </a>è¿™æ˜¯ä¸€ä¸ªç›¸å½“æ²‰é‡,é’çš„é”¤å­,å¦‚æœä½ è¶³å¤Ÿçœ¯çœ¼,é‚£äº›çœ‹èµ·æ¥åƒæŒ‡ç”²çš„å‡½æ•°.</p>
<p>ä¹Ÿè®¸æ‚¨çŸ¥é“æŸäº›å‡½æ•°æ°¸è¿œä¸ä¼šåœ¨è¿è¡Œæ—¶è°ƒç”¨,ä½†ç¼–è¯‘å™¨æ— æ³•åœ¨ç¼–è¯‘æ—¶è¯æ˜è¿™ä¸€ç‚¹? å‰ªæ–­å®ƒ! ç„¶å,è·‘<code>wasm-opt</code>å¸¦ç€<code>--dce</code>,ä»¥åŠ<code>snipping å‡½æ•°</code>ä¼ é€’è°ƒç”¨çš„æ‰€æœ‰å‡½æ•° (ä¹Ÿå¯èƒ½æ°¸è¿œä¸ä¼šåœ¨è¿è¡Œæ—¶è°ƒç”¨) ä¹Ÿå°†è¢«åˆ é™¤.</p>
<p>è¿™ä¸ªå·¥å…·å¯¹äºæ¶ˆé™¤ææ…Œç‰¹åˆ«æœ‰ç”¨,å› ä¸ºææ…Œæœ€ç»ˆä¼šè½¬åŒ–ä¸ºé™·é˜±.</p>
<a class="header" href="print.html#aç»ƒä¹ -6" id="aç»ƒä¹ -6"><h2>ç»ƒä¹ </h2></a>
<ul>
<li>
<p>ä½¿ç”¨<code>wasm-snip</code>ä»æˆ‘ä»¬çš„ç”Ÿå‘½æ¸¸æˆä¸­åˆ é™¤ææ…ŒåŸºç¡€å‡½æ•°,<code>.wasm</code>äºŒè¿›åˆ¶æ–‡ä»¶èŠ‚çœäº†å¤šå°‘å­—èŠ‚?</p>
</li>
<li>
<p>å°†æˆ‘ä»¬çš„ç”Ÿå‘½æ¸¸æˆç®±æ”¹ä¸ºä½¿ç”¨<code>wee_alloc</code>ä½œä¸ºåˆ†é…è€…. å‰ƒæ‰äº†<code>.wasm</code>äºŒè¿›åˆ¶å¤šå°‘å°ºå¯¸?</p>
</li>
<li>
<p>æˆ‘ä»¬åªå®ä¾‹åŒ–ä¸€ä¸ªå•ä¸€çš„<code>Universe</code>,å› æ­¤æˆ‘ä»¬å¯ä»¥å¯¼å‡º<code>static mut</code>å…¨å±€å®ä¾‹çš„æ“ä½œ,è€Œä¸æ˜¯æä¾›æ„é€ å‡½æ•°. å¦‚æœè¿™ä¸ªå…¨å±€å®ä¾‹ä¹Ÿä½¿ç”¨å‰é¢ç« èŠ‚ä¸­è®¨è®ºçš„åŒç¼“å†²æŠ€æœ¯,æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿è¿™äº›ç¼“å†²åŒºæˆä¸ºå…¨å±€<code>static mut</code>. è¿™å°†ä»æˆ‘ä»¬çš„ç”Ÿå‘½æ¸¸æˆå®ç°ä¸­åˆ é™¤æ‰€æœ‰åŠ¨æ€åˆ†é…,æˆ‘ä»¬å¯ä»¥å°†å…¶ä½œä¸ºä¸€ä¸ªä¸åŒ…å«åˆ†é…å™¨çš„<code>#![no_std]</code>ç®±å­. ä»ä¸­ç§»é™¤äº†å¤šå°‘å°ºå¯¸<code>.wasm</code>é€šè¿‡å®Œå…¨åˆ é™¤åˆ†é…å™¨ä¾èµ–?</p>
</li>
</ul>
<a class="header" href="print.html#aç”Ÿäº§å’Œéƒ¨ç½²" id="aç”Ÿäº§å’Œéƒ¨ç½²"><h1>ç”Ÿäº§å’Œéƒ¨ç½²</h1></a>
<p>å½“æˆ‘ä»¬å¯¹é¡¹ç›®æ„Ÿåˆ°æ»¡æ„æ—¶,ä¸‹ä¸€æ­¥æ˜¯å°†å…¶éƒ¨ç½²åˆ°ç”Ÿäº§æœåŠ¡å™¨,è€Œä¸æ˜¯æˆ‘ä»¬çš„å¼€å‘æœåŠ¡å™¨.</p>
<p>ç¬¬ä¸€æ­¥æ˜¯è¿è¡Œ:</p>
<pre><code>npm run bundle
</code></pre>
<p>è¿™å°†åˆ›å»ºæˆ‘ä»¬çš„Rustä»£ç çš„å‘å¸ƒç‰ˆæœ¬,ä¼šä½¿ç”¨webpackå°†å®ƒä¸æˆ‘ä»¬çš„JavaScriptå’ŒHTMLæ†ç»‘åœ¨ä¸€èµ·,å¹¶ä¸€èµ·è¾“å‡ºåˆ°<code>dist</code>ç›®å½•.</p>
<p>è¦ä»æœåŠ¡å™¨ä½¿ç”¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åº,å¿…é¡»æ­£ç¡®é…ç½®<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types">MIMEç±»å‹</a>-<code>application/wasm</code>,ä»¥æ­£ç¡®çš„æ–¹å¼æä¾›wasmæ–‡ä»¶.</p>
<blockquote>
<p><strong>æ³¨æ„</strong>: æœåŠ¡å™¨é…ç½®å› æ“ä½œç³»ç»Ÿè€Œå¼‚,å»ºè®®æ‚¨æŸ¥æ‰¾ç‰¹å®šæ“ä½œç³»ç»Ÿå’ŒWebæœåŠ¡å™¨çš„æ•™ç¨‹. è¿™äº›ç¤ºä¾‹å‡è®¾ä½¿ç”¨ Debian/Ubuntu æˆ– CentOS/Red Hat/Fedoraç­‰ç¯å¢ƒ.</p>
</blockquote>
<p>ä¾‹å¦‚,ä½¿ç”¨nginx,<a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#types">æ·»åŠ <code>application/wasm wasm;</code>åˆ°<code>/etc/nginx/mime.types</code></a>. ç„¶åé‡æ–°åŠ è½½<code>sudo nginx -s reload</code>,nginxé…ç½®æ›´æ”¹.</p>
<p>å¯¹äºApache<a href="https://httpd.apache.org/docs/2.4/mod/mod_mime.html#addtype">æ·»åŠ <code>AddType application/wasm .wasm</code>åˆ°ä½ çš„apacheé…ç½®çš„æ ¹ç›®å½•</a>,å¯èƒ½ä½äº<code>/etc/apache2/apache2.conf</code>è¦ä¹ˆ<code>/etc/httpd.d/conf/httpd.conf</code>. Apacheé‡æ–°åŠ è½½<code>sudo apachectl -k graceful</code>.</p>
<p>æœ€å,æˆ‘ä»¬å¯ä»¥ä¸Šä¼ <code>dist</code>ç”ŸæˆæœåŠ¡å™¨çš„ç›®å½•,ä¾‹å¦‚é€šè¿‡ä½¿ç”¨SCPæˆ–SFTPå®¢æˆ·ç«¯. å°†æ–‡ä»¶å¤åˆ¶åˆ°Webæ ¹ç›®å½• (é€šå¸¸æ˜¯<code>/var/www/html</code>è¦ä¹ˆ<code>/var/www</code>) , ç°åœ¨ä»»ä½•äººéƒ½çœ‹åˆ°æœ€ç»ˆäº§å“äº†.</p>
<a class="header" href="print.html#aæ‚¨åº”è¯¥çŸ¥é“çš„ç®±å­" id="aæ‚¨åº”è¯¥çŸ¥é“çš„ç®±å­"><h1>æ‚¨åº”è¯¥çŸ¥é“çš„ç®±å­</h1></a>
<p>è¿™æ˜¯ä¸€ä¸ªç²¾é€‰çš„ç®±å­åˆ—è¡¨,å…³äºRustå’ŒWebAssemblyå¼€å‘.</p>
<p><a href="https://crates.io/categories/wasm">æ‚¨è¿˜å¯ä»¥æµè§ˆWebAssemblyç±»åˆ«ä¸­,å‘å¸ƒåˆ°crates.ioçš„æ‰€æœ‰åŒ…. </a></p>
<a class="header" href="print.html#aä¸javascriptå’Œdomäº¤äº’" id="aä¸javascriptå’Œdomäº¤äº’"><h2>ä¸JavaScriptå’ŒDOMäº¤äº’</h2></a>
<a class="header" href="print.html#wasm-bindgena-hrefhttpscratesiocrateswasm-bindgencratesioaa-hrefhttpsgithubcomrustwasmwasm-bindgengithuba" id="wasm-bindgena-hrefhttpscratesiocrateswasm-bindgencratesioaa-hrefhttpsgithubcomrustwasmwasm-bindgengithuba"><h3><code>wasm-bindgen</code>|<a href="https://crates.io/crates/wasm-bindgen">crates.io</a>|<a href="https://github.com/rustwasm/wasm-bindgen">github</a></h3></a>
<p><code>wasm-bindgen</code>ä¿ƒè¿›Rustå’ŒJavaScriptä¹‹é—´çš„é«˜çº§äº¤äº’. å®ƒå…è®¸äººä»¬å°†JavaScriptå†…å®¹å¯¼å…¥Rustå’ŒRustå†…å®¹å¯¼å‡ºåˆ°JavaScript.</p>
<a class="header" href="print.html#js-sysa-hrefhttpscratesiocratesjs-syscratesioaa-hrefhttpsgithubcomrustwasmwasm-bindgentreemastercratesjs-sysgithuba" id="js-sysa-hrefhttpscratesiocratesjs-syscratesioaa-hrefhttpsgithubcomrustwasmwasm-bindgentreemastercratesjs-sysgithuba"><h3><code>js-sys</code>|<a href="https://crates.io/crates/js-sys">crates.io</a>|<a href="https://github.com/rustwasm/wasm-bindgen/tree/master/crates/js-sys">github</a></h3></a>
<p>åŸç”Ÿ<code>wasm-bindgen</code>å¯¼å…¥æ‰€æœ‰JavaScriptå…¨å±€ç±»å‹å’Œæ–¹æ³•,ä¾‹å¦‚<code>Object</code>,<code>Function</code>,<code>eval</code>ç­‰. è¿™äº›APIå¯ä»¥åœ¨æ‰€æœ‰æ ‡å‡† ECMAScriptç¯å¢ƒ ä¸­ç§»æ¤,è€Œä¸ä»…ä»…æ˜¯Web,ä¾‹å¦‚Node.js.</p>
<a class="header" href="print.html#aé”™è¯¯æŠ¥å‘Š" id="aé”™è¯¯æŠ¥å‘Š"><h2>é”™è¯¯æŠ¥å‘Š</h2></a>
<a class="header" href="print.html#console_error_panic_hooka-hrefhttpscratesiocratesconsole_error_panic_hookcratesioaa-hrefhttpsgithubcomrustwasmconsole_error_panic_hookgithuba" id="console_error_panic_hooka-hrefhttpscratesiocratesconsole_error_panic_hookcratesioaa-hrefhttpsgithubcomrustwasmconsole_error_panic_hookgithuba"><h3><code>console_error_panic_hook</code>|<a href="https://crates.io/crates/console_error_panic_hook">crates.io</a>|<a href="https://github.com/rustwasm/console_error_panic_hook">github</a></h3></a>
<p>è¿™ä¸ªç®±å­è®©ä½ è°ƒè¯•<code>wasm32-unknown-unknown</code>çš„panics,é€šè¿‡æä¾›ä¸€ä¸ªææ…Œé’©å­, æ¥å°†ææ…Œæ¶ˆæ¯è½¬å‘åˆ°<code>console.error</code>.</p>
<a class="header" href="print.html#aåŠ¨æ€åˆ†é…" id="aåŠ¨æ€åˆ†é…"><h2>åŠ¨æ€åˆ†é…</h2></a>
<a class="header" href="print.html#wee_alloca-hrefhttpscratesiocrateswee_alloccratesioaa-hrefhttpsgithubcomrustwasmwee_allocgithuba" id="wee_alloca-hrefhttpscratesiocrateswee_alloccratesioaa-hrefhttpsgithubcomrustwasmwee_allocgithuba"><h3><code>wee_alloc</code>|<a href="https://crates.io/crates/wee_alloc">crates.io</a>|<a href="https://github.com/rustwasm/wee_alloc">github</a></h3></a>
<p>è¯¥ <strong>W</strong>asm-<strong>E</strong>nabled, <strong>E</strong>lfinåˆ†é…å™¨. ä¸€ä¸ªå°çš„ (~1Kæœªå‹ç¼©<code>.wasm</code>)åˆ†é…å™¨å®ç°,ç‰¹ç‚¹æ˜¯ä»£ç å¤§å°æ¯”åˆ†é…æ€§èƒ½æ›´å—å…³æ³¨,.</p>
<a class="header" href="print.html#aè§£æå’Œç”ŸæˆwasmäºŒè¿›åˆ¶" id="aè§£æå’Œç”ŸæˆwasmäºŒè¿›åˆ¶"><h2>è§£æå’Œç”Ÿæˆ<code>.wasm</code>äºŒè¿›åˆ¶</h2></a>
<a class="header" href="print.html#parity-wasma-hrefhttpscratesiocratesparity-wasmcratesioaa-hrefhttpsgithubcomparitytechparity-wasmgithuba" id="parity-wasma-hrefhttpscratesiocratesparity-wasmcratesioaa-hrefhttpsgithubcomparitytechparity-wasmgithuba"><h3><code>parity-wasm</code>|<a href="https://crates.io/crates/parity-wasm">crates.io</a>|<a href="https://github.com/paritytech/parity-wasm">github</a></h3></a>
<p>ç”¨äºåºåˆ—åŒ–,ååºåˆ—åŒ–å’Œæ„å»ºçš„ä½çº§WebAssemblyæ ¼å¼åº“ - <code>.wasm</code>äºŒè¿›åˆ¶æ–‡ä»¶. å¯¹å·²çŸ¥çš„è‡ªå®šä¹‰éƒ¨åˆ†å…·æœ‰è‰¯å¥½æ”¯æŒ,ä¾‹å¦‚&quot;names&quot;éƒ¨åˆ†å’Œ&quot;reloc.WHATEVER&quot;éƒ¨åˆ†.</p>
<a class="header" href="print.html#wasmparsera-hrefhttpscratesiocrateswasmparsercratesioaa-hrefhttpsgithubcomyurydelendikwasmparserrsgithuba" id="wasmparsera-hrefhttpscratesiocrateswasmparsercratesioaa-hrefhttpsgithubcomyurydelendikwasmparserrsgithuba"><h3><code>wasmparser</code>|<a href="https://crates.io/crates/wasmparser">crates.io</a>|<a href="https://github.com/yurydelendik/wasmparser.rs">github</a></h3></a>
<p>ä¸€ä¸ªç®€å•çš„äº‹ä»¶é©±åŠ¨åº“,ç”¨äºè§£æWebAssemblyäºŒè¿›åˆ¶æ–‡ä»¶. ä¾‹å¦‚,æä¾›æ¯ä¸ªè§£æäº‹ç‰©çš„å­—èŠ‚åç§»é‡,è¿™åœ¨è§£é‡Šrelocæ—¶æ˜¯å¿…éœ€çš„.</p>
<a class="header" href="print.html#aè§£é‡Šå’Œç¼–è¯‘webassembly" id="aè§£é‡Šå’Œç¼–è¯‘webassembly"><h2>è§£é‡Šå’Œç¼–è¯‘WebAssembly</h2></a>
<a class="header" href="print.html#wasmia-hrefhttpscratesiocrateswasmicratesioaa-hrefhttpsgithubcomparitytechwasmigithuba" id="wasmia-hrefhttpscratesiocrateswasmicratesioaa-hrefhttpsgithubcomparitytechwasmigithuba"><h3><code>wasmi</code>|<a href="https://crates.io/crates/wasmi">crates.io</a>|<a href="https://github.com/paritytech/wasmi">github</a></h3></a>
<p>æ¥è‡ªParityçš„å¯åµŒå…¥WebAssemblyè§£é‡Šå™¨.</p>
<a class="header" href="print.html#cranelift-wasma-hrefhttpscratesiocratescranelift-wasmcratesioaa-hrefhttpsgithubcomcranestationcraneliftgithuba" id="cranelift-wasma-hrefhttpscratesiocratescranelift-wasmcratesioaa-hrefhttpsgithubcomcranestationcraneliftgithuba"><h3><code>cranelift-wasm</code>|<a href="https://crates.io/crates/cranelift-wasm">crates.io</a>|<a href="https://github.com/CraneStation/cranelift">github</a></h3></a>
<p>å°†WebAssemblyç¼–è¯‘ä¸ºæœ¬æœºä¸»æœºçš„æœºå™¨ä»£ç . Cranelift (nÃ©Cretonne) ä»£ç ç”Ÿæˆå™¨é¡¹ç›®çš„ä¸€éƒ¨åˆ†.</p>
<a class="header" href="print.html#aä½ åº”è¯¥çŸ¥é“çš„å·¥å…·" id="aä½ åº”è¯¥çŸ¥é“çš„å·¥å…·"><h1>ä½ åº”è¯¥çŸ¥é“çš„å·¥å…·</h1></a>
<p>è¿™æ˜¯åœ¨æ‰§è¡ŒRustå’ŒWebAssemblyå¼€å‘æ—¶,åº”è¯¥äº†è§£çš„ç²¾é€‰å·¥å…·åˆ—è¡¨.</p>
<a class="header" href="print.html#aå¼€å‘æ„å»ºå’Œå·¥ä½œæµç¨‹ç¼–æ’" id="aå¼€å‘æ„å»ºå’Œå·¥ä½œæµç¨‹ç¼–æ’"><h2>å¼€å‘,æ„å»ºå’Œå·¥ä½œæµç¨‹ç¼–æ’</h2></a>
<a class="header" href="print.html#wasm-packa-hrefhttpsgithubcomrustwasmwasm-packgithuba" id="wasm-packa-hrefhttpsgithubcomrustwasmwasm-packgithuba"><h3><code>wasm-pack</code>|<a href="https://github.com/rustwasm/wasm-pack">github</a></h3></a>
<p><code>wasm-pack</code>æ¬²æˆä¸ºæ„å»ºå’Œä½¿ç”¨Rustç”Ÿæˆçš„WebAssemblyçš„ä¸€ç«™å¼å•†åº—,è¿™æ ·ä½ å¯ä»¥é€šè¿‡Webæˆ–Node.jsä¸JavaScriptè¿›è¡Œç›¸äº’æ“ä½œ. <code>wasm-pack</code>å¸®åŠ©æ‚¨æ„å»ºå’Œå‘å¸ƒRustç”Ÿæˆçš„WebAssemblyåˆ°npmæ³¨å†Œè¡¨,ä»¥ä¾¿ä¸æ‚¨åœ¨å·¥ä½œæµä¸­å·²ç»ä½¿ç”¨çš„å…¶ä»–JavaScriptåŒ…ä¸€èµ·ä½¿ç”¨.</p>
<a class="header" href="print.html#aä¼˜åŒ–å’Œæ“ä½œwasmäºŒè¿›åˆ¶" id="aä¼˜åŒ–å’Œæ“ä½œwasmäºŒè¿›åˆ¶"><h2>ä¼˜åŒ–å’Œæ“ä½œ<code>.wasm</code>äºŒè¿›åˆ¶</h2></a>
<a class="header" href="print.html#wasm-opta-hrefhttpsgithubcomwebassemblybinaryengithuba" id="wasm-opta-hrefhttpsgithubcomwebassemblybinaryengithuba"><h3><code>wasm-opt</code>|<a href="https://github.com/WebAssembly/binaryen">github</a></h3></a>
<p>è¯¥<code>wasm-opt</code>å·¥å…·å°†WebAssemblyä½œä¸ºè¾“å…¥è¯»å–,åœ¨å…¶ä¸Šè¿è¡Œ è½¬æ¢,ä¼˜åŒ– å’Œ/æˆ– æ£€æµ‹,ç„¶åå°†è½¬æ¢åçš„WebAssemblyä½œä¸ºè¾“å‡ºå‘å‡º. <code>rustc</code>ä¼šè®©å®ƒ,ä¸<code>.wasm</code>LLVM åˆä½œç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶,é€šå¸¸è¿™ä½¿å¾—åˆ›é€ çš„<code>.wasm</code>äºŒè¿›åˆ¶æ–‡ä»¶æ—¢å°åˆæ‰§è¡Œå¾—æ›´å¿«. è¿™ä¸ªå·¥å…·æ˜¯<code>binaryen</code>é¡¹ç›®çš„å…¶ä¸­ä¸€éƒ¨åˆ†.</p>
<a class="header" href="print.html#wasm2asma-hrefhttpsgithubcomwebassemblybinaryengithuba" id="wasm2asma-hrefhttpsgithubcomwebassemblybinaryengithuba"><h3><code>wasm2asm</code>|<a href="https://github.com/WebAssembly/binaryen">github</a></h3></a>
<p>è¯¥<code>wasm2asm</code>å·¥å…·å°†WebAssemblyç¼–è¯‘ä¸º&quot;å¤§å¤šæ•° asm.js&quot;. è¿™éå¸¸é€‚åˆæ”¯æŒæ²¡æœ‰WebAssemblyå®ç°çš„æµè§ˆå™¨,ä¾‹å¦‚Internet Explorer 11.æ­¤å·¥å…·æ˜¯<code>binaryen</code>é¡¹ç›®çš„å…¶ä¸­ä¸€éƒ¨åˆ†.</p>
<blockquote>
<p>æ³¨æ„: è®¡åˆ’å°†æ­¤å·¥å…·é‡å‘½åä¸º<code>wasm2js</code>ä½†æ˜¯,åœ¨æ’°å†™æœ¬æ–‡æ—¶,é‡å‘½åä»æœªå‘ç”Ÿ.</p>
</blockquote>
<a class="header" href="print.html#wasm-gca-hrefhttpsgithubcomalexcrichtonwasm-gcgithuba" id="wasm-gca-hrefhttpsgithubcomalexcrichtonwasm-gcgithuba"><h3><code>wasm-gc</code>|<a href="https://github.com/alexcrichton/wasm-gc">github</a></h3></a>
<p>åƒåœ¾æ”¶é›†WebAssemblyæ¨¡å—å¹¶åˆ é™¤æ‰€æœ‰ä¸éœ€è¦çš„å¯¼å‡º,å¯¼å…¥,å‡½æ•°ç­‰çš„å°å·¥å…·. è¿™å®é™…ä¸Šæ˜¯ä¸€ä¸ªWebAssemblyçš„é“¾æ¥å™¨æ ‡å¿—<code>--gc-sections</code>.</p>
<p>æ‚¨é€šå¸¸ä¸éœ€è¦è‡ªå·±ä½¿ç”¨æ­¤å·¥å…·,åŸå› æœ‰ä¸¤ä¸ª:</p>
<ol>
<li><code>rustc</code>ç°åœ¨æœ‰ä¸€ä¸ª<code>lld</code>è¶³å¤Ÿæ–°çš„ç‰ˆæœ¬,å®ƒæ”¯æŒ<code>--gc-sections</code>WebAssemblyçš„æ ‡å¿—. LTOæ„å»ºä¼šè‡ªåŠ¨å¯ç”¨æ­¤åŠŸèƒ½.</li>
<li>è¯¥<code>wasm-bindgen</code>CLIå·¥å…·ä¸ºä½ è‡ªåŠ¨è¿è¡Œ<code>wasm-gc</code>.</li>
</ol>
<a class="header" href="print.html#wasm-snipa-hrefhttpsgithubcomrustwasmwasm-snipgithuba" id="wasm-snipa-hrefhttpsgithubcomrustwasmwasm-snipgithuba"><h3><code>wasm-snip</code>|<a href="https://github.com/rustwasm/wasm-snip">github</a></h3></a>
<p><code>wasm-snip</code>æ›¿æ¢WebAssemblyå‡½æ•°çš„ä¸»ä½“,é€šè¿‡ç”¨ä¸€ä¸ª<code>unreachable</code>æŒ‡ä»¤.</p>
<p>ä¹Ÿè®¸æ‚¨çŸ¥é“æŸäº›å‡½æ•°æ°¸è¿œä¸ä¼šåœ¨è¿è¡Œæ—¶è°ƒç”¨,ä½†ç¼–è¯‘å™¨æ— æ³•åœ¨ç¼–è¯‘æ—¶è¯æ˜è¿™ä¸€ç‚¹? å‰ªæ–­å®ƒ!ç„¶åå†æ¬¡è¿è¡Œ<code>wasm-gc</code>,å®ƒä¼ é€’è°ƒç”¨çš„æ‰€æœ‰å‡½æ•° (ä¹Ÿå¯èƒ½æ°¸è¿œä¸ä¼šåœ¨è¿è¡Œæ—¶è°ƒç”¨) ä¹Ÿå°†è¢«åˆ é™¤.</p>
<p>è¿™å¯¹äºåœ¨éè°ƒè¯•çš„ç”Ÿäº§ç‰ˆæœ¬ä¸­,å¼ºåˆ¶åˆ é™¤Rustçš„ææ…ŒåŸºç¡€ç»“æ„éå¸¸æœ‰ç”¨.</p>
<a class="header" href="print.html#aæ£€æŸ¥wasmäºŒè¿›åˆ¶" id="aæ£€æŸ¥wasmäºŒè¿›åˆ¶"><h2>æ£€æŸ¥<code>.wasm</code>äºŒè¿›åˆ¶</h2></a>
<a class="header" href="print.html#twiggya-hrefhttpsgithubcomrustwasmtwiggygithuba" id="twiggya-hrefhttpsgithubcomrustwasmtwiggygithuba"><h3><code>twiggy</code>|<a href="https://github.com/rustwasm/twiggy">github</a></h3></a>
<p><code>twiggy</code>æ˜¯ä¸€ä¸ªå¯¹<code>.wasm</code>äºŒè¿›åˆ¶æ–‡ä»¶ä»£ç å¤§å°åˆ†æå™¨. å®ƒåˆ†æäºŒè¿›åˆ¶çš„è°ƒç”¨å›¾æ¥å›ç­”å¦‚ä¸‹é—®é¢˜:</p>
<ul>
<li>ä¸ºä»€ä¹ˆè¿™ä¸ªå‡½æ•°é¦–å…ˆåŒ…å«åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­? å³å“ªäº›å¯¼å‡ºçš„å‡½æ•°æ˜¯å¯ä¼ é€’çš„å‘¢?</li>
<li>è¿™ä¸ªå‡½æ•°çš„ä¿ç•™å¤§å°æ˜¯å¤šå°‘? å³å¦‚æœåˆ é™¤å®ƒä»¥åŠåˆ é™¤åæˆä¸ºæ­»ä»£ç çš„æ‰€æœ‰å‡½æ•°,å°†èŠ‚çœå¤šå°‘ç©ºé—´.</li>
</ul>
<p>ä½¿ç”¨<code>twiggy</code>è®©ä½ çš„äºŒè¿›åˆ¶æ–‡ä»¶å˜å¾—è‹—æ¡!</p>
<a class="header" href="print.html#wasm-objdumpa-hrefhttpsgithubcomwebassemblywabtgithuba" id="wasm-objdumpa-hrefhttpsgithubcomwebassemblywabtgithuba"><h3><code>wasm-objdump</code>|<a href="https://github.com/WebAssembly/wabt">github</a></h3></a>
<p>æ‰“å°å…³äº<code>.wasm</code>äºŒè¿›åˆ¶åŠå…¶æ¯ä¸ªéƒ¨åˆ†çš„åŸºæœ¬è¯¦ç»†ä¿¡æ¯. è¿˜æ”¯æŒåæ±‡ç¼–æˆ WATæ–‡æœ¬æ ¼å¼. å°±åƒæ˜¯<code>objdump</code>,ä¸åŒçš„æ˜¯ä¸ºWebAssemblyæœåŠ¡çš„. è¿™æ˜¯WABTé¡¹ç›®çš„ä¸€éƒ¨åˆ†.</p>
<a class="header" href="print.html#wasm-nma-hrefhttpsgithubcomfitzgenwasm-nmgithuba" id="wasm-nma-hrefhttpsgithubcomfitzgenwasm-nmgithuba"><h3><code>wasm-nm</code>|<a href="https://github.com/fitzgen/wasm-nm">github</a></h3></a>
<p>åˆ—å‡º<code>.wasm</code>äºŒè¿›åˆ¶æ–‡ä»¶ä¸­å®šä¹‰çš„å¯¼å…¥,å¯¼å‡ºå’Œç§æœ‰å‡½æ•°ç¬¦å·. å°±åƒæ˜¯<code>nm</code>,ä¸åŒçš„æ˜¯ä¸ºWebAssemblyæœåŠ¡çš„.</p>
<a class="header" href="print.html#javascriptçš„äº’æ“ä½œ" id="javascriptçš„äº’æ“ä½œ"><h1>JavaScriptçš„äº’æ“ä½œ</h1></a>
<a class="header" href="print.html#aå¯¼å…¥å’Œå¯¼å‡ºjså‡½æ•°" id="aå¯¼å…¥å’Œå¯¼å‡ºjså‡½æ•°"><h3>å¯¼å…¥å’Œå¯¼å‡ºJSå‡½æ•°</h3></a>
<a class="header" href="print.html#aä»rustæ–¹é¢æ¥çœ‹" id="aä»rustæ–¹é¢æ¥çœ‹"><h4>ä»Rustæ–¹é¢æ¥çœ‹</h4></a>
<p>åœ¨ JSç¯å¢ƒ ä¸­ä½¿ç”¨ wasm æ—¶,ä» Rust å¯¼å…¥å’Œå¯¼å‡ºå‡½æ•°å¾ˆç®€å•: å®ƒçš„å·¥ä½œæ–¹å¼ä¸C å®Œå…¨ç›¸åŒ</p>
<p>WebAssembly æ¨¡å—å®šä¹‰äº†å¯¼å…¥çš„ä¸€ä¸ªç³»åˆ—,æ¯ä¸ªå¯¼å…¥å¸¦æœ‰ä¸€ä¸ª <em>æ¨¡å—å</em> å’Œ ä¸€ä¸ª<em>å¯¼å…¥åç§°</em>. ä½†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ª<code>extern { ... }</code>åŒºå—å’Œ <a href="https://github.com/rust-lang/rust/issues/52090"><code>#[link(wasm_import_module)]</code></a>æ¥å£°æ˜æ¨¡å—å, ç›®å‰
å®ƒé»˜è®¤ä¸º&quot;env&quot;</p>
<p>å¯¼å‡ºåªéœ€è¦ä¸€ä¸ªåç§°. é™¤äº†å…¶ä»–<code>extern</code>å‡½æ•°ä¹‹å¤–ï¼ŒWebAssemblyå®ä¾‹çš„çº¿æ€§å†…å­˜é»˜è®¤å¯¼å‡ºä¸º&quot;memory&quot;</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
// ä» `mod`æ¨¡å—å¯¼å…¥ä¸€ä¸ªå‡½æ•° `foo`
#[link(wasm_import_module = &quot;mod&quot;)]
extern { fn foo(); }

// å¯¼å‡º a Rust å‡½æ•° `bar`
#[no_mangle]
pub extern fn bar() { /* ... */ }
#}</code></pre></pre>
<p>ç”±äº wasm çš„æœ‰é™å€¼ç±»å‹,è¿™äº›å‡½æ•°å¿…é¡»ä»…åœ¨ åŸå§‹æ•°å­—ç±»å‹ä¸Šè¿è¡Œ.</p>
<a class="header" href="print.html#aä»jsæ–¹é¢æ¥çœ‹" id="aä»jsæ–¹é¢æ¥çœ‹"><h4>ä»JSæ–¹é¢æ¥çœ‹</h4></a>
<p>åœ¨JSä¸­,wasmäºŒè¿›åˆ¶æ–‡ä»¶å˜æˆäº†ES6æ¨¡å—.</p>
<p>å…¶ä¸­,çº¿æ€§å†…å­˜çš„<em>å®ä¾‹åŒ–</em>å’Œä¸€ç»„JSå‡½æ•°,ä¸€å®šæ˜¯é¢„æœŸå¯¼å…¥å»åˆçš„. æœ‰å…³å®ä¾‹åŒ–çš„è¯¦ç»†ä¿¡æ¯,è¯·è®¿é—®<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WebAssembly/instantiate">MDN</a>.</p>
<p>ç”Ÿæˆçš„ES6æ¨¡å—å°†åŒ…å«ä» Rust å¯¼å‡ºçš„æ‰€æœ‰å‡½æ•°,ç°åœ¨å¯ç”¨ä½œJSå‡½æ•°.</p>
<p><a href="https://www.hellorust.com/demos/add/index.html">è¿™é‡Œ</a>æ˜¯æ•´ä¸ªè®¾ç½®çš„ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­.</p>
<a class="header" href="print.html#aè¶…è¶Šæ•°å­—" id="aè¶…è¶Šæ•°å­—"><h3>è¶…è¶Šæ•°å­—</h3></a>
<p>åœ¨JSä¸­ä½¿ç”¨<code>wasm</code>æ—¶,<code>wasm</code>æ¨¡å—çš„å†…å­˜ä¸JSå†…å­˜ä¹‹é—´å­˜åœ¨æ˜æ˜¾çš„åˆ†æ­§:</p>
<ul>
<li>
<p>æ¯ä¸ª<code>wasm</code>æ¨¡å—éƒ½æœ‰ä¸€ä¸ªçº¿æ€§å†…å­˜ (åœ¨æœ¬æ–‡æ¡£çš„é¡¶éƒ¨æè¿°) ,å®ƒåœ¨å®ä¾‹åŒ–æœŸé—´åˆå§‹åŒ–. <strong>JSä»£ç å¯ä»¥è‡ªç”±åœ°è¯»å†™è¿™ä¸ªå†…å­˜</strong>.</p>
</li>
<li>
<p>ç›¸æ¯”ä¹‹ä¸‹,<code>wasm</code>ä»£ç æ²¡æœ‰<em>ç›´æ¥</em>è®¿é—®JSå¯¹è±¡.</p>
</li>
</ul>
<p>å› æ­¤,å¤æ‚çš„äº’æ“ä½œä»¥ä¸¤ç§ä¸»è¦æ–¹å¼å‘ç”Ÿ:</p>
<ul>
<li>
<p>å°†äºŒè¿›åˆ¶æ•°æ®å¤åˆ¶æˆ–è¾“å‡ºåˆ°<code>wasm</code>å†…å­˜. ä¾‹å¦‚,è¿™æ˜¯ä¸€ç§<code>String</code>æä¾›æ‰€æœ‰æƒçš„åˆ° Rust çš„æ–¹å¼.</p>
</li>
<li>
<p>è®¾ç½®JSå¯¹è±¡çš„æ˜¾å¼&quot;å †&quot;,ç„¶åç»™å‡º&quot;åœ°å€&quot;. è¿™å…è®¸<code>wasm</code>ä»£ç é—´æ¥å¼•ç”¨JSå¯¹è±¡ (ä½¿ç”¨æ•´æ•°) ,å¹¶é€šè¿‡ è°ƒç”¨å¯¼å…¥çš„JSå‡½æ•° å¯¹ è¿™äº›å¯¹è±¡ è¿›è¡Œæ“ä½œ.</p>
</li>
</ul>
<p>å¹¸è¿çš„æ˜¯,è¿™ä¸ªäº’æ“ä½œæ•…äº‹éå¸¸é€‚åˆé€šè¿‡é€šç”¨çš„&quot;bindgen&quot;å¼æ¡†æ¶è¿›è¡Œå¤„ç†: <a href="https://github.com/alexcrichton/wasm-bindgen">wasm-bindgen</a>. è¯¥æ¡†æ¶å¯ä»¥è‡ªåŠ¨ç¼–å†™ æƒ¯ç”¨Rustå‡½æ•°ç­¾å æ˜ å°„ æƒ¯ç”¨JSå‡½æ•° çš„</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        
        <script type="text/javascript">
            document.addEventListener('DOMContentLoaded', function() {
                window.print();
            })
        </script>
        

        

        
        <script src="searchindex.js" type="text/javascript" charset="utf-8"></script>
        
        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

    </body>
</html>
